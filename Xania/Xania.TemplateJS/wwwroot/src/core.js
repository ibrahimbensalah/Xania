"use strict";
var Core;
(function (Core) {
    function State(initialValue) {
        var fn = function (x) {
            if (x !== void 0)
                fn['id'] = x;
            return fn['id'];
        };
        fn['id'] = initialValue;
        fn['valueOf'] = function () { return initialValue; };
        return fn;
    }
    Core.State = State;
    var Dates = (function () {
        function Dates() {
        }
        Dates.addDays = function (days, date) {
            var retval = new Date(date.getTime());
            retval.setDate(date.getDate() + days);
            console.debug("addDays result", retval);
            return retval;
        };
        Dates.addYears = function (years, date) {
            var retval = new Date(date.getTime());
            retval.setFullYear(date.getFullYear() + years);
            console.debug("addYears result", retval);
            return retval;
        };
        Dates.addMonths = function (months, date) {
            var retval = new Date(date.getTime());
            retval.setMonth(date.getMonth() + months);
            console.debug("addMonths result", retval);
            return retval;
        };
        Dates.dayOf = function (date) {
            return date.getDate();
        };
        Dates.yearOf = function (date) {
            return date.getFullYear();
        };
        Dates.monthOf = function (date) {
            return date.getMonth();
        };
        Dates.formatDate = function (format, date) {
            return date.toString();
        };
        return Dates;
    }());
    Core.Dates = Dates;
    var Math = (function () {
        function Math() {
        }
        Math.le = function (rating, max) {
            return rating <= max;
        };
        Math.assign = function (property, value) {
            console.debug(property, value);
        };
        return Math;
    }());
    Core.Math = Math;
    var List = (function () {
        function List() {
        }
        List.count = function (fn, list) {
            debugger;
            if (!list)
                return 0;
            var result = 0, length = list.length;
            for (var i = 0; i < length; i++)
                if (fn(list[i]))
                    result++;
            return result;
        };
        List.any = function (fn, list) {
            return List.count(fn, list) > 0;
        };
        List.all = function (fn, list) {
            return List.count(fn, list) === list.length;
        };
        List.filter = function (fn, list) {
            var retval = [], length = list.length;
            for (var i = 0; i < length; i++) {
                var item = list[i];
                if (!!fn(item)) {
                    retval.push(item);
                }
            }
            return retval;
        };
        List.map = function (fn, list) {
            if (!list)
                return [];
            return list.map(fn);
        };
        List.empty = function (list) {
            return !list || list.length === 0;
        };
        List.reduce = function (fn, initialValue, list) {
            return !list && list.reduce(fn, initialValue);
        };
        return List;
    }());
    Core.List = List;
    function ready(data, resolve) {
        if (data !== null && data !== void 0 && !!data.then)
            return data.then(resolve);
        if (!!resolve.execute)
            return resolve.execute.call(resolve, data);
        return resolve.call(resolve, data);
    }
    Core.ready = ready;
    function compose() {
        var fns = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            fns[_i] = arguments[_i];
        }
        return function (result) {
            for (var i = fns.length - 1; i > -1; i--) {
                result = fns[i].call(this, result);
            }
            return result;
        };
    }
    Core.compose = compose;
    function defer() {
        return {
            value: void 0,
            resolvers: [],
            notify: function (value) {
                if (value === void 0)
                    throw new Error("undefined result");
                this.value = value;
                var length = this.resolvers.length;
                for (var i = 0; i < length; i++) {
                    this.resolvers[i].call(null, value);
                }
            },
            then: function (resolve) {
                if (this.value === void 0) {
                    this.resolvers.push(resolve);
                }
                else {
                    resolve.call(null, this.value);
                }
            }
        };
    }
    Core.defer = defer;
    Core.empty = "";
})(Core = exports.Core || (exports.Core = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29yZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNvcmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLElBQWMsSUFBSSxDQWlMakI7QUFqTEQsV0FBYyxJQUFJO0lBQ2QsZUFBc0IsWUFBWTtRQUM5QixJQUFJLEVBQUUsR0FBRyxVQUFBLENBQUM7WUFDTixFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyxDQUFDLENBQUM7Z0JBQ2IsRUFBRSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUVqQixNQUFNLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BCLENBQUMsQ0FBQztRQUNGLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxZQUFZLENBQUM7UUFDeEIsRUFBRSxDQUFDLFNBQVMsQ0FBQyxHQUFHLGNBQU0sT0FBQSxZQUFZLEVBQVosQ0FBWSxDQUFDO1FBRW5DLE1BQU0sQ0FBQyxFQUFFLENBQUM7SUFDZCxDQUFDO0lBWGUsVUFBSyxRQVdwQixDQUFBO0lBRUQ7UUFBQTtRQXdDQSxDQUFDO1FBdkNVLGFBQU8sR0FBZCxVQUFlLElBQVksRUFBRSxJQUFVO1lBQ25DLElBQUksTUFBTSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1lBQ3RDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDO1lBRXRDLE9BQU8sQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDeEMsTUFBTSxDQUFDLE1BQU0sQ0FBQztRQUNsQixDQUFDO1FBRU0sY0FBUSxHQUFmLFVBQWdCLEtBQWEsRUFBRSxJQUFVO1lBQ3JDLElBQUksTUFBTSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1lBQ3RDLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFdBQVcs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Q0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO2dCQUN4QyxDQUFDO1lBQ0wsQ0FBQztZQUNELElBQUksWUFBQyxPQUFPO2dCQUNSLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUN4QixJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDakMsQ0FBQztnQkFBQyxJQUFJLENBQUMsQ0FBQztvQkFDSixPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ25DLENBQUM7WUFDTCxDQUFDO1NBQ0osQ0FBQztJQUNOLENBQUM7SUF0QmUsVUFBSyxRQXNCcEIsQ0FBQTtJQUVVLFVBQUssR0FBRyxFQUFFLENBQUM7QUFDMUIsQ0FBQyxFQWpMYSxJQUFJLEdBQUosWUFBSSxLQUFKLFlBQUksUUFpTGpCIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IG1vZHVsZSBDb3JlIHtcclxuICAgIGV4cG9ydCBmdW5jdGlvbiBTdGF0ZShpbml0aWFsVmFsdWUpIHtcclxuICAgICAgICB2YXIgZm4gPSB4ID0+IHtcclxuICAgICAgICAgICAgaWYgKHggIT09IHZvaWQgMClcclxuICAgICAgICAgICAgICAgIGZuWydpZCddID0geDtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBmblsnaWQnXTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGZuWydpZCddID0gaW5pdGlhbFZhbHVlO1xyXG4gICAgICAgIGZuWyd2YWx1ZU9mJ10gPSAoKSA9PiBpbml0aWFsVmFsdWU7XHJcblxyXG4gICAgICAgIHJldHVybiBmbjtcclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgY2xhc3MgRGF0ZXMge1xyXG4gICAgICAgIHN0YXRpYyBhZGREYXlzKGRheXM6IG51bWJlciwgZGF0ZTogRGF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgcmV0dmFsID0gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkpO1xyXG4gICAgICAgICAgICByZXR2YWwuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIGRheXMpO1xyXG5cclxuICAgICAgICAgICAgY29uc29sZS5kZWJ1ZyhcImFkZERheXMgcmVzdWx0XCIsIHJldHZhbCk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXR2YWw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgYWRkWWVhcnMoeWVhcnM6IG51bWJlciwgZGF0ZTogRGF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgcmV0dmFsID0gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkpO1xyXG4gICAgICAgICAgICByZXR2YWwuc2V0RnVsbFllYXIoZGF0ZS5nZXRGdWxsWWVhcigpICsgeWVhcnMpO1xyXG5cclxuICAgICAgICAgICAgY29uc29sZS5kZWJ1ZyhcImFkZFllYXJzIHJlc3VsdFwiLCByZXR2YWwpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmV0dmFsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIGFkZE1vbnRocyhtb250aHM6IG51bWJlciwgZGF0ZTogRGF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgcmV0dmFsID0gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkpO1xyXG4gICAgICAgICAgICByZXR2YWwuc2V0TW9udGgoZGF0ZS5nZXRNb250aCgpICsgbW9udGhzKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoXCJhZGRNb250aHMgcmVzdWx0XCIsIHJldHZhbCk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXR2YWw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgZGF5T2YoZGF0ZTogRGF0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0ZS5nZXREYXRlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgeWVhck9mKGRhdGU6IERhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGUuZ2V0RnVsbFllYXIoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBtb250aE9mKGRhdGU6IERhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGUuZ2V0TW9udGgoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBmb3JtYXREYXRlKGZvcm1hdCwgZGF0ZTogRGF0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0ZS50b1N0cmluZygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgY2xhc3MgTWF0aCB7XHJcbiAgICAgICAgc3RhdGljIGxlKHJhdGluZywgbWF4KSB7XHJcbiAgICAgICAgICAgIHJldHVybiByYXRpbmcgPD0gbWF4O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIGFzc2lnbihwcm9wZXJ0eSwgdmFsdWUpIHtcclxuICAgICAgICAgICAgY29uc29sZS5kZWJ1Zyhwcm9wZXJ0eSwgdmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgY2xhc3MgTGlzdCB7XHJcbiAgICAgICAgc3RhdGljIGNvdW50KGZuLCBsaXN0KSB7XHJcbiAgICAgICAgICAgIGRlYnVnZ2VyO1xyXG4gICAgICAgICAgICBpZiAoIWxpc3QpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IDAsIGxlbmd0aCA9IGxpc3QubGVuZ3RoO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICAgICAgaWYgKGZuKGxpc3RbaV0pKVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCsrO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBhbnkoZm4sIGxpc3QpIHtcclxuICAgICAgICAgICAgcmV0dXJuIExpc3QuY291bnQoZm4sIGxpc3QpID4gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBhbGwoZm4sIGxpc3QpIHtcclxuICAgICAgICAgICAgcmV0dXJuIExpc3QuY291bnQoZm4sIGxpc3QpID09PSBsaXN0Lmxlbmd0aDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBmaWx0ZXIoZm4sIGxpc3QpIHtcclxuICAgICAgICAgICAgdmFyIHJldHZhbCA9IFtdLCBsZW5ndGggPSBsaXN0Lmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gbGlzdFtpXTtcclxuICAgICAgICAgICAgICAgIGlmICghIWZuKGl0ZW0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dmFsLnB1c2goaXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZXR2YWw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgbWFwKGZuLCBsaXN0KSB7XHJcbiAgICAgICAgICAgIGlmICghbGlzdClcclxuICAgICAgICAgICAgICAgIHJldHVybiBbXTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBsaXN0Lm1hcChmbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgZW1wdHkobGlzdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gIWxpc3QgfHwgbGlzdC5sZW5ndGggPT09IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgcmVkdWNlKGZuLCBpbml0aWFsVmFsdWUsIGxpc3QpIHtcclxuICAgICAgICAgICAgcmV0dXJuICFsaXN0ICYmIGxpc3QucmVkdWNlKGZuLCBpbml0aWFsVmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgZnVuY3Rpb24gcmVhZHkoZGF0YSwgcmVzb2x2ZSkge1xyXG5cclxuICAgICAgICBpZiAoZGF0YSAhPT0gbnVsbCAmJiBkYXRhICE9PSB2b2lkIDAgJiYgISFkYXRhLnRoZW4pXHJcbiAgICAgICAgICAgIHJldHVybiBkYXRhLnRoZW4ocmVzb2x2ZSk7XHJcblxyXG4gICAgICAgIGlmICghIXJlc29sdmUuZXhlY3V0ZSlcclxuICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUuZXhlY3V0ZS5jYWxsKHJlc29sdmUsIGRhdGEpO1xyXG5cclxuICAgICAgICByZXR1cm4gcmVzb2x2ZS5jYWxsKHJlc29sdmUsIGRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vZXhwb3J0IGZ1bmN0aW9uIGZvckVhY2gyKGRhdGEsIHJlc29sdmUpIHtcclxuICAgIC8vICAgIGlmIChkYXRhID09PSB2b2lkIDApXHJcbiAgICAvLyAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwidW5kZWZpbmVkXCIpO1xyXG4gICAgLy8gICAgaWYgKGRhdGEgPT09IG51bGwpXHJcbiAgICAvLyAgICAgICAgcmV0dXJuIHJlc29sdmUobnVsbCk7XHJcblxyXG4gICAgLy8gICAgaWYgKCEhZGF0YS5mb3JFYWNoKVxyXG4gICAgLy8gICAgICAgIHJldHVybiBkYXRhLmZvckVhY2gocmVzb2x2ZSk7XHJcblxyXG4gICAgLy8gICAgaWYgKCEhZGF0YS50aGVuKVxyXG4gICAgLy8gICAgICAgIHJldHVybiBkYXRhLnRoZW4oZCA9PiBmb3JFYWNoMihkLCByZXNvbHZlKSk7XHJcblxyXG4gICAgLy8gICAgcmV0dXJuIHJlc29sdmUoZGF0YSk7XHJcbiAgICAvL31cclxuXHJcbiAgICBleHBvcnQgZnVuY3Rpb24gY29tcG9zZSguLi5mbnM6IGFueVtdKTogRnVuY3Rpb24ge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBmbnMubGVuZ3RoIC0gMTsgaSA+IC0xOyBpLS0pIHtcclxuICAgICAgICAgICAgICAgIC8vIFJlU2hhcnBlciBkaXNhYmxlIG9uY2UgU3VzcGljaW91c1RoaXNVc2FnZVxyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gZm5zW2ldLmNhbGwodGhpcywgcmVzdWx0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGRlZmVyKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHZhbHVlOiB2b2lkIDAsXHJcbiAgICAgICAgICAgIHJlc29sdmVyczogW10sXHJcbiAgICAgICAgICAgIG5vdGlmeSh2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSB2b2lkIDApXHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwidW5kZWZpbmVkIHJlc3VsdFwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICB2YXIgbGVuZ3RoID0gdGhpcy5yZXNvbHZlcnMubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVzb2x2ZXJzW2ldLmNhbGwobnVsbCwgdmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0aGVuKHJlc29sdmUpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlID09PSB2b2lkIDApIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc29sdmVycy5wdXNoKHJlc29sdmUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlLmNhbGwobnVsbCwgdGhpcy52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGV4cG9ydCB2YXIgZW1wdHkgPSBcIlwiO1xyXG59Il19