"use strict";
var Core;
(function (Core) {
    function State(initialValue) {
        var fn = function (x) {
            if (x !== undefined)
                fn['id'] = x;
            return fn['id'];
        };
        fn['id'] = initialValue;
        fn['valueOf'] = function () { return initialValue; };
        return fn;
    }
    Core.State = State;
    var Dates = (function () {
        function Dates() {
        }
        Dates.addDays = function (days, date) {
            var retval = new Date(date.getTime());
            retval.setDate(date.getDate() + days);
            console.debug("addDays result", retval);
            return retval;
        };
        Dates.addYears = function (years, date) {
            var retval = new Date(date.getTime());
            retval.setFullYear(date.getFullYear() + years);
            console.debug("addYears result", retval);
            return retval;
        };
        Dates.addMonths = function (months, date) {
            var retval = new Date(date.getTime());
            retval.setMonth(date.getMonth() + months);
            console.debug("addMonths result", retval);
            return retval;
        };
        Dates.dayOf = function (date) {
            return date.getDate();
        };
        Dates.yearOf = function (date) {
            return date.getFullYear();
        };
        Dates.monthOf = function (date) {
            return date.getMonth();
        };
        Dates.formatDate = function (format, date) {
            return date.toString();
        };
        return Dates;
    }());
    Core.Dates = Dates;
    var Math = (function () {
        function Math() {
        }
        Math.le = function (rating, max) {
            return rating <= max;
        };
        Math.assign = function (property, value) {
            console.debug(property, value);
        };
        return Math;
    }());
    Core.Math = Math;
    var List = (function () {
        function List() {
        }
        List.count = function (fn, list) {
            if (!list)
                return 0;
            var result = 0, length = list.length;
            for (var i = 0; i < length; i++)
                if (fn(list[i]))
                    result++;
            return result;
        };
        List.any = function (fn, list) {
            return List.count(fn, list) > 0;
        };
        List.all = function (fn, list) {
            return List.count(fn, list) === list.length;
        };
        List.filter = function (fn, list) {
            var retval = [], length = list.length;
            for (var i = 0; i < length; i++) {
                var item = list[i];
                if (!!fn(item)) {
                    retval.push(item);
                }
            }
            return retval;
        };
        List.map = function (fn, list) {
            if (!list)
                return [];
            return list.map(fn);
        };
        List.empty = function (list) {
            return !list || list.length === 0;
        };
        List.reduce = function (fn, initialValue, list) {
            return !list && list.reduce(fn, initialValue);
        };
        return List;
    }());
    Core.List = List;
    function ready(data, resolve) {
        if (data !== null && data !== void 0 && !!data.then)
            return data.then(resolve);
        if (!!resolve.execute)
            return resolve.execute.call(resolve, data);
        return resolve.call(resolve, data);
    }
    Core.ready = ready;
    function compose() {
        var fns = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            fns[_i] = arguments[_i];
        }
        return function (result) {
            for (var i = fns.length - 1; i > -1; i--) {
                result = fns[i].call(this, result);
            }
            return result;
        };
    }
    Core.compose = compose;
    function defer() {
        return {
            value: void 0,
            resolvers: [],
            notify: function (value) {
                if (value === void 0)
                    throw new Error("undefined result");
                this.value = value;
                var length = this.resolvers.length;
                for (var i = 0; i < length; i++) {
                    this.resolvers[i].call(null, value);
                }
            },
            then: function (resolve) {
                if (this.value === void 0) {
                    this.resolvers.push(resolve);
                }
                else {
                    resolve.call(null, this.value);
                }
            }
        };
    }
    Core.defer = defer;
    Core.empty = "";
})(Core = exports.Core || (exports.Core = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29yZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb3JlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFjLElBQUksQ0FnTGpCO0FBaExELFdBQWMsSUFBSTtJQUNkLGVBQXNCLFlBQVk7UUFDOUIsSUFBSSxFQUFFLEdBQUcsVUFBQSxDQUFDO1lBQ04sRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLFNBQVMsQ0FBQztnQkFDaEIsRUFBRSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUVqQixNQUFNLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BCLENBQUMsQ0FBQztRQUNGLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxZQUFZLENBQUM7UUFDeEIsRUFBRSxDQUFDLFNBQVMsQ0FBQyxHQUFHLGNBQU0sT0FBQSxZQUFZLEVBQVosQ0FBWSxDQUFDO1FBRW5DLE1BQU0sQ0FBQyxFQUFFLENBQUM7SUFDZCxDQUFDO0lBWGUsVUFBSyxRQVdwQixDQUFBO0lBRUQ7UUFBQTtRQXdDQSxDQUFDO1FBdkNVLGFBQU8sR0FBZCxVQUFlLElBQVksRUFBRSxJQUFVO1lBQ25DLElBQUksTUFBTSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1lBQ3RDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDO1lBRXRDLE9BQU8sQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDeEMsTUFBTSxDQUFDLE1BQU0sQ0FBQztRQUNsQixDQUFDO1FBRU0sY0FBUSxHQUFmLFVBQWdCLEtBQWEsRUFBRSxJQUFVO1lBQ3JDLElBQUksTUFBTSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1lBQ3RDLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFD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LENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO2dCQUN4QyxDQUFDO1lBQ0wsQ0FBQztZQUNELElBQUksWUFBQyxPQUFPO2dCQUNSLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUN4QixJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDakMsQ0FBQztnQkFBQyxJQUFJLENBQUMsQ0FBQztvQkFDSixPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ25DLENBQUM7WUFDTCxDQUFDO1NBQ0osQ0FBQztJQUNOLENBQUM7SUF0QmUsVUFBSyxRQXNCcEIsQ0FBQTtJQUVVLFVBQUssR0FBRyxFQUFFLENBQUM7QUFDMUIsQ0FBQyxFQWhMYSxJQUFJLEdBQUosWUFBSSxLQUFKLFlBQUksUUFnTGpCIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IG1vZHVsZSBDb3JlIHtcclxuICAgIGV4cG9ydCBmdW5jdGlvbiBTdGF0ZShpbml0aWFsVmFsdWUpIHtcclxuICAgICAgICB2YXIgZm4gPSB4ID0+IHtcclxuICAgICAgICAgICAgaWYgKHggIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgIGZuWydpZCddID0geDtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBmblsnaWQnXTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGZuWydpZCddID0gaW5pdGlhbFZhbHVlO1xyXG4gICAgICAgIGZuWyd2YWx1ZU9mJ10gPSAoKSA9PiBpbml0aWFsVmFsdWU7XHJcblxyXG4gICAgICAgIHJldHVybiBmbjtcclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgY2xhc3MgRGF0ZXMge1xyXG4gICAgICAgIHN0YXRpYyBhZGREYXlzKGRheXM6IG51bWJlciwgZGF0ZTogRGF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgcmV0dmFsID0gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkpO1xyXG4gICAgICAgICAgICByZXR2YWwuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIGRheXMpO1xyXG5cclxuICAgICAgICAgICAgY29uc29sZS5kZWJ1ZyhcImFkZERheXMgcmVzdWx0XCIsIHJldHZhbCk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXR2YWw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgYWRkWWVhcnMoeWVhcnM6IG51bWJlciwgZGF0ZTogRGF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgcmV0dmFsID0gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkpO1xyXG4gICAgICAgICAgICByZXR2YWwuc2V0RnVsbFllYXIoZGF0ZS5nZXRGdWxsWWVhcigpICsgeWVhcnMpO1xyXG5cclxuICAgICAgICAgICAgY29uc29sZS5kZWJ1ZyhcImFkZFllYXJzIHJlc3VsdFwiLCByZXR2YWwpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmV0dmFsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIGFkZE1vbnRocyhtb250aHM6IG51bWJlciwgZGF0ZTogRGF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgcmV0dmFsID0gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkpO1xyXG4gICAgICAgICAgICByZXR2YWwuc2V0TW9udGgoZGF0ZS5nZXRNb250aCgpICsgbW9udGhzKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoXCJhZGRNb250aHMgcmVzdWx0XCIsIHJldHZhbCk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXR2YWw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgZGF5T2YoZGF0ZTogRGF0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0ZS5nZXREYXRlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgeWVhck9mKGRhdGU6IERhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGUuZ2V0RnVsbFllYXIoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBtb250aE9mKGRhdGU6IERhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGUuZ2V0TW9udGgoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBmb3JtYXREYXRlKGZvcm1hdCwgZGF0ZTogRGF0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0ZS50b1N0cmluZygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgY2xhc3MgTWF0aCB7XHJcbiAgICAgICAgc3RhdGljIGxlKHJhdGluZywgbWF4KSB7XHJcbiAgICAgICAgICAgIHJldHVybiByYXRpbmcgPD0gbWF4O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIGFzc2lnbihwcm9wZXJ0eSwgdmFsdWUpIHtcclxuICAgICAgICAgICAgY29uc29sZS5kZWJ1Zyhwcm9wZXJ0eSwgdmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgY2xhc3MgTGlzdCB7XHJcbiAgICAgICAgc3RhdGljIGNvdW50KGZuLCBsaXN0KSB7XHJcbiAgICAgICAgICAgIGlmICghbGlzdClcclxuICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gMCwgbGVuZ3RoID0gbGlzdC5sZW5ndGg7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgICAgICBpZiAoZm4obGlzdFtpXSkpXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0Kys7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIGFueShmbiwgbGlzdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gTGlzdC5jb3VudChmbiwgbGlzdCkgPiAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIGFsbChmbiwgbGlzdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gTGlzdC5jb3VudChmbiwgbGlzdCkgPT09IGxpc3QubGVuZ3RoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIGZpbHRlcihmbiwgbGlzdCkge1xyXG4gICAgICAgICAgICB2YXIgcmV0dmFsID0gW10sIGxlbmd0aCA9IGxpc3QubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBsaXN0W2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKCEhZm4oaXRlbSkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR2YWwucHVzaChpdGVtKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJldHZhbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBtYXAoZm4sIGxpc3QpIHtcclxuICAgICAgICAgICAgaWYgKCFsaXN0KVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGxpc3QubWFwKGZuKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBlbXB0eShsaXN0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAhbGlzdCB8fCBsaXN0Lmxlbmd0aCA9PT0gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyByZWR1Y2UoZm4sIGluaXRpYWxWYWx1ZSwgbGlzdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gIWxpc3QgJiYgbGlzdC5yZWR1Y2UoZm4sIGluaXRpYWxWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGV4cG9ydCBmdW5jdGlvbiByZWFkeShkYXRhLCByZXNvbHZlKSB7XHJcblxyXG4gICAgICAgIGlmIChkYXRhICE9PSBudWxsICYmIGRhdGEgIT09IHZvaWQgMCAmJiAhIWRhdGEudGhlbilcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGEudGhlbihyZXNvbHZlKTtcclxuXHJcbiAgICAgICAgaWYgKCEhcmVzb2x2ZS5leGVjdXRlKVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzb2x2ZS5leGVjdXRlLmNhbGwocmVzb2x2ZSwgZGF0YSk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXNvbHZlLmNhbGwocmVzb2x2ZSwgZGF0YSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy9leHBvcnQgZnVuY3Rpb24gZm9yRWFjaDIoZGF0YSwgcmVzb2x2ZSkge1xyXG4gICAgLy8gICAgaWYgKGRhdGEgPT09IHZvaWQgMClcclxuICAgIC8vICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ1bmRlZmluZWRcIik7XHJcbiAgICAvLyAgICBpZiAoZGF0YSA9PT0gbnVsbClcclxuICAgIC8vICAgICAgICByZXR1cm4gcmVzb2x2ZShudWxsKTtcclxuXHJcbiAgICAvLyAgICBpZiAoISFkYXRhLmZvckVhY2gpXHJcbiAgICAvLyAgICAgICAgcmV0dXJuIGRhdGEuZm9yRWFjaChyZXNvbHZlKTtcclxuXHJcbiAgICAvLyAgICBpZiAoISFkYXRhLnRoZW4pXHJcbiAgICAvLyAgICAgICAgcmV0dXJuIGRhdGEudGhlbihkID0+IGZvckVhY2gyKGQsIHJlc29sdmUpKTtcclxuXHJcbiAgICAvLyAgICByZXR1cm4gcmVzb2x2ZShkYXRhKTtcclxuICAgIC8vfVxyXG5cclxuICAgIGV4cG9ydCBmdW5jdGlvbiBjb21wb3NlKC4uLmZuczogYW55W10pOiBGdW5jdGlvbiB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IGZucy5sZW5ndGggLSAxOyBpID4gLTE7IGktLSkge1xyXG4gICAgICAgICAgICAgICAgLy8gUmVTaGFycGVyIGRpc2FibGUgb25jZSBTdXNwaWNpb3VzVGhpc1VzYWdlXHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBmbnNbaV0uY2FsbCh0aGlzLCByZXN1bHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgZnVuY3Rpb24gZGVmZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdmFsdWU6IHZvaWQgMCxcclxuICAgICAgICAgICAgcmVzb2x2ZXJzOiBbXSxcclxuICAgICAgICAgICAgbm90aWZ5KHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IHZvaWQgMClcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ1bmRlZmluZWQgcmVzdWx0XCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIHZhciBsZW5ndGggPSB0aGlzLnJlc29sdmVycy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNvbHZlcnNbaV0uY2FsbChudWxsLCB2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHRoZW4ocmVzb2x2ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudmFsdWUgPT09IHZvaWQgMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVzb2x2ZXJzLnB1c2gocmVzb2x2ZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUuY2FsbChudWxsLCB0aGlzLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IHZhciBlbXB0eSA9IFwiXCI7XHJcbn0iXX0=