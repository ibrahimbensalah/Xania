"use strict";
var Core;
(function (Core) {
    function State(initialValue) {
        var fn = function (x) {
            if (x !== void 0)
                fn['id'] = x;
            return fn['id'];
        };
        fn['id'] = initialValue;
        fn['valueOf'] = function () { return initialValue; };
        return fn;
    }
    Core.State = State;
    var Dates = (function () {
        function Dates() {
        }
        Dates.addDays = function (days, date) {
            var retval = new Date(date.getTime());
            retval.setDate(date.getDate() + days);
            console.debug("addDays result", retval);
            return retval;
        };
        Dates.addYears = function (years, date) {
            var retval = new Date(date.getTime());
            retval.setFullYear(date.getFullYear() + years);
            console.debug("addYears result", retval);
            return retval;
        };
        Dates.addMonths = function (months, date) {
            var retval = new Date(date.getTime());
            retval.setMonth(date.getMonth() + months);
            console.debug("addMonths result", retval);
            return retval;
        };
        Dates.dayOf = function (date) {
            return date.getDate();
        };
        Dates.yearOf = function (date) {
            return date.getFullYear();
        };
        Dates.monthOf = function (date) {
            return date.getMonth();
        };
        Dates.formatDate = function (format, date) {
            return date.toString();
        };
        return Dates;
    }());
    Core.Dates = Dates;
    var Math = (function () {
        function Math() {
        }
        Math.le = function (rating, max) {
            return rating <= max;
        };
        Math.assign = function (property, value) {
            console.debug(property, value);
        };
        return Math;
    }());
    Core.Math = Math;
    var List = (function () {
        function List() {
        }
        List.count = function (fn, list) {
            if (!list)
                return 0;
            var result = 0, length = list.length;
            for (var i = 0; i < length; i++)
                if (fn(list[i]))
                    result++;
            return result;
        };
        List.any = function (fn, list) {
            return List.count(fn, list) > 0;
        };
        List.all = function (fn, list) {
            return List.count(fn, list) === list.length;
        };
        List.filter = function (fn, list) {
            var retval = [], length = list.length;
            for (var i = 0; i < length; i++) {
                var item = list[i];
                if (!!fn(item)) {
                    retval.push(item);
                }
            }
            return retval;
        };
        List.map = function (fn, list) {
            if (!list)
                return [];
            return list.map(fn);
        };
        List.empty = function (list) {
            return !list || list.length === 0;
        };
        List.reduce = function (fn, initialValue, list) {
            return !list && list.reduce(fn, initialValue);
        };
        return List;
    }());
    Core.List = List;
    function ready(data, resolve) {
        if (data !== null && data !== void 0 && !!data.then)
            return data.then(resolve);
        if (!!resolve.execute)
            return resolve.execute.call(resolve, data);
        return resolve.call(resolve, data);
    }
    Core.ready = ready;
    function compose() {
        var fns = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            fns[_i] = arguments[_i];
        }
        return function (result) {
            for (var i = fns.length - 1; i > -1; i--) {
                result = fns[i].call(this, result);
            }
            return result;
        };
    }
    Core.compose = compose;
    function defer() {
        return {
            value: void 0,
            resolvers: [],
            notify: function (value) {
                if (value === void 0)
                    throw new Error("undefined result");
                this.value = value;
                var length = this.resolvers.length;
                for (var i = 0; i < length; i++) {
                    this.resolvers[i].call(null, value);
                }
            },
            then: function (resolve) {
                if (this.value === void 0) {
                    this.resolvers.push(resolve);
                }
                else {
                    resolve.call(null, this.value);
                }
            }
        };
    }
    Core.defer = defer;
    Core.empty = "";
})(Core = exports.Core || (exports.Core = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29yZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb3JlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFjLElBQUksQ0FnTGpCO0FBaExELFdBQWMsSUFBSTtJQUNkLGVBQXNCLFlBQVk7UUFDOUIsSUFBSSxFQUFFLEdBQUcsVUFBQSxDQUFDO1lBQ04sRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLEtBQUssQ0FBQyxDQUFDO2dCQUNiLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFakIsTUFBTSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNwQixDQUFDLENBQUM7UUFDRixFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsWUFBWSxDQUFDO1FBQ3hCLEVBQUUsQ0FBQyxTQUFTLENBQUMsR0FBRyxjQUFNLE9BQUEsWUFBWSxFQUFaLENBQVksQ0FBQztRQUVuQyxNQUFNLENBQUMsRUFBRSxDQUFDO0lBQ2QsQ0FBQztJQVhlLFVBQUssUUFXcEIsQ0FBQTtJQUVEO1FBQUE7UUF3Q0EsQ0FBQztRQXZDVSxhQUFPLEdBQWQsVUFBZSxJQUFZLEVBQUUsSUFBVTtZQUNuQyxJQUFJLE1BQU0sR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUN0QyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQztZQUV0QyxPQUFPLENBQUMsS0FBSyxDQUFDLGdCQUFnQixFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ3hDLE1BQU0sQ0FBQyxNQUFNLENBQUM7UUFDbEIsQ0FBQztRQUVNLGNBQVEsR0FBZixVQUFnQixLQUFhLEVBQUUsSUFBVTtZQUNyQyxJQUFJLE1BQU0sR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUN0QyxNQUFNLENBQUMsV0FBVyxDQUFDLElBQUks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SUFBSSxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztnQkFDeEMsQ0FBQztZQUNMLENBQUM7WUFDRCxJQUFJLFlBQUMsT0FBTztnQkFDUixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDeEIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQ2pDLENBQUM7Z0JBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ0osT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUNuQyxDQUFDO1lBQ0wsQ0FBQztTQUNKLENBQUM7SUFDTixDQUFDO0lBdEJlLFVBQUssUUFzQnBCLENBQUE7SUFFVSxVQUFLLEdBQUcsRUFBRSxDQUFDO0FBQzFCLENBQUMsRUFoTGEsSUFBSSxHQUFKLFlBQUksS0FBSixZQUFJLFFBZ0xqQiIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBtb2R1bGUgQ29yZSB7XHJcbiAgICBleHBvcnQgZnVuY3Rpb24gU3RhdGUoaW5pdGlhbFZhbHVlKSB7XHJcbiAgICAgICAgdmFyIGZuID0geCA9PiB7XHJcbiAgICAgICAgICAgIGlmICh4ICE9PSB2b2lkIDApXHJcbiAgICAgICAgICAgICAgICBmblsnaWQnXSA9IHg7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZm5bJ2lkJ107XHJcbiAgICAgICAgfTtcclxuICAgICAgICBmblsnaWQnXSA9IGluaXRpYWxWYWx1ZTtcclxuICAgICAgICBmblsndmFsdWVPZiddID0gKCkgPT4gaW5pdGlhbFZhbHVlO1xyXG5cclxuICAgICAgICByZXR1cm4gZm47XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIERhdGVzIHtcclxuICAgICAgICBzdGF0aWMgYWRkRGF5cyhkYXlzOiBudW1iZXIsIGRhdGU6IERhdGUpIHtcclxuICAgICAgICAgICAgdmFyIHJldHZhbCA9IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpKTtcclxuICAgICAgICAgICAgcmV0dmFsLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgKyBkYXlzKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoXCJhZGREYXlzIHJlc3VsdFwiLCByZXR2YWwpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmV0dmFsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIGFkZFllYXJzKHllYXJzOiBudW1iZXIsIGRhdGU6IERhdGUpIHtcclxuICAgICAgICAgICAgdmFyIHJldHZhbCA9IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpKTtcclxuICAgICAgICAgICAgcmV0dmFsLnNldEZ1bGxZZWFyKGRhdGUuZ2V0RnVsbFllYXIoKSArIHllYXJzKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoXCJhZGRZZWFycyByZXN1bHRcIiwgcmV0dmFsKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJldHZhbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBhZGRNb250aHMobW9udGhzOiBudW1iZXIsIGRhdGU6IERhdGUpIHtcclxuICAgICAgICAgICAgdmFyIHJldHZhbCA9IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpKTtcclxuICAgICAgICAgICAgcmV0dmFsLnNldE1vbnRoKGRhdGUuZ2V0TW9udGgoKSArIG1vbnRocyk7XHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmRlYnVnKFwiYWRkTW9udGhzIHJlc3VsdFwiLCByZXR2YWwpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmV0dmFsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIGRheU9mKGRhdGU6IERhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGUuZ2V0RGF0ZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIHllYXJPZihkYXRlOiBEYXRlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRlLmdldEZ1bGxZZWFyKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgbW9udGhPZihkYXRlOiBEYXRlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRlLmdldE1vbnRoKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgZm9ybWF0RGF0ZShmb3JtYXQsIGRhdGU6IERhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGUudG9TdHJpbmcoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIE1hdGgge1xyXG4gICAgICAgIHN0YXRpYyBsZShyYXRpbmcsIG1heCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmF0aW5nIDw9IG1heDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBhc3NpZ24ocHJvcGVydHksIHZhbHVlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZGVidWcocHJvcGVydHksIHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIExpc3Qge1xyXG4gICAgICAgIHN0YXRpYyBjb3VudChmbiwgbGlzdCkge1xyXG4gICAgICAgICAgICBpZiAoIWxpc3QpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IDAsIGxlbmd0aCA9IGxpc3QubGVuZ3RoO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICAgICAgaWYgKGZuKGxpc3RbaV0pKVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCsrO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBhbnkoZm4sIGxpc3QpIHtcclxuICAgICAgICAgICAgcmV0dXJuIExpc3QuY291bnQoZm4sIGxpc3QpID4gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBhbGwoZm4sIGxpc3QpIHtcclxuICAgICAgICAgICAgcmV0dXJuIExpc3QuY291bnQoZm4sIGxpc3QpID09PSBsaXN0Lmxlbmd0aDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBmaWx0ZXIoZm4sIGxpc3QpIHtcclxuICAgICAgICAgICAgdmFyIHJldHZhbCA9IFtdLCBsZW5ndGggPSBsaXN0Lmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gbGlzdFtpXTtcclxuICAgICAgICAgICAgICAgIGlmICghIWZuKGl0ZW0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dmFsLnB1c2goaXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZXR2YWw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgbWFwKGZuLCBsaXN0KSB7XHJcbiAgICAgICAgICAgIGlmICghbGlzdClcclxuICAgICAgICAgICAgICAgIHJldHVybiBbXTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBsaXN0Lm1hcChmbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgZW1wdHkobGlzdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gIWxpc3QgfHwgbGlzdC5sZW5ndGggPT09IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgcmVkdWNlKGZuLCBpbml0aWFsVmFsdWUsIGxpc3QpIHtcclxuICAgICAgICAgICAgcmV0dXJuICFsaXN0ICYmIGxpc3QucmVkdWNlKGZuLCBpbml0aWFsVmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgZnVuY3Rpb24gcmVhZHkoZGF0YSwgcmVzb2x2ZSkge1xyXG5cclxuICAgICAgICBpZiAoZGF0YSAhPT0gbnVsbCAmJiBkYXRhICE9PSB2b2lkIDAgJiYgISFkYXRhLnRoZW4pXHJcbiAgICAgICAgICAgIHJldHVybiBkYXRhLnRoZW4ocmVzb2x2ZSk7XHJcblxyXG4gICAgICAgIGlmICghIXJlc29sdmUuZXhlY3V0ZSlcclxuICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUuZXhlY3V0ZS5jYWxsKHJlc29sdmUsIGRhdGEpO1xyXG5cclxuICAgICAgICByZXR1cm4gcmVzb2x2ZS5jYWxsKHJlc29sdmUsIGRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vZXhwb3J0IGZ1bmN0aW9uIGZvckVhY2gyKGRhdGEsIHJlc29sdmUpIHtcclxuICAgIC8vICAgIGlmIChkYXRhID09PSB2b2lkIDApXHJcbiAgICAvLyAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwidW5kZWZpbmVkXCIpO1xyXG4gICAgLy8gICAgaWYgKGRhdGEgPT09IG51bGwpXHJcbiAgICAvLyAgICAgICAgcmV0dXJuIHJlc29sdmUobnVsbCk7XHJcblxyXG4gICAgLy8gICAgaWYgKCEhZGF0YS5mb3JFYWNoKVxyXG4gICAgLy8gICAgICAgIHJldHVybiBkYXRhLmZvckVhY2gocmVzb2x2ZSk7XHJcblxyXG4gICAgLy8gICAgaWYgKCEhZGF0YS50aGVuKVxyXG4gICAgLy8gICAgICAgIHJldHVybiBkYXRhLnRoZW4oZCA9PiBmb3JFYWNoMihkLCByZXNvbHZlKSk7XHJcblxyXG4gICAgLy8gICAgcmV0dXJuIHJlc29sdmUoZGF0YSk7XHJcbiAgICAvL31cclxuXHJcbiAgICBleHBvcnQgZnVuY3Rpb24gY29tcG9zZSguLi5mbnM6IGFueVtdKTogRnVuY3Rpb24ge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBmbnMubGVuZ3RoIC0gMTsgaSA+IC0xOyBpLS0pIHtcclxuICAgICAgICAgICAgICAgIC8vIFJlU2hhcnBlciBkaXNhYmxlIG9uY2UgU3VzcGljaW91c1RoaXNVc2FnZVxyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gZm5zW2ldLmNhbGwodGhpcywgcmVzdWx0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGRlZmVyKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHZhbHVlOiB2b2lkIDAsXHJcbiAgICAgICAgICAgIHJlc29sdmVyczogW10sXHJcbiAgICAgICAgICAgIG5vdGlmeSh2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSB2b2lkIDApXHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwidW5kZWZpbmVkIHJlc3VsdFwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICB2YXIgbGVuZ3RoID0gdGhpcy5yZXNvbHZlcnMubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVzb2x2ZXJzW2ldLmNhbGwobnVsbCwgdmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0aGVuKHJlc29sdmUpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlID09PSB2b2lkIDApIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc29sdmVycy5wdXNoKHJlc29sdmUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlLmNhbGwobnVsbCwgdGhpcy52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGV4cG9ydCB2YXIgZW1wdHkgPSBcIlwiO1xyXG59Il19