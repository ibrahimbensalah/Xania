"use strict";
var Core;
(function (Core) {
    function State(initialValue) {
        var fn = function (x) {
            if (x !== undefined)
                fn['id'] = x;
            return fn['id'];
        };
        fn['id'] = initialValue;
        fn['valueOf'] = function () { return initialValue; };
        return fn;
    }
    Core.State = State;
    var Dates = (function () {
        function Dates() {
        }
        Dates.addDays = function (days, date) {
            var retval = new Date(date.getTime());
            retval.setDate(date.getDate() + days);
            console.debug("addDays result", retval);
            return retval;
        };
        Dates.addYears = function (years, date) {
            var retval = new Date(date.getTime());
            retval.setFullYear(date.getFullYear() + years);
            console.debug("addYears result", retval);
            return retval;
        };
        Dates.addMonths = function (months, date) {
            var retval = new Date(date.getTime());
            retval.setMonth(date.getMonth() + months);
            console.debug("addMonths result", retval);
            return retval;
        };
        Dates.dayOf = function (date) {
            return date.getDate();
        };
        Dates.yearOf = function (date) {
            return date.getFullYear();
        };
        Dates.monthOf = function (date) {
            return date.getMonth();
        };
        Dates.formatDate = function (format, date) {
            return date.toString();
        };
        return Dates;
    }());
    Core.Dates = Dates;
    var Math = (function () {
        function Math() {
        }
        Math.le = function (rating, max) {
            return rating <= max;
        };
        Math.assign = function (property, value) {
            console.debug(property, value);
        };
        return Math;
    }());
    Core.Math = Math;
    var List = (function () {
        function List() {
        }
        List.count = function (fn, list) {
            if (!list)
                return 0;
            var result = 0;
            for (var i = 0; i < list.length; i++)
                if (fn(list[i]))
                    result++;
            return result;
        };
        List.any = function (fn, list) {
            return List.count(fn, list) > 0;
        };
        List.all = function (fn, list) {
            return List.count(fn, list) === list.length;
        };
        List.filter = function (fn, list) {
            var retval = [];
            for (var i = 0; i < list.length; i++) {
                var item = list[i];
                if (!!fn(item)) {
                    retval.push(item);
                }
            }
            return retval;
        };
        List.map = function (fn, list) {
            if (!list)
                return [];
            return list.map(fn);
        };
        List.empty = function (list) {
            return !list || list.length === 0;
        };
        List.reduce = function (fn, initialValue, list) {
            return !list && list.reduce(fn, initialValue);
        };
        return List;
    }());
    Core.List = List;
    function ready(data, resolve) {
        if (data !== null && data !== void 0 && !!data.then)
            return data.then(resolve);
        if (!!resolve.execute)
            return resolve.execute.call(resolve, data);
        return resolve.call(resolve, data);
    }
    Core.ready = ready;
    function forEach(data, resolve) {
        if (data === void 0)
            throw new Error("undefined");
        if (data === null)
            return resolve(null);
        if (!!data.forEach)
            return data.forEach(resolve);
        if (!!data.then)
            return data.then(function (d) { return forEach(d, resolve); });
        return resolve(data);
    }
    Core.forEach = forEach;
    function compose() {
        var fns = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            fns[_i] = arguments[_i];
        }
        return function (result) {
            for (var i = fns.length - 1; i > -1; i--) {
                result = fns[i].call(this, result);
            }
            return result;
        };
    }
    Core.compose = compose;
    function defer() {
        return {
            value: void 0,
            resolvers: [],
            notify: function (value) {
                if (value === void 0)
                    throw new Error("undefined result");
                this.value = value;
                for (var i = 0; i < this.resolvers.length; i++) {
                    this.resolvers[i].call(null, value);
                }
            },
            then: function (resolve) {
                if (this.value === void 0) {
                    this.resolvers.push(resolve);
                }
                else {
                    resolve.call(null, this.value);
                }
            }
        };
    }
    Core.defer = defer;
})(Core = exports.Core || (exports.Core = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29yZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb3JlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFjLElBQUksQ0E4S2pCO0FBOUtELFdBQWMsSUFBSTtJQUNkLGVBQXNCLFlBQVk7UUFDOUIsSUFBSSxFQUFFLEdBQUcsVUFBQSxDQUFDO1lBQ04sRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLFNBQVMsQ0FBQztnQkFDaEIsRUFBRSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUVqQixNQUFNLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BCLENBQUMsQ0FBQztRQUNGLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxZQUFZLENBQUM7UUFDeEIsRUFBRSxDQUFDLFNBQVMsQ0FBQyxHQUFHLGNBQU0sT0FBQSxZQUFZLEVBQVosQ0FBWSxDQUFDO1FBRW5DLE1BQU0sQ0FBQyxFQUFFLENBQUM7SUFDZCxDQUFDO0lBWGUsVUFBSyxRQVdwQixDQUFBO0lBRUQ7UUFBQTtRQXdDQSxDQUFDO1FBdkNVLGFBQU8sR0FBZCxVQUFlLElBQVksRUFBRSxJQUFVO1lBQ25DLElBQUksTUFBTSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1lBQ3RDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDO1lBRXRDLE9BQU8sQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDeEMsTUFBTSxDQUFDLE1BQU0sQ0FBQztRQUNsQixDQUFDO1FBRU0sY0FBUSxHQUFmLFVBQWdCLEtBQWEsRUFBRSxJQUFVO1lBQ3JDLElBQUksTUFBTSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1lBQ3RDLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxHQUFHLEtBQUssQ0FBQyxDQUFDO1lBRS9DLE9BQU8sQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDekMsTUFBTSxDQUFDLE1BQU0sQ0FBQztRQUNsQixDQUFDO1FBRU0sZUFBUyxHQUFoQixVQUFpQixNQUFjLEVBQUUsSUFBVTtZQUN2QyxJQUFJLE1BQU0sR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUN0QyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxNQUFNLENBQUMsQ0FBQztZQUUxQyxPQUFPLENBQUMsS0FBSyxDQUFDLGtCQUFrQixFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQzFDLE1BQU0sQ0FBQyxNQUFNLENBQUM7UUFDbEIsQ0FBQztRQUVNLFdBQUssR0FBWixVQUFhLElBQVU7WUFDbkIsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUMxQixDQUFDO1FBRU0sWUFBTSxHQUFiLFVBQWMsSUFBVTtZQUNwQixNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQzlCLENBQUM7UUFFTSxhQUFPLEdBQWQsVUFBZSxJQUFVO1lBQ3JCLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDM0IsQ0FBQztRQUVNLGdCQUFVLEdBQWpCLFVBQWtCLE1BQU0sRUFBRSxJQUFVO1lBQ2hDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDM0IsQ0FBQztRQUNMLFlBQUM7SUFBRCxDQUFDLEFBeENELElBd0NDO0lBeENZLFVBQUssUUF3Q2pCLENBQUE7SUFFRDtRQUFBO1FBUUEsQ0FBQztRQVBVLE9BQUUsR0FBVCxVQUFVLE1BQU0sRUFBRSxHQUFHO1lBQ2pCLE1BQU0sQ0FBQyxNQUFNLElBQUksR0FBRyxDQUFDO1FBQ3pCLENBQUM7UUFFTSxXQUFNLEdBQWIsVUFBYyxRQUFRLEVBQUUsS0FBSztZQUN6QixPQUFPLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNuQyxDQUFDO1FBQ0wsV0FBQztJQUFELENBQUMsQUFSRCxJQVFDO0lBUlksU0FBSSxPQVFoQixDQUFBO0lBRUQ7UUFBQTtRQStDQSxDQUFDO1FBOUNVLFVBQUssR0FBWixVQUFhLEVBQUUsRUFBRSxJQUFJO1lBQ2pCLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUNOLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDYixJQUFJLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFDZixHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFO2dCQUNoQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ1osTUFBTSxFQUFFLENBQUM7WUFFakIsTUFBTSxDQUFDLE1BQU0sQ0FBQztRQUNsQixDQUFDO1FBRU0sUUFBRyxHQUFWLFVBQVcsRUFBRSxFQUFFLElBQUk7WUFDZixNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3BDLENBQUM7UUFFTSxRQUFHLEdBQVYsVUFBVyxFQUFFLEVBQUUsSUFBSTtZQUNmLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsTUFBTSxDQUFDO1FBQ2hELENBQUM7UUFFTSxXQUFNLEdBQWIsVUFBYyxFQUFFLEVBQUUsSUFBSTtZQUNsQixJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUM7WUFFaEIsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQ25DLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDbkIsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ2IsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDdEIsQ0FBQztZQUNMLENBQUM7WUFFRCxNQUFNLENBQUMsTUFBTSxDQUFDO1FBQ2xCLENBQUM7UUFFTSxRQUFHLEdBQVYsVUFBVyxFQUFFLEVBQUUsSUFBSTtZQUNmLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUNOLE1BQU0sQ0FBQyxFQUFFLENBQUM7WUFFZCxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUN4QixDQUFDO1FBRU0sVUFBSyxHQUFaLFVBQWEsSUFBSTtZQUNiLE1BQU0sQ0FBQyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQztRQUN0QyxDQUFDO1FBRU0sV0FBTSxHQUFiLFVBQWMsRUFBRSxFQUFFLFlBQVksRUFBRSxJQUFJO1lBQ2hDLE1BQU0sQ0FBQyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxZQUFZLENBQUMsQ0FBQztRQUNsRCxDQUFDO1FBQ0wsV0FBQztJQUFELENBQUMsQUEvQ0QsSUErQ0M7SUEvQ1ksU0FBSSxPQStDaEIsQ0FBQTtJQUVELGVBQXNCLElBQUksRUFBRSxPQUFPO1FBRS9CLEVBQUUsQ0FBQyxDQUFDLElBQUksS0FBSyxJQUFJLElBQUksSUFBSSxLQUFLLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO1lBQ2hELE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRTlCLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDO1lBQ2xCLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFFL0MsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFUZSxVQUFLLFFBU3BCLENBQUE7SUFFRCxpQkFBd0IsSUFBSSxFQUFFLE9BQU87UUFDakMsRUFBRSxDQUFDLENBQUMsSUFBSSxLQUFLLEtBQUssQ0FBQyxDQUFDO1lBQ2hCLE1BQU0sSUFBSSxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDakMsRUFBRSxDQUFDLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQztZQUNkLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFekIsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7WUFDZixNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUVqQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztZQUNaLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsT0FBTyxDQUFDLENBQUMsRUFBRSxPQUFPLENBQUMsRUFBbkIsQ0FBbUIsQ0FBQyxDQUFDO1FBRS9DLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDekIsQ0FBQztJQWJlLFlBQU8sVUFhdEIsQ0FBQTtJQUVEO1FBQXdCLGFBQWE7YUFBYixVQUFhLEVBQWIscUJBQWEsRUFBYixJQUFhO1lBQWIsd0JBQWE7O1FBQ2pDLE1BQU0sQ0FBQyxVQUFVLE1BQU07WUFDbkIsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBRXZDLE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztZQUN2QyxDQUFDO1lBQ0QsTUFBTSxDQUFDLE1BQU0sQ0FBQztRQUNsQixDQUFDLENBQUM7SUFDTixDQUFDO0lBUmUsWUFBTyxVQVF0QixDQUFBO0lBRUQ7UUFDSSxNQUFNLENBQUM7WUFDSCxLQUFLLEVBQUUsS0FBSyxDQUFDO1lBQ2IsU0FBUyxFQUFFLEVBQUU7WUFDYixNQUFNLFlBQUMsS0FBSztnQkFDUixFQUFFLENBQUMsQ0FBQyxLQUFLLEtBQUssS0FBSyxDQUFDLENBQUM7b0JBQ2pCLE1BQU0sSUFBSSxLQUFLLENBQUMsa0JBQWtCLENBQUMsQ0FBQztnQkFFeEMsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7Z0JBRW5CLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztvQkFDN0MsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO2dCQUN4QyxDQUFDO1lBQ0wsQ0FBQztZQUNELElBQUksWUFBQyxPQUFPO2dCQUNSLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUN4QixJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDakMsQ0FBQztnQkFBQyxJQUFJLENBQUMsQ0FBQztvQkFDSixPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ25DLENBQUM7WUFDTCxDQUFDO1NBQ0osQ0FBQztJQUNOLENBQUM7SUF0QmUsVUFBSyxRQXNCcEIsQ0FBQTtBQUNMLENBQUMsRUE5S2EsSUFBSSxHQUFKLFlBQUksS0FBSixZQUFJLFFBOEtqQiIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBtb2R1bGUgQ29yZSB7XHJcbiAgICBleHBvcnQgZnVuY3Rpb24gU3RhdGUoaW5pdGlhbFZhbHVlKSB7XHJcbiAgICAgICAgdmFyIGZuID0geCA9PiB7XHJcbiAgICAgICAgICAgIGlmICh4ICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICBmblsnaWQnXSA9IHg7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZm5bJ2lkJ107XHJcbiAgICAgICAgfTtcclxuICAgICAgICBmblsnaWQnXSA9IGluaXRpYWxWYWx1ZTtcclxuICAgICAgICBmblsndmFsdWVPZiddID0gKCkgPT4gaW5pdGlhbFZhbHVlO1xyXG5cclxuICAgICAgICByZXR1cm4gZm47XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIERhdGVzIHtcclxuICAgICAgICBzdGF0aWMgYWRkRGF5cyhkYXlzOiBudW1iZXIsIGRhdGU6IERhdGUpIHtcclxuICAgICAgICAgICAgdmFyIHJldHZhbCA9IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpKTtcclxuICAgICAgICAgICAgcmV0dmFsLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgKyBkYXlzKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoXCJhZGREYXlzIHJlc3VsdFwiLCByZXR2YWwpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmV0dmFsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIGFkZFllYXJzKHllYXJzOiBudW1iZXIsIGRhdGU6IERhdGUpIHtcclxuICAgICAgICAgICAgdmFyIHJldHZhbCA9IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpKTtcclxuICAgICAgICAgICAgcmV0dmFsLnNldEZ1bGxZZWFyKGRhdGUuZ2V0RnVsbFllYXIoKSArIHllYXJzKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoXCJhZGRZZWFycyByZXN1bHRcIiwgcmV0dmFsKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJldHZhbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBhZGRNb250aHMobW9udGhzOiBudW1iZXIsIGRhdGU6IERhdGUpIHtcclxuICAgICAgICAgICAgdmFyIHJldHZhbCA9IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpKTtcclxuICAgICAgICAgICAgcmV0dmFsLnNldE1vbnRoKGRhdGUuZ2V0TW9udGgoKSArIG1vbnRocyk7XHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmRlYnVnKFwiYWRkTW9udGhzIHJlc3VsdFwiLCByZXR2YWwpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmV0dmFsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIGRheU9mKGRhdGU6IERhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGUuZ2V0RGF0ZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIHllYXJPZihkYXRlOiBEYXRlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRlLmdldEZ1bGxZZWFyKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgbW9udGhPZihkYXRlOiBEYXRlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRlLmdldE1vbnRoKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgZm9ybWF0RGF0ZShmb3JtYXQsIGRhdGU6IERhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGUudG9TdHJpbmcoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIE1hdGgge1xyXG4gICAgICAgIHN0YXRpYyBsZShyYXRpbmcsIG1heCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmF0aW5nIDw9IG1heDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBhc3NpZ24ocHJvcGVydHksIHZhbHVlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZGVidWcocHJvcGVydHksIHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIExpc3Qge1xyXG4gICAgICAgIHN0YXRpYyBjb3VudChmbiwgbGlzdCkge1xyXG4gICAgICAgICAgICBpZiAoIWxpc3QpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IDA7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcclxuICAgICAgICAgICAgICAgIGlmIChmbihsaXN0W2ldKSlcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQrKztcclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgYW55KGZuLCBsaXN0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBMaXN0LmNvdW50KGZuLCBsaXN0KSA+IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgYWxsKGZuLCBsaXN0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBMaXN0LmNvdW50KGZuLCBsaXN0KSA9PT0gbGlzdC5sZW5ndGg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgZmlsdGVyKGZuLCBsaXN0KSB7XHJcbiAgICAgICAgICAgIHZhciByZXR2YWwgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBsaXN0W2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKCEhZm4oaXRlbSkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR2YWwucHVzaChpdGVtKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJldHZhbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBtYXAoZm4sIGxpc3QpIHtcclxuICAgICAgICAgICAgaWYgKCFsaXN0KVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGxpc3QubWFwKGZuKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBlbXB0eShsaXN0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAhbGlzdCB8fCBsaXN0Lmxlbmd0aCA9PT0gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyByZWR1Y2UoZm4sIGluaXRpYWxWYWx1ZSwgbGlzdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gIWxpc3QgJiYgbGlzdC5yZWR1Y2UoZm4sIGluaXRpYWxWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGV4cG9ydCBmdW5jdGlvbiByZWFkeShkYXRhLCByZXNvbHZlKSB7XHJcblxyXG4gICAgICAgIGlmIChkYXRhICE9PSBudWxsICYmIGRhdGEgIT09IHZvaWQgMCAmJiAhIWRhdGEudGhlbilcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGEudGhlbihyZXNvbHZlKTtcclxuXHJcbiAgICAgICAgaWYgKCEhcmVzb2x2ZS5leGVjdXRlKVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzb2x2ZS5leGVjdXRlLmNhbGwocmVzb2x2ZSwgZGF0YSk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXNvbHZlLmNhbGwocmVzb2x2ZSwgZGF0YSk7XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGZvckVhY2goZGF0YSwgcmVzb2x2ZSkge1xyXG4gICAgICAgIGlmIChkYXRhID09PSB2b2lkIDApXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInVuZGVmaW5lZFwiKTtcclxuICAgICAgICBpZiAoZGF0YSA9PT0gbnVsbClcclxuICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUobnVsbCk7XHJcblxyXG4gICAgICAgIGlmICghIWRhdGEuZm9yRWFjaClcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGEuZm9yRWFjaChyZXNvbHZlKTtcclxuXHJcbiAgICAgICAgaWYgKCEhZGF0YS50aGVuKVxyXG4gICAgICAgICAgICByZXR1cm4gZGF0YS50aGVuKGQgPT4gZm9yRWFjaChkLCByZXNvbHZlKSk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXNvbHZlKGRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIGV4cG9ydCBmdW5jdGlvbiBjb21wb3NlKC4uLmZuczogYW55W10pOiBGdW5jdGlvbiB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IGZucy5sZW5ndGggLSAxOyBpID4gLTE7IGktLSkge1xyXG4gICAgICAgICAgICAgICAgLy8gUmVTaGFycGVyIGRpc2FibGUgb25jZSBTdXNwaWNpb3VzVGhpc1VzYWdlXHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBmbnNbaV0uY2FsbCh0aGlzLCByZXN1bHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgZnVuY3Rpb24gZGVmZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdmFsdWU6IHZvaWQgMCxcclxuICAgICAgICAgICAgcmVzb2x2ZXJzOiBbXSxcclxuICAgICAgICAgICAgbm90aWZ5KHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IHZvaWQgMClcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ1bmRlZmluZWQgcmVzdWx0XCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucmVzb2x2ZXJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNvbHZlcnNbaV0uY2FsbChudWxsLCB2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHRoZW4ocmVzb2x2ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudmFsdWUgPT09IHZvaWQgMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVzb2x2ZXJzLnB1c2gocmVzb2x2ZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUuY2FsbChudWxsLCB0aGlzLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn0iXX0=