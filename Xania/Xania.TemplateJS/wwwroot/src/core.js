"use strict";
var Core;
(function (Core) {
    function State(initialValue) {
        var fn = function (x) {
            if (x !== undefined)
                fn['id'] = x;
            return fn['id'];
        };
        fn['id'] = initialValue;
        fn['valueOf'] = function () { return initialValue; };
        return fn;
    }
    Core.State = State;
    var Dates = (function () {
        function Dates() {
        }
        Dates.addDays = function (days, date) {
            var retval = new Date(date.getTime());
            retval.setDate(date.getDate() + days);
            console.debug("addDays result", retval);
            return retval;
        };
        Dates.addYears = function (years, date) {
            var retval = new Date(date.getTime());
            retval.setFullYear(date.getFullYear() + years);
            console.debug("addYears result", retval);
            return retval;
        };
        Dates.addMonths = function (months, date) {
            var retval = new Date(date.getTime());
            retval.setMonth(date.getMonth() + months);
            console.debug("addMonths result", retval);
            return retval;
        };
        Dates.dayOf = function (date) {
            return date.getDate();
        };
        Dates.yearOf = function (date) {
            return date.getFullYear();
        };
        Dates.monthOf = function (date) {
            return date.getMonth();
        };
        Dates.formatDate = function (format, date) {
            return date.toString();
        };
        return Dates;
    }());
    Core.Dates = Dates;
    var Math = (function () {
        function Math() {
        }
        Math.le = function (rating, max) {
            return rating <= max;
        };
        Math.assign = function (property, value) {
            console.debug(property, value);
        };
        return Math;
    }());
    Core.Math = Math;
    var List = (function () {
        function List() {
        }
        List.count = function (fn, list) {
            if (!list)
                return 0;
            var result = 0;
            for (var i = 0; i < list.length; i++)
                if (fn(list[i]))
                    result++;
            return result;
        };
        List.any = function (fn, list) {
            return List.count(fn, list) > 0;
        };
        List.all = function (fn, list) {
            return List.count(fn, list) === list.length;
        };
        List.filter = function (fn, list) {
            var retval = [];
            for (var i = 0; i < list.length; i++) {
                var item = list[i];
                if (!!fn(item)) {
                    retval.push(item);
                }
            }
            return retval;
        };
        List.map = function (fn, list) {
            if (!list)
                return [];
            return list.map(fn);
        };
        List.empty = function (list) {
            return !list || list.length === 0;
        };
        List.reduce = function (fn, initialValue, list) {
            return !list && list.reduce(fn, initialValue);
        };
        return List;
    }());
    Core.List = List;
    function ready(data, resolve) {
        if (data !== null && data !== void 0 && !!data.then)
            return data.then(resolve);
        if (!!resolve.execute)
            return resolve.execute.call(resolve, data);
        return resolve.call(resolve, data);
    }
    Core.ready = ready;
    function forEach(data, resolve) {
        if (data === void 0)
            throw new Error("undefined");
        if (data === null)
            return resolve(null);
        if (!!data.forEach)
            return data.forEach(resolve);
        if (!!data.then)
            return data.then(function (d) { return forEach(d, resolve); });
        return resolve(data);
    }
    Core.forEach = forEach;
    function compose() {
        var fns = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            fns[_i] = arguments[_i];
        }
        return function (result) {
            for (var i = fns.length - 1; i > -1; i--) {
                result = fns[i].call(this, result);
            }
            return result;
        };
    }
    Core.compose = compose;
})(Core = exports.Core || (exports.Core = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29yZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb3JlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFjLElBQUksQ0F1SmpCO0FBdkpELFdBQWMsSUFBSTtJQUNkLGVBQXNCLFlBQVk7UUFDOUIsSUFBSSxFQUFFLEdBQUcsVUFBVSxDQUFDO1lBQ2hCLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxTQUFTLENBQUM7Z0JBQ2hCLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFakIsTUFBTSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNwQixDQUFDLENBQUM7UUFDRixFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsWUFBWSxDQUFDO1FBQ3hCLEVBQUUsQ0FBQyxTQUFTLENBQUMsR0FBRyxjQUFNLE9BQUEsWUFBWSxFQUFaLENBQVksQ0FBQztRQUVuQyxNQUFNLENBQUMsRUFBRSxDQUFDO0lBQ2QsQ0FBQztJQVhlLFVBQUssUUFXcEIsQ0FBQTtJQUVEO1FBQUE7UUF3Q0EsQ0FBQztRQXZDVSxhQUFPLEdBQWQsVUFBZSxJQUFZLEVBQUUsSUFBVTtZQUNuQyxJQUFJLE1BQU0sR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUN0QyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQztZQUV0QyxPQUFPLENBQUMsS0FBSyxDQUFDLGdCQUFnQixFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ3hDLE1BQU0sQ0FBQyxNQUFNLENBQUM7UUFDbEIsQ0FBQztRQUVNLGNBQVEsR0FBZixVQUFnQixLQUFhLEVBQUUsSUFBVTtZQUNyQyxJQUFJLE1BQU0sR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUN0QyxNQUFNLENBQUMsV0FBVyxDQUFDLElBQUksQ0FB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LENBQUM7WUFDdkMsQ0FBQztZQUNELE1BQU0sQ0FBQyxNQUFNLENBQUM7UUFDbEIsQ0FBQyxDQUFDO0lBQ04sQ0FBQztJQVJlLFlBQU8sVUFRdEIsQ0FBQTtBQUVMLENBQUMsRUF2SmEsSUFBSSxHQUFKLFlBQUksS0FBSixZQUFJLFFBdUpqQiIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBtb2R1bGUgQ29yZSB7XHJcbiAgICBleHBvcnQgZnVuY3Rpb24gU3RhdGUoaW5pdGlhbFZhbHVlKSB7XHJcbiAgICAgICAgdmFyIGZuID0gZnVuY3Rpb24gKHgpIHtcclxuICAgICAgICAgICAgaWYgKHggIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgIGZuWydpZCddID0geDtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBmblsnaWQnXTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGZuWydpZCddID0gaW5pdGlhbFZhbHVlO1xyXG4gICAgICAgIGZuWyd2YWx1ZU9mJ10gPSAoKSA9PiBpbml0aWFsVmFsdWU7XHJcblxyXG4gICAgICAgIHJldHVybiBmbjtcclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgY2xhc3MgRGF0ZXMge1xyXG4gICAgICAgIHN0YXRpYyBhZGREYXlzKGRheXM6IG51bWJlciwgZGF0ZTogRGF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgcmV0dmFsID0gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkpO1xyXG4gICAgICAgICAgICByZXR2YWwuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIGRheXMpO1xyXG5cclxuICAgICAgICAgICAgY29uc29sZS5kZWJ1ZyhcImFkZERheXMgcmVzdWx0XCIsIHJldHZhbCk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXR2YWw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgYWRkWWVhcnMoeWVhcnM6IG51bWJlciwgZGF0ZTogRGF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgcmV0dmFsID0gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkpO1xyXG4gICAgICAgICAgICByZXR2YWwuc2V0RnVsbFllYXIoZGF0ZS5nZXRGdWxsWWVhcigpICsgeWVhcnMpO1xyXG5cclxuICAgICAgICAgICAgY29uc29sZS5kZWJ1ZyhcImFkZFllYXJzIHJlc3VsdFwiLCByZXR2YWwpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmV0dmFsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIGFkZE1vbnRocyhtb250aHM6IG51bWJlciwgZGF0ZTogRGF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgcmV0dmFsID0gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkpO1xyXG4gICAgICAgICAgICByZXR2YWwuc2V0TW9udGgoZGF0ZS5nZXRNb250aCgpICsgbW9udGhzKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoXCJhZGRNb250aHMgcmVzdWx0XCIsIHJldHZhbCk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXR2YWw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgZGF5T2YoZGF0ZTogRGF0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0ZS5nZXREYXRlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgeWVhck9mKGRhdGU6IERhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGUuZ2V0RnVsbFllYXIoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBtb250aE9mKGRhdGU6IERhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGUuZ2V0TW9udGgoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBmb3JtYXREYXRlKGZvcm1hdCwgZGF0ZTogRGF0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0ZS50b1N0cmluZygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgY2xhc3MgTWF0aCB7XHJcbiAgICAgICAgc3RhdGljIGxlKHJhdGluZywgbWF4KSB7XHJcbiAgICAgICAgICAgIHJldHVybiByYXRpbmcgPD0gbWF4O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIGFzc2lnbihwcm9wZXJ0eSwgdmFsdWUpIHtcclxuICAgICAgICAgICAgY29uc29sZS5kZWJ1Zyhwcm9wZXJ0eSwgdmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgY2xhc3MgTGlzdCB7XHJcbiAgICAgICAgc3RhdGljIGNvdW50KGZuLCBsaXN0KSB7XHJcbiAgICAgICAgICAgIGlmICghbGlzdClcclxuICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gMDtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICAgICAgaWYgKGZuKGxpc3RbaV0pKVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCsrO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBhbnkoZm4sIGxpc3QpIHtcclxuICAgICAgICAgICAgcmV0dXJuIExpc3QuY291bnQoZm4sIGxpc3QpID4gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBhbGwoZm4sIGxpc3QpIHtcclxuICAgICAgICAgICAgcmV0dXJuIExpc3QuY291bnQoZm4sIGxpc3QpID09PSBsaXN0Lmxlbmd0aDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBmaWx0ZXIoZm4sIGxpc3QpIHtcclxuICAgICAgICAgICAgdmFyIHJldHZhbCA9IFtdO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IGxpc3RbaV07XHJcbiAgICAgICAgICAgICAgICBpZiAoISFmbihpdGVtKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHZhbC5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmV0dmFsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIG1hcChmbiwgbGlzdCkge1xyXG4gICAgICAgICAgICBpZiAoIWxpc3QpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gW107XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbGlzdC5tYXAoZm4pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIGVtcHR5KGxpc3QpIHtcclxuICAgICAgICAgICAgcmV0dXJuICFsaXN0IHx8IGxpc3QubGVuZ3RoID09PSAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIHJlZHVjZShmbiwgaW5pdGlhbFZhbHVlLCBsaXN0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAhbGlzdCAmJiBsaXN0LnJlZHVjZShmbiwgaW5pdGlhbFZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIHJlYWR5KGRhdGEsIHJlc29sdmUpIHtcclxuXHJcbiAgICAgICAgaWYgKGRhdGEgIT09IG51bGwgJiYgZGF0YSAhPT0gdm9pZCAwICYmICEhZGF0YS50aGVuKVxyXG4gICAgICAgICAgICByZXR1cm4gZGF0YS50aGVuKHJlc29sdmUpO1xyXG5cclxuICAgICAgICBpZiAoISFyZXNvbHZlLmV4ZWN1dGUpXHJcbiAgICAgICAgICAgIHJldHVybiByZXNvbHZlLmV4ZWN1dGUuY2FsbChyZXNvbHZlLCBkYXRhKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc29sdmUuY2FsbChyZXNvbHZlLCBkYXRhKTtcclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgZnVuY3Rpb24gZm9yRWFjaChkYXRhLCByZXNvbHZlKSB7XHJcbiAgICAgICAgaWYgKGRhdGEgPT09IHZvaWQgMClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwidW5kZWZpbmVkXCIpO1xyXG4gICAgICAgIGlmIChkYXRhID09PSBudWxsKVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShudWxsKTtcclxuXHJcbiAgICAgICAgaWYgKCEhZGF0YS5mb3JFYWNoKVxyXG4gICAgICAgICAgICByZXR1cm4gZGF0YS5mb3JFYWNoKHJlc29sdmUpO1xyXG5cclxuICAgICAgICBpZiAoISFkYXRhLnRoZW4pXHJcbiAgICAgICAgICAgIHJldHVybiBkYXRhLnRoZW4oZCA9PiBmb3JFYWNoKGQsIHJlc29sdmUpKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc29sdmUoZGF0YSk7XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGNvbXBvc2UoLi4uZm5zOiBhbnlbXSk6IEZ1bmN0aW9uIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gZm5zLmxlbmd0aCAtIDE7IGkgPiAtMTsgaS0tKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBSZVNoYXJwZXIgZGlzYWJsZSBvbmNlIFN1c3BpY2lvdXNUaGlzVXNhZ2VcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZuc1tpXS5jYWxsKHRoaXMsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxufSJdfQ==