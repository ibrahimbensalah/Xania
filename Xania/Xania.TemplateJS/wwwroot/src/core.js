"use strict";
var Core;
(function (Core) {
    function State(initialValue) {
        var fn = function (x) {
            if (x !== undefined)
                fn['id'] = x;
            return fn['id'];
        };
        fn['id'] = initialValue;
        fn['valueOf'] = function () { return initialValue; };
        return fn;
    }
    Core.State = State;
    var Dates = (function () {
        function Dates() {
        }
        Dates.addDays = function (days, date) {
            var retval = new Date(date.getTime());
            retval.setDate(date.getDate() + days);
            console.debug("addDays result", retval);
            return retval;
        };
        Dates.addYears = function (years, date) {
            var retval = new Date(date.getTime());
            retval.setFullYear(date.getFullYear() + years);
            console.debug("addYears result", retval);
            return retval;
        };
        Dates.addMonths = function (months, date) {
            var retval = new Date(date.getTime());
            retval.setMonth(date.getMonth() + months);
            console.debug("addMonths result", retval);
            return retval;
        };
        Dates.dayOf = function (date) {
            return date.getDate();
        };
        Dates.yearOf = function (date) {
            return date.getFullYear();
        };
        Dates.monthOf = function (date) {
            return date.getMonth();
        };
        Dates.formatDate = function (format, date) {
            return date.toString();
        };
        return Dates;
    }());
    Core.Dates = Dates;
    var Math = (function () {
        function Math() {
        }
        Math.le = function (rating, max) {
            return rating <= max;
        };
        Math.assign = function (property, value) {
            console.debug(property, value);
        };
        return Math;
    }());
    Core.Math = Math;
    var List = (function () {
        function List() {
        }
        List.count = function (fn, list) {
            if (!list)
                return 0;
            var result = 0;
            for (var i = 0; i < list.length; i++)
                if (fn(list[i]))
                    result++;
            return result;
        };
        List.any = function (fn, list) {
            return List.count(fn, list) > 0;
        };
        List.all = function (fn, list) {
            return List.count(fn, list) === list.length;
        };
        List.filter = function (fn, list) {
            var retval = [];
            for (var i = 0; i < list.length; i++) {
                var item = list[i];
                if (!!fn(item)) {
                    retval.push(item);
                }
            }
            return retval;
        };
        List.map = function (fn, list) {
            if (!list)
                return [];
            return list.map(fn);
        };
        List.empty = function (list) {
            return !list || list.length === 0;
        };
        List.reduce = function (fn, initialValue, list) {
            return !list && list.reduce(fn, initialValue);
        };
        return List;
    }());
    Core.List = List;
    function ready(data, resolve) {
        if (data !== null && data !== void 0 && !!data.then)
            return data.then(resolve);
        if (!!resolve.execute)
            return resolve.execute.call(resolve, data);
        return resolve.call(resolve, data);
    }
    Core.ready = ready;
    function forEach(data, resolve) {
        if (data === void 0)
            throw new Error("undefined");
        if (data === null)
            return resolve(null);
        if (!!data.forEach)
            return data.forEach(resolve);
        if (!!data.then)
            return data.then(function (d) { return forEach(d, resolve); });
        return resolve(data);
    }
    Core.forEach = forEach;
})(Core = exports.Core || (exports.Core = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29yZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb3JlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFjLElBQUksQ0E2SWpCO0FBN0lELFdBQWMsSUFBSTtJQUNkLGVBQXNCLFlBQVk7UUFDOUIsSUFBSSxFQUFFLEdBQUcsVUFBVSxDQUFDO1lBQ2hCLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxTQUFTLENBQUM7Z0JBQ2hCLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFakIsTUFBTSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNwQixDQUFDLENBQUM7UUFDRixFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsWUFBWSxDQUFDO1FBQ3hCLEVBQUUsQ0FBQyxTQUFTLENBQUMsR0FBRyxjQUFNLE9BQUEsWUFBWSxFQUFaLENBQVksQ0FBQztRQUVuQyxNQUFNLENBQUMsRUFBRSxDQUFDO0lBQ2QsQ0FBQztJQVhlLFVBQUssUUFXcEIsQ0FBQTtJQUVEO1FBQUE7UUF3Q0EsQ0FBQztRQXZDVSxhQUFPLEdBQWQsVUFBZSxJQUFZLEVBQUUsSUFBVTtZQUNuQyxJQUFJLE1BQU0sR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUN0QyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQztZQUV0QyxPQUFPLENBQUMsS0FBSyxDQUFDLGdCQUFnQixFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ3hDLE1BQU0sQ0FBQyxNQUFNLENBQUM7UUFDbEIsQ0FBQztRQUVNLGNBQVEsR0FBZixVQUFnQixLQUFhLEVBQUUsSUFBVTtZQUNyQyxJQUFJLE1BQU0sR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUN0QyxNQUFNLENBQUMsV0FBVyxDQUFDLElBQUksQ0FB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QUksQ0FBQyxDQUFDO1FBRS9DLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBVGUsVUFBSyxRQVNwQixDQUFBO0lBRUQsaUJBQXdCLElBQUksRUFBRSxPQUFPO1FBQ2pDLEVBQUUsQ0FBQyxDQUFDLElBQUksS0FBSyxLQUFLLENBQUMsQ0FBQztZQUNoQixNQUFNLElBQUksS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ2pDLEVBQUUsQ0FBQyxDQUFDLElBQUksS0FBSyxJQUFJLENBQUM7WUFDZCxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRXpCLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ2YsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFakMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7WUFDWixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLE9BQU8sQ0FBQyxDQUFDLEVBQUUsT0FBTyxDQUFDLEVBQW5CLENBQW1CLENBQUMsQ0FBQztRQUUvQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3pCLENBQUM7SUFiZSxZQUFPLFVBYXRCLENBQUE7QUFFTCxDQUFDLEVBN0lhLElBQUksR0FBSixZQUFJLEtBQUosWUFBSSxRQTZJakIiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgbW9kdWxlIENvcmUge1xyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIFN0YXRlKGluaXRpYWxWYWx1ZSkge1xyXG4gICAgICAgIHZhciBmbiA9IGZ1bmN0aW9uICh4KSB7XHJcbiAgICAgICAgICAgIGlmICh4ICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICBmblsnaWQnXSA9IHg7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZm5bJ2lkJ107XHJcbiAgICAgICAgfTtcclxuICAgICAgICBmblsnaWQnXSA9IGluaXRpYWxWYWx1ZTtcclxuICAgICAgICBmblsndmFsdWVPZiddID0gKCkgPT4gaW5pdGlhbFZhbHVlO1xyXG5cclxuICAgICAgICByZXR1cm4gZm47XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIERhdGVzIHtcclxuICAgICAgICBzdGF0aWMgYWRkRGF5cyhkYXlzOiBudW1iZXIsIGRhdGU6IERhdGUpIHtcclxuICAgICAgICAgICAgdmFyIHJldHZhbCA9IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpKTtcclxuICAgICAgICAgICAgcmV0dmFsLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgKyBkYXlzKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoXCJhZGREYXlzIHJlc3VsdFwiLCByZXR2YWwpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmV0dmFsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIGFkZFllYXJzKHllYXJzOiBudW1iZXIsIGRhdGU6IERhdGUpIHtcclxuICAgICAgICAgICAgdmFyIHJldHZhbCA9IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpKTtcclxuICAgICAgICAgICAgcmV0dmFsLnNldEZ1bGxZZWFyKGRhdGUuZ2V0RnVsbFllYXIoKSArIHllYXJzKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoXCJhZGRZZWFycyByZXN1bHRcIiwgcmV0dmFsKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJldHZhbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBhZGRNb250aHMobW9udGhzOiBudW1iZXIsIGRhdGU6IERhdGUpIHtcclxuICAgICAgICAgICAgdmFyIHJldHZhbCA9IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpKTtcclxuICAgICAgICAgICAgcmV0dmFsLnNldE1vbnRoKGRhdGUuZ2V0TW9udGgoKSArIG1vbnRocyk7XHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmRlYnVnKFwiYWRkTW9udGhzIHJlc3VsdFwiLCByZXR2YWwpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmV0dmFsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIGRheU9mKGRhdGU6IERhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGUuZ2V0RGF0ZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIHllYXJPZihkYXRlOiBEYXRlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRlLmdldEZ1bGxZZWFyKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgbW9udGhPZihkYXRlOiBEYXRlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRlLmdldE1vbnRoKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgZm9ybWF0RGF0ZShmb3JtYXQsIGRhdGU6IERhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGUudG9TdHJpbmcoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIE1hdGgge1xyXG4gICAgICAgIHN0YXRpYyBsZShyYXRpbmcsIG1heCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmF0aW5nIDw9IG1heDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBhc3NpZ24ocHJvcGVydHksIHZhbHVlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZGVidWcocHJvcGVydHksIHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIExpc3Qge1xyXG4gICAgICAgIHN0YXRpYyBjb3VudChmbiwgbGlzdCkge1xyXG4gICAgICAgICAgICBpZiAoIWxpc3QpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IDA7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcclxuICAgICAgICAgICAgICAgIGlmIChmbihsaXN0W2ldKSlcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQrKztcclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgYW55KGZuLCBsaXN0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBMaXN0LmNvdW50KGZuLCBsaXN0KSA+IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgYWxsKGZuLCBsaXN0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBMaXN0LmNvdW50KGZuLCBsaXN0KSA9PT0gbGlzdC5sZW5ndGg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgZmlsdGVyKGZuLCBsaXN0KSB7XHJcbiAgICAgICAgICAgIHZhciByZXR2YWwgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBsaXN0W2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKCEhZm4oaXRlbSkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR2YWwucHVzaChpdGVtKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJldHZhbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBtYXAoZm4sIGxpc3QpIHtcclxuICAgICAgICAgICAgaWYgKCFsaXN0KVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGxpc3QubWFwKGZuKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBlbXB0eShsaXN0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAhbGlzdCB8fCBsaXN0Lmxlbmd0aCA9PT0gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyByZWR1Y2UoZm4sIGluaXRpYWxWYWx1ZSwgbGlzdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gIWxpc3QgJiYgbGlzdC5yZWR1Y2UoZm4sIGluaXRpYWxWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGV4cG9ydCBmdW5jdGlvbiByZWFkeShkYXRhLCByZXNvbHZlKSB7XHJcblxyXG4gICAgICAgIGlmIChkYXRhICE9PSBudWxsICYmIGRhdGEgIT09IHZvaWQgMCAmJiAhIWRhdGEudGhlbilcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGEudGhlbihyZXNvbHZlKTtcclxuXHJcbiAgICAgICAgaWYgKCEhcmVzb2x2ZS5leGVjdXRlKVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzb2x2ZS5leGVjdXRlLmNhbGwocmVzb2x2ZSwgZGF0YSk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXNvbHZlLmNhbGwocmVzb2x2ZSwgZGF0YSk7XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGZvckVhY2goZGF0YSwgcmVzb2x2ZSkge1xyXG4gICAgICAgIGlmIChkYXRhID09PSB2b2lkIDApXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInVuZGVmaW5lZFwiKTtcclxuICAgICAgICBpZiAoZGF0YSA9PT0gbnVsbClcclxuICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUobnVsbCk7XHJcblxyXG4gICAgICAgIGlmICghIWRhdGEuZm9yRWFjaClcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGEuZm9yRWFjaChyZXNvbHZlKTtcclxuXHJcbiAgICAgICAgaWYgKCEhZGF0YS50aGVuKVxyXG4gICAgICAgICAgICByZXR1cm4gZGF0YS50aGVuKGQgPT4gZm9yRWFjaChkLCByZXNvbHZlKSk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXNvbHZlKGRhdGEpO1xyXG4gICAgfVxyXG5cclxufSJdfQ==