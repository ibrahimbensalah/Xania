"use strict";
var template_1 = require("./template");
var Loader;
(function (Loader) {
    function domReady(fn) {
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i];
        }
        if (document.readyState !== "loading") {
            fn.apply(null, args);
        }
        else {
            document.addEventListener("DOMContentLoaded", function () { return fn.apply(null, args); });
        }
    }
    function init(root) {
        var stack = [root];
        while (stack.length > 0) {
            var dom = stack.pop();
            if (!!dom["content"] && !!dom.attributes["name"]) {
                var name = dom.attributes["name"].value;
                var parts = name.split('.');
                var module = require(parts[0]);
                var component = module[parts[1]];
                console.log(component);
            }
            else {
                for (var i = 0; i < dom.childNodes.length; i++) {
                    var child = dom.childNodes[i];
                    if (child.nodeType === 1)
                        stack.push(child);
                }
            }
        }
    }
    Loader.init = init;
    function bind(dom, store) {
    }
    Loader.bind = bind;
    function parseDom(rootDom) {
        var stack = [];
        var i;
        var rootTpl;
        stack.push({
            node: rootDom,
            push: function (e) {
                rootTpl = e;
            }
        });
        while (stack.length > 0) {
            var cur = stack.pop();
            var node = cur.node;
            var push = cur.push;
            if (!!node["content"]) {
                var elt = node["content"];
                var template = new template_1.Template.ContentTemplate(node.attributes["model"]);
                for (i = elt.childNodes.length - 1; i >= 0; i--) {
                    stack.push({ node: elt.childNodes[i], push: template.child.bind(template) });
                }
                push(template);
            }
            else if (node.nodeType === 1) {
                var elt = node;
                var template_2 = new template_1.Template.TagTemplate(elt.tagName, elt.namespaceURI);
                for (i = 0; !!elt.attributes && i < elt.attributes.length; i++) {
                    var attribute = elt.attributes[i];
                    this.parseAttr(template_2, attribute);
                }
                for (i = elt.childNodes.length - 1; i >= 0; i--) {
                    stack.push({ node: elt.childNodes[i], push: template_2.addChild.bind(template_2) });
                }
                push(template_2);
            }
            else if (node.nodeType === 3) {
                var textContent = node.textContent;
                if (textContent.trim().length > 0) {
                    var tpl = this.compile(textContent);
                    push(new template_1.Template.TextTemplate(tpl || node.textContent));
                }
            }
        }
        return rootTpl;
    }
    domReady(init, document.body);
})(Loader || (Loader = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9hZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2xvYWRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBS0EsdUNBQXFDO0FBSXJDLElBQU8sTUFBTSxDQXNIWjtBQXRIRCxXQUFPLE1BQU07SUFHVCxrQkFBa0IsRUFBRTtRQUFFLGNBQWM7YUFBZCxVQUFjLEVBQWQscUJBQWMsRUFBZCxJQUFjO1lBQWQsNkJBQWM7O1FBQ2hDLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxVQUFVLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztZQUNwQyxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUN6QixDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDSixRQUFRLENBQUMsZ0JBQWdCLENBQUMsa0JBQWtCLEVBQUUsY0FBTSxPQUFBLEVBQUUsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFwQixDQUFvQixDQUFDLENBQUM7UUFDOUUsQ0FBQztJQUNMLENBQUM7SUFFRCxjQUFxQixJQUFJO1FBSXJCLElBQUksS0FBSyxHQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFM0IsT0FBTyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3RCLElBQUksR0FBRyxHQUFHLEtBQUssQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUV0QixFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDL0MsSUFBSSxJQUFJLEdBQUcsR0FBRyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFLLENBQUM7Z0JBSXhDLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBRTVCLElBQUksTUFB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ZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJkb20udHNcIiAvPlxyXG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiZnNoYXJwLnRzXCIgLz5cclxuaW1wb3J0IHsgRG9tIH0gZnJvbSBcIi4vZG9tXCJcclxuaW1wb3J0IHsgUmVhY3RpdmUgYXMgUmUgfSBmcm9tICcuL3JlYWN0aXZlJ1xyXG5pbXBvcnQgeyBDb3JlIH0gZnJvbSAnLi9jb3JlJ1xyXG5pbXBvcnQgeyBUZW1wbGF0ZSB9IGZyb20gXCIuL3RlbXBsYXRlXCJcclxuXHJcbmRlY2xhcmUgZnVuY3Rpb24gcmVxdWlyZShtb2R1bGU6IHN0cmluZyk7XHJcblxyXG5tb2R1bGUgTG9hZGVyIHtcclxuICAgIGRlY2xhcmUgdmFyIGRvY3VtZW50OiBhbnk7XHJcblxyXG4gICAgZnVuY3Rpb24gZG9tUmVhZHkoZm4sIC4uLmFyZ3M6IGFueVtdKSB7XHJcbiAgICAgICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgIT09IFwibG9hZGluZ1wiKSB7XHJcbiAgICAgICAgICAgIGZuLmFwcGx5KG51bGwsIGFyZ3MpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+IGZuLmFwcGx5KG51bGwsIGFyZ3MpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGluaXQocm9vdCkge1xyXG5cclxuICAgICAgICAvLyAgICB2YXIgY29udGFpbmVyID0gbmV3IERhdGEuT2JqZWN0Q29udGFpbmVyKCk7XHJcbiAgICAgICAgLy8gICAgLy8gRmluZCB0b3AgbGV2ZWwgY29tcG9uZW50cyBhbmQgYmluZFxyXG4gICAgICAgIHZhciBzdGFjazogTm9kZVtdID0gW3Jvb3RdO1xyXG5cclxuICAgICAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB2YXIgZG9tID0gc3RhY2sucG9wKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoISFkb21bXCJjb250ZW50XCJdICYmICEhZG9tLmF0dHJpYnV0ZXNbXCJuYW1lXCJdKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IGRvbS5hdHRyaWJ1dGVzW1wibmFtZVwiXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIC8vIGxldCBtb2RlbCA9IGV2YWwoJygnICsgbmFtZUF0dHIudmFsdWUgKyAnKScpO1xyXG4gICAgICAgICAgICAgICAgLy8gdmFyIHN0b3JlID0gbmV3IFJlLlN0b3JlKG1vZGVsLCBbQ29yZS5MaXN0LCBDb3JlLk1hdGgsIENvcmUuRGF0ZXNdLnJlZHVjZSgoeCwgeSkgPT4gT2JqZWN0LmFzc2lnbih4LCB5KSwge30pKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcGFydHMgPSBuYW1lLnNwbGl0KCcuJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIG1vZHVsZSA9IHJlcXVpcmUocGFydHNbMF0pO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbXBvbmVudCA9IG1vZHVsZVtwYXJ0c1sxXV07XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coY29tcG9uZW50KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBwYXJzZURvbShkb20pO1xyXG4gICAgICAgICAgICAgICAgLy8gRG9tLmJpbmQoZG9tLCBzdG9yZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9pZiAoISFtb2RlbC5pbml0KSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICBtb2RlbC5pbml0KHN0b3JlKTtcclxuICAgICAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICAgICAgLy99IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgdmFyIG5hbWUgPSBkb20ubm9kZU5hbWUucmVwbGFjZSgvXFwtLywgXCJcIikudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgICAgIC8vICAgIGxldCBtb2RlbCA9IGNvbnRhaW5lci5nZXQobmFtZSk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICBpZiAobW9kZWwgIT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkb20uYXR0cmlidXRlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICB2YXIgYXR0ciA9IGRvbS5hdHRyaWJ1dGVzLml0ZW0oaSk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgIG1vZGVsW2F0dHIubmFtZV0gPSBldmFsKGF0dHIudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vICAgICAgICBsZXQgdGVtcGxhdGUgPSBkb207XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgRG9tLmltcG9ydFZpZXcoZG9tLm5vZGVOYW1lICsgXCIuaHRtbFwiKVxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAudGhlbihkb20gPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gbmV3IERhdGEuU3RvcmUobW9kZWwsXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgW0NvcmUuTGlzdCwgQ29yZS5NYXRoLCBDb3JlLkRhdGVzXS5yZWR1Y2UoKHgsIHkpID0+IE9iamVjdC5hc3NpZ24oeCwgeSksIHt9KSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgdmFyIGZyYWdtZW50ID0gRG9tLmJpbmQoZG9tLCBzdG9yZSk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICB0ZW1wbGF0ZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShmcmFnbWVudCwgdGVtcGxhdGUpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZG9tLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGQgPSBkb20uY2hpbGROb2Rlc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQubm9kZVR5cGUgPT09IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goY2hpbGQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGV4cG9ydCBmdW5jdGlvbiBiaW5kKGRvbTogTm9kZSwgc3RvcmU6IFJlLlN0b3JlKSB7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHBhcnNlRG9tKHJvb3REb206IE5vZGUpOiBUZW1wbGF0ZS5JTm9kZSB7XHJcbiAgICAgICAgY29uc3Qgc3RhY2sgPSBbXTtcclxuICAgICAgICBsZXQgaTogbnVtYmVyO1xyXG4gICAgICAgIHZhciByb290VHBsO1xyXG4gICAgICAgIHN0YWNrLnB1c2goe1xyXG4gICAgICAgICAgICBub2RlOiByb290RG9tLFxyXG4gICAgICAgICAgICBwdXNoKGUpIHtcclxuICAgICAgICAgICAgICAgIHJvb3RUcGwgPSBlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHdoaWxlIChzdGFjay5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGN1ciA9IHN0YWNrLnBvcCgpO1xyXG4gICAgICAgICAgICBjb25zdCBub2RlOiBOb2RlID0gY3VyLm5vZGU7XHJcbiAgICAgICAgICAgIGNvbnN0IHB1c2ggPSBjdXIucHVzaDtcclxuXHJcbiAgICAgICAgICAgIGlmICghIW5vZGVbXCJjb250ZW50XCJdKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBlbHQgPSA8SFRNTEVsZW1lbnQ+bm9kZVtcImNvbnRlbnRcIl07XHJcbiAgICAgICAgICAgICAgICB2YXIgdGVtcGxhdGUgPSBuZXcgVGVtcGxhdGUuQ29udGVudFRlbXBsYXRlKG5vZGUuYXR0cmlidXRlc1tcIm1vZGVsXCJdKTtcclxuICAgICAgICAgICAgICAgIGZvciAoaSA9IGVsdC5jaGlsZE5vZGVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhY2sucHVzaCh7IG5vZGU6IGVsdC5jaGlsZE5vZGVzW2ldLCBwdXNoOiB0ZW1wbGF0ZS5jaGlsZC5iaW5kKHRlbXBsYXRlKSB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHB1c2godGVtcGxhdGUpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKG5vZGUubm9kZVR5cGUgPT09IDEpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGVsdCA9IDxIVE1MRWxlbWVudD5ub2RlO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGVtcGxhdGUgPSBuZXcgVGVtcGxhdGUuVGFnVGVtcGxhdGUoZWx0LnRhZ05hbWUsIGVsdC5uYW1lc3BhY2VVUkkpO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7ICEhZWx0LmF0dHJpYnV0ZXMgJiYgaSA8IGVsdC5hdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IGVsdC5hdHRyaWJ1dGVzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyc2VBdHRyKHRlbXBsYXRlLCBhdHRyaWJ1dGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGZvciAoaSA9IGVsdC5jaGlsZE5vZGVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhY2sucHVzaCh7IG5vZGU6IGVsdC5jaGlsZE5vZGVzW2ldLCBwdXNoOiB0ZW1wbGF0ZS5hZGRDaGlsZC5iaW5kKHRlbXBsYXRlKSB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHB1c2godGVtcGxhdGUpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKG5vZGUubm9kZVR5cGUgPT09IDMpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0ZXh0Q29udGVudCA9IG5vZGUudGV4dENvbnRlbnQ7XHJcbiAgICAgICAgICAgICAgICBpZiAodGV4dENvbnRlbnQudHJpbSgpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB0cGwgPSB0aGlzLmNvbXBpbGUodGV4dENvbnRlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHB1c2gobmV3IFRlbXBsYXRlLlRleHRUZW1wbGF0ZSh0cGwgfHwgbm9kZS50ZXh0Q29udGVudCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcm9vdFRwbDtcclxuICAgIH1cclxuXHJcbiAgICBkb21SZWFkeShpbml0LCBkb2N1bWVudC5ib2R5KTtcclxufSJdfQ==