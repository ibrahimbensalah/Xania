"use strict";
var xania_1 = require("../../src/xania");
var anim_1 = require("../../src/anim");
require("./app.css");
var BallsApp = (function () {
    function BallsApp() {
        var _this = this;
        this.balls = [];
        this.onShuffle = function () {
            for (var i = 0; i < _this.balls.length; i++) {
                var e = Math.floor(Math.random() * _this.balls.length);
                if (e !== i) {
                    var t = _this.balls[i].idx;
                    _this.balls[i].idx = _this.balls[e].idx;
                    _this.balls[e].idx = t;
                }
            }
        };
        for (var i = 0; i < 16; i++) {
            var rgb = [100, 100, 100]
                .map(function (x) { return x + Math.random() * 150; })
                .map(Math.floor);
            this.balls.push(new Ball(i, "rgb(" + rgb.join(", ") + ")"));
        }
    }
    BallsApp.translate3d = function (idx, pressed) {
        var x = (idx % 4) * 70;
        var y = Math.floor(idx / 4) * 70;
        var s = pressed ? 1.2 : 1;
        return "translate3d(" + x + "px, " + y + "px, 0px) scale(" + s + ")";
    };
    BallsApp.initial = function (ball) {
        return this.translate3d(ball.idx, ball.pressed);
    };
    BallsApp.prototype.drag = function (event, ball, state) {
        var offsetX = event.offsetX, offsetY = event.offsetY;
        var node = event.target;
        var marginLeft, marginTop, dLeft, dTop, ballIdx;
        if (state && node.style.marginTop !== 0 && node.style.marginLeft !== 0) {
            marginLeft = state.marginLeft;
            marginTop = state.marginTop;
            dLeft = state.dLeft;
            dTop = state.dTop;
            ballIdx = state.ballIdx;
        }
        else {
            dLeft = offsetX - 25;
            dTop = offsetY - 25;
            marginLeft = 0;
            marginTop = 0;
            ballIdx = ball.idx;
        }
        marginLeft += offsetX - 25 - dLeft;
        marginTop += offsetY - 25 - dTop;
        node.style.marginLeft = marginLeft + "px";
        node.style.marginTop = marginTop + "px";
        node.style.zIndex = 100;
        var x = marginLeft + (ball.idx % 4) * 70;
        var y = marginTop + Math.floor(ball.idx / 4) * 70;
        var col = Math.max(0, Math.min(3, Math.round(x / 70)));
        var row = Math.max(0, Math.min(3, Math.round(y / 70)));
        var newBallIdx = col + row * 4;
        if (ballIdx !== newBallIdx) {
            for (var i = 0; i < this.balls.length; i++) {
                var b = this.balls[i];
                if (ball !== b && b.idx === newBallIdx)
                    b.idx = ballIdx;
            }
            ballIdx = newBallIdx;
        }
        return { marginTop: marginTop, marginLeft: marginLeft, dLeft: dLeft, dTop: dTop, ballIdx: ballIdx };
    };
    BallsApp.prototype.release = function (event, ball) {
        if (ball.pressed) {
            ball.pressed = false;
        }
        var node = event.target;
        var top = node.style.marginTop;
        var left = node.style.marginLeft;
        node.style.marginTop = 0;
        node.style.marginLeft = 0;
        node.style.zIndex = 10;
        for (var i = 0; i < this.balls.length; i++) {
            if (!this.balls.find(function (b) { return b.idx === i; })) {
                var x = (ball.idx % 4) * 70;
                var y = Math.floor(ball.idx / 4) * 70;
                var transform = "translate3d(" + left + ", " + top + ", 0) translate3d(" + x + "px, " + y + "px, 0px) scale(1.2)";
                node.style.transform = transform;
                ball.idx = i;
                break;
            }
        }
    };
    BallsApp.prototype.view = function (xania) {
        return (xania.tag("div", { className: "balls-outer" },
            xania.tag("div", null,
                xania.tag("button", { onClick: this.onShuffle }, "shuffle")),
            xania.tag("div", { className: "demo2" },
                xania.tag(xania_1.Repeat, { source: xania_1.expr("for ball in balls") },
                    xania.tag(anim_1.Animate, { transform: xania_1.expr("translate3d ball.idx ball.pressed") },
                        xania.tag("div", { className: "demo2-ball", onMouseDown: xania_1.expr("ball.press()"), onMouseMove: xania_1.expr("ball.pressed -> drag event ball state"), onMouseUp: xania_1.expr("release event ball"), onMouseOut: xania_1.expr("release event ball"), style: [
                                "background-color: ", xania_1.expr("ball.backColor"),
                                "; transform: ",
                                xania_1.expr("initial ball"),
                                "; z-index: 10; box-shadow: rgba(0, 0, 0, 0.498039) -0.666667px 5px 5px;"
                            ] }))))));
    };
    return BallsApp;
}());
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = BallsApp;
var Ball = (function () {
    function Ball(idx, backColor) {
        this.idx = idx;
        this.backColor = backColor;
        this.pressed = false;
    }
    Ball.prototype.press = function () {
        this.pressed = true;
    };
    return Ball;
}());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBwLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEseUNBQW1FO0FBQ25FLHVDQUF3QztBQUN4QyxxQkFBa0I7QUFFbEI7SUFJSTtRQUFBLGlCQU9DO1FBVE8sVUFBSyxHQUFHLEVBQUUsQ0FBQztRQXdCbkIsY0FBUyxHQUFHO1lBQ1IsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUN6QyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxLQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUN0RCxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDVixJQUFJLENBQUMsR0FBRyxLQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQztvQkFDMUIsS0FBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsS0FBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUM7b0JBQ3RDLEtBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQztnQkFDMUIsQ0FBQztZQUNMLENBQUM7UUFDTCxDQUFDLENBQUE7UUE5QkcsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUMxQixJQUFJLEdBQUcsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDO2lCQUNwQixHQUFHLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLEdB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QUFNLENBQUMsQ0FDSCxtQkFBSyxTQUFTLEVBQUMsYUFBYTtZQUN4QjtnQkFDSSxzQkFBUSxPQUFPLEVBQUUsSUFBSSxDQUFDLFNBQVMsY0FBa0IsQ0FDL0M7WUFDTixtQkFBSyxTQUFTLEVBQUMsT0FBTztnQkFDbEIsVUFBQyxjQUFNLElBQUMsTUFBTSxFQUFFLFlBQUksQ0FBQyxtQkFBbUIsQ0FBQztvQkFDckMsVUFBQyxjQUFPLElBQUMsU0FBUyxFQUFFLFlBQUksQ0FBQyxtQ0FBbUMsQ0FBQzt3QkFDekQsbUJBQUssU0FBUyxFQUFDLFlBQVksRUFDdkIsV0FBVyxFQUFFLFlBQUksQ0FBQyxjQUFjLENBQUMsRUFDakMsV0FBVyxFQUFFLFlBQUksQ0FBQyx1Q0FBdUMsQ0FBQyxFQUMxRCxTQUFTLEVBQUUsWUFBSSxDQUFDLG9CQUFvQixDQUFDLEVBQ3JDLFVBQVUsRUFBRSxZQUFJLENBQUMsb0JBQW9CLENBQUMsRUFDdEMsS0FBSyxFQUFFO2dDQUNILG9CQUFvQixFQUFFLFlBQUksQ0FBQyxnQkFBZ0IsQ0FBQztnQ0FDNUMsZUFBZTtnQ0FDZixZQUFJLENBQUMsY0FBYyxDQUFDO2dDQUNwQix5RUFBeUU7NkJBQUMsR0FDNUUsQ0FDQSxDQUNMLENBQ1AsQ0FDSixDQUNULENBQUM7SUFDTixDQUFDO0lBQ0wsZUFBQztBQUFELENBQUMsQUF0SUQsSUFzSUM7OztBQUVEO0lBQ0ksY0FBbUIsR0FBVyxFQUFTLFNBQVM7UUFBN0IsUUFBRyxHQUFILEdBQUcsQ0FBUTtRQUFTLGNBQVMsR0FBVCxTQUFTLENBQUE7UUFHaEQsWUFBTyxHQUFHLEtBQUssQ0FBQztJQUZoQixDQUFDO0lBSUQsb0JBQUssR0FBTDtRQUNJLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO0lBQ3hCLENBQUM7SUFDTCxXQUFDO0FBQUQsQ0FBQyxBQVRELElBU0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSZXBlYXQsIGV4cHIsIFRlbXBsYXRlLCBSZWFjdGl2ZSB9IGZyb20gXCIuLi8uLi9zcmMveGFuaWFcIjtcclxuaW1wb3J0IHsgQW5pbWF0ZSB9IGZyb20gXCIuLi8uLi9zcmMvYW5pbVwiXHJcbmltcG9ydCAnLi9hcHAuY3NzJ1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQmFsbHNBcHAge1xyXG5cclxuICAgIHByaXZhdGUgYmFsbHMgPSBbXTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDE2OyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIHJnYiA9IFsxMDAsIDEwMCwgMTAwXVxyXG4gICAgICAgICAgICAgICAgLm1hcCh4ID0+IHggKyBNYXRoLnJhbmRvbSgpICogMTUwKVxyXG4gICAgICAgICAgICAgICAgLm1hcChNYXRoLmZsb29yKTtcclxuICAgICAgICAgICAgdGhpcy5iYWxscy5wdXNoKG5ldyBCYWxsKGksIGByZ2IoJHtyZ2Iuam9pbihcIiwgXCIpfSlgKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyB0cmFuc2xhdGUzZChpZHgsIHByZXNzZWQpIHtcclxuICAgICAgICB2YXIgeCA9IChpZHggJSA0KSAqIDcwO1xyXG4gICAgICAgIHZhciB5ID0gTWF0aC5mbG9vcihpZHggLyA0KSAqIDcwO1xyXG5cclxuICAgICAgICB2YXIgcyA9IHByZXNzZWQgPyAxLjIgOiAxO1xyXG5cclxuICAgICAgICByZXR1cm4gYHRyYW5zbGF0ZTNkKCR7eH1weCwgJHt5fXB4LCAwcHgpIHNjYWxlKCR7c30pYDtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgaW5pdGlhbChiYWxsKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudHJhbnNsYXRlM2QoYmFsbC5pZHgsIGJhbGwucHJlc3NlZCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25TaHVmZmxlID0gKCkgPT4ge1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5iYWxscy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgZSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMuYmFsbHMubGVuZ3RoKTtcclxuICAgICAgICAgICAgaWYgKGUgIT09IGkpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0ID0gdGhpcy5iYWxsc1tpXS5pZHg7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJhbGxzW2ldLmlkeCA9IHRoaXMuYmFsbHNbZV0uaWR4O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5iYWxsc1tlXS5pZHggPSB0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGRyYWcoZXZlbnQsIGJhbGwsIHN0YXRlKSB7XHJcbiAgICAgICAgdmFyIHsgb2Zmc2V0WCwgb2Zmc2V0WSB9ID0gZXZlbnQ7XHJcbiAgICAgICAgdmFyIG5vZGUgPSBldmVudC50YXJnZXQ7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdmFyIG1hcmdpbkxlZnQsIG1hcmdpblRvcCwgZExlZnQsIGRUb3AsIGJhbGxJZHg7XHJcbiAgICAgICAgaWYgKHN0YXRlICYmIG5vZGUuc3R5bGUubWFyZ2luVG9wICE9PSAwICYmIG5vZGUuc3R5bGUubWFyZ2luTGVmdCAhPT0gMCkge1xyXG4gICAgICAgICAgICBtYXJnaW5MZWZ0ID0gc3RhdGUubWFyZ2luTGVmdDtcclxuICAgICAgICAgICAgbWFyZ2luVG9wID0gc3RhdGUubWFyZ2luVG9wO1xyXG4gICAgICAgICAgICBkTGVmdCA9IHN0YXRlLmRMZWZ0O1xyXG4gICAgICAgICAgICBkVG9wID0gc3RhdGUuZFRvcDtcclxuICAgICAgICAgICAgYmFsbElkeCA9IHN0YXRlLmJhbGxJZHg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZExlZnQgPSBvZmZzZXRYIC0gMjU7XHJcbiAgICAgICAgICAgIGRUb3AgPSBvZmZzZXRZIC0gMjU7XHJcbiAgICAgICAgICAgIG1hcmdpbkxlZnQgPSAwO1xyXG4gICAgICAgICAgICBtYXJnaW5Ub3AgPSAwO1xyXG4gICAgICAgICAgICBiYWxsSWR4ID0gYmFsbC5pZHg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBtYXJnaW5MZWZ0ICs9IG9mZnNldFggLSAyNSAtIGRMZWZ0O1xyXG4gICAgICAgIG1hcmdpblRvcCArPSBvZmZzZXRZIC0gMjUgLSBkVG9wO1xyXG5cclxuICAgICAgICBub2RlLnN0eWxlLm1hcmdpbkxlZnQgPSBtYXJnaW5MZWZ0ICsgXCJweFwiO1xyXG4gICAgICAgIG5vZGUuc3R5bGUubWFyZ2luVG9wID0gbWFyZ2luVG9wICsgXCJweFwiO1xyXG4gICAgICAgIG5vZGUuc3R5bGUuekluZGV4ID0gMTAwO1xyXG5cclxuXHJcbiAgICAgICAgdmFyIHggPSBtYXJnaW5MZWZ0ICsgKGJhbGwuaWR4ICUgNCkgKiA3MDtcclxuICAgICAgICB2YXIgeSA9IG1hcmdpblRvcCArIE1hdGguZmxvb3IoYmFsbC5pZHggLyA0KSAqIDcwO1xyXG5cclxuICAgICAgICB2YXIgY29sID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMywgTWF0aC5yb3VuZCh4IC8gNzApKSk7XHJcbiAgICAgICAgdmFyIHJvdyA9IE1hdGgubWF4KDAsIE1hdGgubWluKDMsIE1hdGgucm91bmQoeSAvIDcwKSkpO1xyXG4gICAgICAgIHZhciBuZXdCYWxsSWR4ID0gY29sICsgcm93ICogNDtcclxuXHJcbiAgICAgICAgaWYgKGJhbGxJZHggIT09IG5ld0JhbGxJZHgpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmJhbGxzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMuYmFsbHNbaV07XHJcbiAgICAgICAgICAgICAgICBpZiAoYmFsbCAhPT0gYiAmJiBiLmlkeCA9PT0gbmV3QmFsbElkeClcclxuICAgICAgICAgICAgICAgICAgICBiLmlkeCA9IGJhbGxJZHg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYmFsbElkeCA9IG5ld0JhbGxJZHg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4geyBtYXJnaW5Ub3AsIG1hcmdpbkxlZnQsIGRMZWZ0LCBkVG9wLCBiYWxsSWR4IH07XHJcbiAgICB9XHJcblxyXG4gICAgcmVsZWFzZShldmVudCwgYmFsbDogQmFsbCkge1xyXG4gICAgICAgIGlmIChiYWxsLnByZXNzZWQpIHtcclxuICAgICAgICAgICAgYmFsbC5wcmVzc2VkID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBub2RlID0gZXZlbnQudGFyZ2V0O1xyXG4gICAgICAgIHZhciB0b3AgPSBub2RlLnN0eWxlLm1hcmdpblRvcDtcclxuICAgICAgICB2YXIgbGVmdCA9IG5vZGUuc3R5bGUubWFyZ2luTGVmdDtcclxuICAgICAgICBub2RlLnN0eWxlLm1hcmdpblRvcCA9IDA7XHJcbiAgICAgICAgbm9kZS5zdHlsZS5tYXJnaW5MZWZ0ID0gMDtcclxuICAgICAgICBub2RlLnN0eWxlLnpJbmRleCA9IDEwO1xyXG5cclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuYmFsbHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmJhbGxzLmZpbmQoYiA9PiBiLmlkeCA9PT0gaSkpIHtcclxuICAgICAgICAgICAgICAgIHZhciB4ID0gKGJhbGwuaWR4ICUgNCkgKiA3MDtcclxuICAgICAgICAgICAgICAgIHZhciB5ID0gTWF0aC5mbG9vcihiYWxsLmlkeCAvIDQpICogNzA7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHRyYW5zZm9ybSA9IGB0cmFuc2xhdGUzZCgke2xlZnR9LCAke3RvcH0sIDApIHRyYW5zbGF0ZTNkKCR7eH1weCwgJHt5fXB4LCAwcHgpIHNjYWxlKDEuMilgO1xyXG4gICAgICAgICAgICAgICAgbm9kZS5zdHlsZS50cmFuc2Zvcm0gPSB0cmFuc2Zvcm07XHJcblxyXG4gICAgICAgICAgICAgICAgYmFsbC5pZHggPSBpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdmlldyh4YW5pYSkge1xyXG4gICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiYmFsbHMtb3V0ZXJcIj5cclxuICAgICAgICAgICAgICAgIDxkaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXt0aGlzLm9uU2h1ZmZsZX0+c2h1ZmZsZTwvYnV0dG9uPlxyXG4gICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImRlbW8yXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgPFJlcGVhdCBzb3VyY2U9e2V4cHIoXCJmb3IgYmFsbCBpbiBiYWxsc1wiKX0+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxBbmltYXRlIHRyYW5zZm9ybT17ZXhwcihcInRyYW5zbGF0ZTNkIGJhbGwuaWR4IGJhbGwucHJlc3NlZFwiKX0+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImRlbW8yLWJhbGxcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uTW91c2VEb3duPXtleHByKFwiYmFsbC5wcmVzcygpXCIpfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uTW91c2VNb3ZlPXtleHByKFwiYmFsbC5wcmVzc2VkIC0+IGRyYWcgZXZlbnQgYmFsbCBzdGF0ZVwiKX1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbk1vdXNlVXA9e2V4cHIoXCJyZWxlYXNlIGV2ZW50IGJhbGxcIil9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Nb3VzZU91dD17ZXhwcihcInJlbGVhc2UgZXZlbnQgYmFsbFwiKX1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT17W1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJhY2tncm91bmQtY29sb3I6IFwiLCBleHByKFwiYmFsbC5iYWNrQ29sb3JcIikgLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIjsgdHJhbnNmb3JtOiBcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwcihcImluaXRpYWwgYmFsbFwiKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCI7IHotaW5kZXg6IDEwOyBib3gtc2hhZG93OiByZ2JhKDAsIDAsIDAsIDAuNDk4MDM5KSAtMC42NjY2NjdweCA1cHggNXB4O1wiXX0gPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvQW5pbWF0ZT5cclxuICAgICAgICAgICAgICAgICAgICA8L1JlcGVhdD5cclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICApO1xyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBCYWxsIHtcclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBpZHg6IG51bWJlciwgcHVibGljIGJhY2tDb2xvcikge1xyXG4gICAgfVxyXG5cclxuICAgIHByZXNzZWQgPSBmYWxzZTtcclxuXHJcbiAgICBwcmVzcygpIHtcclxuICAgICAgICB0aGlzLnByZXNzZWQgPSB0cnVlO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==