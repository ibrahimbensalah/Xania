"use strict";
var xania_1 = require("../../src/xania");
function run(target) {
    var state = {
        databases: ENV.generateData(true).toArray()
    };
    var store = new xania_1.Reactive.Store(state);
    var binding = dbmon(xania_1.default)
        .bind(xania_1.Dom.DomVisitor)
        .update2(store, new xania_1.Dom.DomDriver(target));
    xania_1.mount(binding);
    var load = function () {
        ENV.generateData(true);
        store.refresh();
        Monitoring.renderRate.ping();
        window.setTimeout(load, ENV.timeout);
    };
    load();
}
exports.run = run;
var dbmon = function (xania) {
    return xania.tag("table", { clazz: "table table-striped latest-data" },
        xania.tag("tbody", null,
            xania.tag(xania_1.Repeat, { source: xania_1.expr("databases") },
                xania.tag("tr", null,
                    xania.tag("td", { className: "dbname" }, xania_1.expr("dbname")),
                    xania.tag("td", { className: "query-count" },
                        xania.tag("span", { className: xania_1.expr("lastSample.countClassName") }, xania_1.expr("lastSample.nbQueries"))),
                    xania.tag(xania_1.Repeat, { source: xania_1.expr("lastSample.topFiveQueries") },
                        xania.tag("td", { className: xania_1.expr("elapsedClassName") },
                            xania_1.expr("formatElapsed"),
                            xania.tag("div", { className: "popover left" },
                                xania.tag("div", { className: "popover-content" }, xania_1.expr("query")),
                                xania.tag("div", { className: "arrow" }))))))));
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBwLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEseUNBQWlGO0FBUWpGLGFBQW9CLE1BQVk7SUFFNUIsSUFBSSxLQUFLLEdBQUc7UUFDUixTQUFTLEVBQUUsR0FBRyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLEVBQUU7S0FDOUMsQ0FBQztJQUNGLElBQUksS0FBSyxHQUFHLElBQUksZ0JBQUUsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7SUFFaEMsSUFBSSxPQUFPLEdBQUcsS0FBSyxDQUFDLGVBQUssQ0FBQztTQUNyQixJQUFJLENBQUMsV0FBRyxDQUFDLFVBQVUsQ0FBQztTQUNwQixPQUFPLENBQUMsS0FBSyxFQUFFLElBQUksV0FBRyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQy9DLGFBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUVmLElBQUksSUFBSSxHQUFHO1FBQ1AsR0FBRyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN2QixLQUFLLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFaEIsVUFBVSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUM3QixNQUFNLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDekMsQ0FBQyxDQUFDO0lBQ0YsSUFBSSxFQUFFLENBQUM7QUFFWCxDQUFDO0FBckJELGtCQXFCQztBQUVELElBQUksS0FBSyxHQUFRLFVBQUMsS0FBSztJQUNuQixPQUFBLHFCQUFPLEtBQUssRUFBQyxpQ0FBaUM7UUFDMUM7WUFDSSxVQUFDLGNBQU0sSUFBQyxNQUFNLEVBQUUsWUFBSSxDQUFDLFdBQVcsQ0FBQztnQkFDN0I7b0JBQ0ksa0JBQUksU0FBUyxFQUFDLFFBQVEsSUFDakIsWUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUNkO29CQUNMLGtCQUFJLFNBQVMsRUFBQyxhQUFhO3dCQUN2QixvQkFBTSxTQUFTLEVBQUUsWUFBSSxDQUFDLDJCQUEyQixDQUFDLElBQzdDLFlBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUMxQixDQUNOO29CQUNMLFVBQUMsY0FBTSxJQUFDLE1BQU0sRUFBRSxZQUFJLENBQUMsMkJBQTJCLENBQUM7d0JBQzdDLGtCQUFJLFNBQVMsRUFBRSxZQUFJLENBQUMsa0JBQWtCLENBQUM7NEJBQ2xDLFlBQUksQ0FBQyxlQUFlLENBQUM7NEJBQ3RCLG1CQUFLLFNBQVMsRUFBQyxjQUFjO2dDQUN6QixtQkFBSyxTQUFTLEVBQUMsaUJBQWlCLElBQzNCLFlBQUksQ0FBQyxPQUFPLENBQUMsQ0FDWjtnQ0FDTixtQkFBSyxTQUFTLEVBQUMsT0FBTyxHQUFPLENBQzNCLENBQ0wsQ0FDQSxDQUNSLENBQ0EsQ0FDTCxDQUNKO0FBMUJSLENBMEJRLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgWGFuaWEsIHsgZXhwciwgUmVwZWF0LCBSZWFjdGl2ZSBhcyBSZSwgRG9tLCBtb3VudCB9IGZyb20gXCIuLi8uLi9zcmMveGFuaWFcIlxyXG5cclxuLy8gUmVTaGFycGVyIGRpc2FibGUgSW5jb25zaXN0ZW50TmFtaW5nXHJcbmRlY2xhcmUgdmFyIEVOVjtcclxuZGVjbGFyZSB2YXIgTW9uaXRvcmluZztcclxuLy8gUmVTaGFycGVyIHJlc3RvcmUgSW5jb25zaXN0ZW50TmFtaW5nXHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJ1bih0YXJnZXQ6IE5vZGUpIHtcclxuXHJcbiAgICB2YXIgc3RhdGUgPSB7XHJcbiAgICAgICAgZGF0YWJhc2VzOiBFTlYuZ2VuZXJhdGVEYXRhKHRydWUpLnRvQXJyYXkoKVxyXG4gICAgfTtcclxuICAgIHZhciBzdG9yZSA9IG5ldyBSZS5TdG9yZShzdGF0ZSk7XHJcblxyXG4gICAgdmFyIGJpbmRpbmcgPSBkYm1vbihYYW5pYSlcclxuICAgICAgICAuYmluZChEb20uRG9tVmlzaXRvcilcclxuICAgICAgICAudXBkYXRlMihzdG9yZSwgbmV3IERvbS5Eb21Ecml2ZXIodGFyZ2V0KSk7XHJcbiAgICBtb3VudChiaW5kaW5nKTtcclxuXHJcbiAgICB2YXIgbG9hZCA9ICgpID0+IHtcclxuICAgICAgICBFTlYuZ2VuZXJhdGVEYXRhKHRydWUpO1xyXG4gICAgICAgIHN0b3JlLnJlZnJlc2goKTtcclxuXHJcbiAgICAgICAgTW9uaXRvcmluZy5yZW5kZXJSYXRlLnBpbmcoKTtcclxuICAgICAgICB3aW5kb3cuc2V0VGltZW91dChsb2FkLCBFTlYudGltZW91dCk7XHJcbiAgICB9O1xyXG4gICAgbG9hZCgpO1xyXG5cclxufVxyXG5cclxudmFyIGRibW9uOiBhbnkgPSAoeGFuaWEpID0+XHJcbiAgICA8dGFibGUgY2xheno9XCJ0YWJsZSB0YWJsZS1zdHJpcGVkIGxhdGVzdC1kYXRhXCI+XHJcbiAgICAgICAgPHRib2R5PlxyXG4gICAgICAgICAgICA8UmVwZWF0IHNvdXJjZT17ZXhwcihcImRhdGFiYXNlc1wiKX0+XHJcbiAgICAgICAgICAgICAgICA8dHI+XHJcbiAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzTmFtZT1cImRibmFtZVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7ZXhwcihcImRibmFtZVwiKX1cclxuICAgICAgICAgICAgICAgICAgICA8L3RkPlxyXG4gICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzc05hbWU9XCJxdWVyeS1jb3VudFwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9e2V4cHIoXCJsYXN0U2FtcGxlLmNvdW50Q2xhc3NOYW1lXCIpfT5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtleHByKFwibGFzdFNhbXBsZS5uYlF1ZXJpZXNcIil9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cclxuICAgICAgICAgICAgICAgICAgICA8L3RkPlxyXG4gICAgICAgICAgICAgICAgICAgIDxSZXBlYXQgc291cmNlPXtleHByKFwibGFzdFNhbXBsZS50b3BGaXZlUXVlcmllc1wiKX0gPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3NOYW1lPXtleHByKFwiZWxhcHNlZENsYXNzTmFtZVwiKX0+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7ZXhwcihcImZvcm1hdEVsYXBzZWRcIil9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInBvcG92ZXIgbGVmdFwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwicG9wb3Zlci1jb250ZW50XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtleHByKFwicXVlcnlcIil9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJhcnJvd1wiPjwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+XHJcbiAgICAgICAgICAgICAgICAgICAgPC9SZXBlYXQ+XHJcbiAgICAgICAgICAgICAgICA8L3RyPlxyXG4gICAgICAgICAgICA8L1JlcGVhdD5cclxuICAgICAgICA8L3Rib2R5PlxyXG4gICAgPC90YWJsZT47Il19