"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var reactive_1 = require("../src/reactive");
var compile_1 = require("../src/compile");
var observables_1 = require("../src/observables");
var ibrahim = {
    age: 36,
    firstName: "Ibrahim",
    lastName: "ben Salah",
    adult: true
};
describe("query parser", function () {
    it(':: fun x -> x ', function () {
        var ast = compile_1.default("fun x -> x").ast;
        expect(ast).toBeDefined();
        var compose = ast;
        expect(compose.type).toBe("lambda");
        expect(compose.param).toBe("x");
        expect(compose.body.name).toBe("x");
    });
    it(':: .firstName ', function () {
        var ast = compile_1.default(".firstName").ast;
        expect(ast).toBeDefined();
        var compose = ast;
        expect(compose.type).toBe("lambda");
        expect(compose.param).toBe("x");
        expect(compose.body.target.name).toBe("x");
        expect(compose.body.member.name).toBe("firstName");
    });
    it(':: 1 + 2', function () {
        var ast = compile_1.default("1 + 2").ast;
        expect(ast).toBeDefined();
        var expr = ast;
        expect(expr.type).toBe(compile_1.TOKENS.BINARY);
    });
    it(':: fn a', function () {
        var ast = compile_1.default("fun a").ast;
        expect(ast).toBeDefined();
        var expr = ast;
        expect(expr.type).toBe(compile_1.TOKENS.APP);
        expect(expr.fun).toEqual({ type: compile_1.TOKENS.IDENT, name: 'fun' });
        expect(expr.args).toEqual([{ type: compile_1.TOKENS.IDENT, name: "a" }]);
    });
    it(':: fn ()', function () {
        var ast = compile_1.default("fun ()").ast;
        expect(ast).toBeDefined();
        var expr = ast;
        expect(expr.type).toBe(compile_1.TOKENS.APP);
        expect(expr.fun).toEqual({ type: compile_1.TOKENS.IDENT, name: 'fun' });
        expect(expr.args.length).toBe(0);
    });
    it(':: (+) a b', function () {
        var ast = compile_1.default("(+) a b").ast;
        expect(ast).toBeDefined();
        var expr = ast;
        expect(expr).toEqual({ "type": compile_1.TOKENS.APP, "fun": "+", "args": [{ "type": compile_1.TOKENS.IDENT, "name": "a" }, { "type": compile_1.TOKENS.IDENT, "name": "b" }] });
    });
    it(':: a |> b |> c', function () {
        var ast = compile_1.default("a |> b |> c").ast;
        expect(ast).toBeDefined();
        var pipe1 = ast;
        expect(pipe1.type).toBe(compile_1.TOKENS.BINARY);
        expect(pipe1.op).toBe("|>");
        expect(pipe1.right).toEqual({ "type": compile_1.TOKENS.IDENT, "name": "c" });
        var pipe2 = pipe1.left;
        expect(pipe2.type).toBe(compile_1.TOKENS.BINARY);
        expect(pipe2.op).toBe("|>");
        expect(pipe2.right).toEqual({ "type": compile_1.TOKENS.IDENT, "name": "b" });
        expect(pipe2.left).toEqual({ "type": compile_1.TOKENS.IDENT, "name": "a" });
    });
    it(':: a + b |> c', function () {
        var ast = compile_1.default("a + b |> c").ast;
        expect(ast).toBeDefined();
        var pipe = ast;
        expect(pipe.type).toBe(compile_1.TOKENS.BINARY);
        expect(pipe.op).toBe("|>");
        expect(pipe.right).toEqual({ type: compile_1.TOKENS.IDENT, name: "c" });
        var add = pipe.left;
        expect(add.right.name).toBe("b");
        expect(add.left.name).toBe("a");
    });
    it(':: a >> b ', function () {
        var ast = compile_1.default("a >> b").ast;
        expect(ast).toBeDefined();
        var compose = ast;
        expect(compose.type).toBe(compile_1.TOKENS.COMPOSE, JSON.stringify(ast, null, 2));
        expect(compose.fun).toBe(">>", JSON.stringify(ast, null, 2));
        expect(compose.args[0].name).toBe("b", JSON.stringify(compose.args[0], null, 2));
        expect(compose.args[1].name).toBe("a", JSON.stringify(compose.args[1], null, 2));
    });
    it(':: a.b ', function () {
        var ast = compile_1.default("a.b").ast;
        expect(ast).toBeDefined();
        var compose = ast;
        expect(compose.type).toBe(compile_1.TOKENS.MEMBER, JSON.stringify(ast, null, 2));
        expect(compose.target.name).toBe("a", JSON.stringify(ast, null, 2));
        expect(compose.member).toBe("b", JSON.stringify(ast, null, 2));
    });
    it(':: [1..n] ', function () {
        var ast = compile_1.default("[1..n]").ast;
        expect(ast).toBeDefined();
        var range = ast;
        expect(range.type).toBe(compile_1.TOKENS.RANGE, JSON.stringify(ast, null, 2));
        expect(range.from.value).toBe(1, JSON.stringify(ast, null, 2));
        expect(range.to.name).toBe("n", JSON.stringify(ast, null, 2));
    });
    it(':: for p in people where p.adult ', function () {
        var ast = compile_1.default("people where p.adult").ast;
        expect(ast).toBeDefined();
        var where = ast;
        expect(where.type).toBe(compile_1.TOKENS.WHERE);
        expect(where.predicate.type).toBe(compile_1.TOKENS.MEMBER);
        expect(where.source.type).toBe(compile_1.TOKENS.QUERY);
    });
    it(":: empty list -> 'list is empty' ", function () {
        var rule = compile_1.default("empty list -> 'list is empty'").ast;
        expect(rule).toBeDefined();
        expect(rule.type).toBe(compile_1.TOKENS.BINARY);
        expect(rule.op).toBe("->");
        expect(rule.right.value).toBe('list is empty');
    });
    it(':: regression test', function () {
        var start = new Date().getTime();
        var ast = compile_1.default("a |> b.c >> (+) 1 |> d");
        for (var i = 0; i < 1000; i++) {
            compile_1.default("a |> b >> (+) 1 |> d");
        }
        var elapsed = new Date().getTime() - start;
        if (elapsed > 2000)
            fail("too slow");
        expect(ast).toEqual({
            "type": compile_1.TOKENS.BINARY,
            "op": "|>",
            "right": {
                "type": compile_1.TOKENS.IDENT,
                "name": "d"
            },
            "left": {
                "type": compile_1.TOKENS.BINARY,
                "op": "|>",
                "right": {
                    "type": compile_1.TOKENS.COMPOSE,
                    "fun": ">>",
                    "args": [
                        {
                            "type": compile_1.TOKENS.APP,
                            "fun": "+",
                            "args": [
                                {
                                    "type": compile_1.TOKENS.CONST,
                                    "value": 1
                                }
                            ]
                        },
                        {
                            "type": compile_1.TOKENS.MEMBER,
                            "target": {
                                "type": compile_1.TOKENS.IDENT,
                                "name": "b"
                            },
                            "member": "c"
                        }
                    ]
                },
                "left": {
                    "type": compile_1.TOKENS.IDENT,
                    "name": "a"
                }
            }
        });
    });
});
var TestBinding = (function (_super) {
    __extends(TestBinding, _super);
    function TestBinding(ast) {
        var _this = _super.call(this) || this;
        _this.ast = ast;
        return _this;
    }
    TestBinding.prototype.render = function (context) {
        this.context = context;
    };
    TestBinding.prototype.app = function (fun, args) {
        if (fun === "assign") {
            var value = args[0].valueOf();
            args[1].set(value);
            return value;
        }
        return _super.prototype.app.call(this, fun, args);
    };
    return TestBinding;
}(reactive_1.Reactive.Binding));
describe("runtime", function () {
    it("expression dependencies", function () {
        var store = new reactive_1.Reactive.Store({ p: ibrahim });
        var binding = new TestBinding(compile_1.default("p.firstName"));
        binding.render(store);
        expect(binding.value).toBe("Ibrahim");
        store.get("p").get("firstName").set("Mr Ibraihm");
        expect(binding.value).toBe("Mr Ibraihm");
    });
    it("consistent variable identity", function () {
        var store = new reactive_1.Reactive.Store({ p: ibrahim });
        var binding = new TestBinding(compile_1.default("p"));
        expect(binding.render(store)).toBe(binding.render(store));
    });
    it("consistent member identity", function () {
        var store = new reactive_1.Reactive.Store({ xania: { owner: ibrahim } });
        var binding = new TestBinding(compile_1.default("xania.owner"));
        expect(binding.render(store)).toBe(binding.render(store));
    });
    it("consistent query identity", function () {
        var store = new reactive_1.Reactive.Store({ xania: { employees: [ibrahim] } });
        var binding = new TestBinding(compile_1.default("for e in xania.employees"));
        expect(binding.render(store)[0]).toBe(binding.render(store)[0], "not identical");
    });
    it("assign expression", function () {
        var store = new reactive_1.Reactive.Store({ x: 1, y: 2, sum: 0 });
        var binding = new TestBinding(compile_1.default("sum <- x + y"));
        binding.render(store);
        expect(store.get("sum").valueOf()).toBe(3);
    });
    it('await observable', function () {
        var observable = new observables_1.Observables.Observable(123);
        var store = new reactive_1.Reactive.Store({ observable: observable });
        var binding = new TestBinding(compile_1.default("await observable"));
        binding.render(store);
        expect(binding.value).toBe(123);
        observable.notify(456);
        expect(binding.value).toBe(456);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcGlsZXJTcGVjLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY29tcGlsZXJTcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUVBLDRDQUFpRDtBQUNqRCwwQ0FBaUQ7QUFDakQsa0RBQWlEO0FBSWpELElBQUksT0FBTyxHQUFZO0lBQ25CLEdBQUcsRUFBRSxFQUFFO0lBQ1AsU0FBUyxFQUFFLFNBQVM7SUFDcEIsUUFBUSxFQUFFLFdBQVc7SUFDckIsS0FBSyxFQUFFLElBQUk7Q0FDZCxDQUFDO0FBRUYsUUFBUSxDQUFDLGNBQWMsRUFBRTtJQUVyQixFQUFFLENBQUMsZ0JBQWdCLEVBQ2Y7UUFDSSxJQUFJLEdBQUcsR0FBRyxpQkFBTyxDQUFDLFlBQVksQ0FBQyxDQUFDLEdBQUcsQ0FBQztRQUNwQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFFMUIsSUFBSSxPQUFPLEdBQUcsR0FBRyxDQUFDO1FBQ2xCLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3BDLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2hDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUN4QyxDQUFDLENBQUMsQ0FBQztJQUVQLEVBQUUsQ0FBQyxnQkFBZ0IsRUFDZjtRQUNJLElBQUksR0FBRyxHQUFHLGlCQUFPLENBQUMsWUFBWSxDQUFDLENBQUMsR0FBRyxDQUFDO1FBQ3BDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUUxQixJQUFJLE9BQU8sR0FBRyxHQUFHLENBQUM7UUFDbEIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFD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QUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN4RSxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0QsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDakYsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDckYsQ0FBQyxDQUFDLENBQUM7SUFFUCxFQUFFLENBQUMsU0FBUyxFQUNSO1FBQ0ksSUFBSSxHQUFHLEdBQUcsaUJBQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUM7UUFDN0IsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBRTFCLElBQUksT0FBTyxHQUFHLEdBQUcsQ0FBQztRQUNsQixNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxnQkFBTSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN2RSxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxJ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LE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdEIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFaEMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN2QixNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNwQyxDQUFDLENBQUMsQ0FBQztBQUVYLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uL25vZGVfbW9kdWxlcy9AdHlwZXMvamFzbWluZS9pbmRleC5kLnRzXCIgLz5cclxuXHJcbmltcG9ydCB7IFJlYWN0aXZlIGFzIFJlIH0gZnJvbSBcIi4uL3NyYy9yZWFjdGl2ZVwiO1xyXG5pbXBvcnQgY29tcGlsZSwgeyBUT0tFTlMgfSBmcm9tIFwiLi4vc3JjL2NvbXBpbGVcIjtcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZXMgfSBmcm9tIFwiLi4vc3JjL29ic2VydmFibGVzXCI7XHJcblxyXG5pbnRlcmZhY2UgSVBlcnNvbiB7IGZpcnN0TmFtZTogc3RyaW5nOyBsYXN0TmFtZTogc3RyaW5nOyBhZHVsdDogYm9vbGVhbiwgYWdlOiBudW1iZXIgfVxyXG5cclxudmFyIGlicmFoaW06IElQZXJzb24gPSB7XHJcbiAgICBhZ2U6IDM2LFxyXG4gICAgZmlyc3ROYW1lOiBcIklicmFoaW1cIixcclxuICAgIGxhc3ROYW1lOiBcImJlbiBTYWxhaFwiLFxyXG4gICAgYWR1bHQ6IHRydWVcclxufTtcclxuXHJcbmRlc2NyaWJlKFwicXVlcnkgcGFyc2VyXCIsICgpID0+IHtcclxuXHJcbiAgICBpdCgnOjogZnVuIHggLT4geCAnLFxyXG4gICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgdmFyIGFzdCA9IGNvbXBpbGUoXCJmdW4geCAtPiB4XCIpLmFzdDtcclxuICAgICAgICAgICAgZXhwZWN0KGFzdCkudG9CZURlZmluZWQoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBjb21wb3NlID0gYXN0O1xyXG4gICAgICAgICAgICBleHBlY3QoY29tcG9zZS50eXBlKS50b0JlKFwibGFtYmRhXCIpO1xyXG4gICAgICAgICAgICBleHBlY3QoY29tcG9zZS5wYXJhbSkudG9CZShcInhcIik7XHJcbiAgICAgICAgICAgIGV4cGVjdChjb21wb3NlLmJvZHkubmFtZSkudG9CZShcInhcIik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgaXQoJzo6IC5maXJzdE5hbWUgJyxcclxuICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBhc3QgPSBjb21waWxlKFwiLmZpcnN0TmFtZVwiKS5hc3Q7XHJcbiAgICAgICAgICAgIGV4cGVjdChhc3QpLnRvQmVEZWZpbmVkKCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgY29tcG9zZSA9IGFzdDtcclxuICAgICAgICAgICAgZXhwZWN0KGNvbXBvc2UudHlwZSkudG9CZShcImxhbWJkYVwiKTtcclxuICAgICAgICAgICAgZXhwZWN0KGNvbXBvc2UucGFyYW0pLnRvQmUoXCJ4XCIpO1xyXG4gICAgICAgICAgICBleHBlY3QoY29tcG9zZS5ib2R5LnRhcmdldC5uYW1lKS50b0JlKFwieFwiKTtcclxuICAgICAgICAgICAgZXhwZWN0KGNvbXBvc2UuYm9keS5tZW1iZXIubmFtZSkudG9CZShcImZpcnN0TmFtZVwiKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICBpdCgnOjogMSArIDInLFxyXG4gICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgdmFyIGFzdCA9IGNvbXBpbGUoXCIxICsgMlwiKS5hc3Q7XHJcbiAgICAgICAgICAgIGV4cGVjdChhc3QpLnRvQmVEZWZpbmVkKCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgZXhwciA9IGFzdDtcclxuICAgICAgICAgICAgZXhwZWN0KGV4cHIudHlwZSkudG9CZShUT0tFTlMuQklOQVJZKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICBpdCgnOjogZm4gYScsXHJcbiAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICB2YXIgYXN0ID0gY29tcGlsZShcImZ1biBhXCIpLmFzdDtcclxuICAgICAgICAgICAgZXhwZWN0KGFzdCkudG9CZURlZmluZWQoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBleHByID0gYXN0O1xyXG4gICAgICAgICAgICBleHBlY3QoZXhwci50eXBlKS50b0JlKFRPS0VOUy5BUFApO1xyXG4gICAgICAgICAgICBleHBlY3QoZXhwci5mdW4pLnRvRXF1YWwoeyB0eXBlOiBUT0tFTlMuSURFTlQsIG5hbWU6ICdmdW4nIH0pO1xyXG4gICAgICAgICAgICBleHBlY3QoZXhwci5hcmdzKS50b0VxdWFsKFt7IHR5cGU6IFRPS0VOUy5JREVOVCwgbmFtZTogXCJhXCIgfV0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIGl0KCc6OiBmbiAoKScsXHJcbiAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICB2YXIgYXN0ID0gY29tcGlsZShcImZ1biAoKVwiKS5hc3Q7XHJcbiAgICAgICAgICAgIGV4cGVjdChhc3QpLnRvQmVEZWZpbmVkKCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgZXhwciA9IGFzdDtcclxuICAgICAgICAgICAgZXhwZWN0KGV4cHIudHlwZSkudG9CZShUT0tFTlMuQVBQKTtcclxuICAgICAgICAgICAgZXhwZWN0KGV4cHIuZnVuKS50b0VxdWFsKHsgdHlwZTogVE9LRU5TLklERU5ULCBuYW1lOiAnZnVuJyB9KTtcclxuICAgICAgICAgICAgZXhwZWN0KGV4cHIuYXJncy5sZW5ndGgpLnRvQmUoMCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgaXQoJzo6ICgrKSBhIGInLFxyXG4gICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgdmFyIGFzdCA9IGNvbXBpbGUoXCIoKykgYSBiXCIpLmFzdDtcclxuICAgICAgICAgICAgZXhwZWN0KGFzdCkudG9CZURlZmluZWQoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBleHByID0gYXN0O1xyXG4gICAgICAgICAgICBleHBlY3QoZXhwcikudG9FcXVhbCh7IFwidHlwZVwiOiBUT0tFTlMuQVBQLCBcImZ1blwiOiBcIitcIiwgXCJhcmdzXCI6IFt7IFwidHlwZVwiOiBUT0tFTlMuSURFTlQsIFwibmFtZVwiOiBcImFcIiB9LCB7IFwidHlwZVwiOiBUT0tFTlMuSURFTlQsIFwibmFtZVwiOiBcImJcIiB9XSB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICBpdCgnOjogYSB8PiBiIHw+IGMnLFxyXG4gICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgdmFyIGFzdCA9IGNvbXBpbGUoXCJhIHw+IGIgfD4gY1wiKS5hc3Q7XHJcbiAgICAgICAgICAgIGV4cGVjdChhc3QpLnRvQmVEZWZpbmVkKCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgcGlwZTEgPSBhc3Q7XHJcbiAgICAgICAgICAgIGV4cGVjdChwaXBlMS50eXBlKS50b0JlKFRPS0VOUy5CSU5BUlkpO1xyXG4gICAgICAgICAgICBleHBlY3QocGlwZTEub3ApLnRvQmUoXCJ8PlwiKTtcclxuICAgICAgICAgICAgZXhwZWN0KHBpcGUxLnJpZ2h0KS50b0VxdWFsKHsgXCJ0eXBlXCI6IFRPS0VOUy5JREVOVCwgXCJuYW1lXCI6IFwiY1wiIH0pO1xyXG5cclxuICAgICAgICAgICAgdmFyIHBpcGUyID0gcGlwZTEubGVmdDtcclxuICAgICAgICAgICAgZXhwZWN0KHBpcGUyLnR5cGUpLnRvQmUoVE9LRU5TLkJJTkFSWSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChwaXBlMi5vcCkudG9CZShcInw+XCIpO1xyXG4gICAgICAgICAgICBleHBlY3QocGlwZTIucmlnaHQpLnRvRXF1YWwoeyBcInR5cGVcIjogVE9LRU5TLklERU5ULCBcIm5hbWVcIjogXCJiXCIgfSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChwaXBlMi5sZWZ0KS50b0VxdWFsKHsgXCJ0eXBlXCI6IFRPS0VOUy5JREVOVCwgXCJuYW1lXCI6IFwiYVwiIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIGl0KCc6OiBhICsgYiB8PiBjJyxcclxuICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBhc3QgPSBjb21waWxlKFwiYSArIGIgfD4gY1wiKS5hc3Q7XHJcbiAgICAgICAgICAgIGV4cGVjdChhc3QpLnRvQmVEZWZpbmVkKCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgcGlwZSA9IGFzdDtcclxuICAgICAgICAgICAgZXhwZWN0KHBpcGUudHlwZSkudG9CZShUT0tFTlMuQklOQVJZKTtcclxuICAgICAgICAgICAgZXhwZWN0KHBpcGUub3ApLnRvQmUoXCJ8PlwiKTtcclxuICAgICAgICAgICAgZXhwZWN0KHBpcGUucmlnaHQpLnRvRXF1YWwoeyB0eXBlOiBUT0tFTlMuSURFTlQsIG5hbWU6IFwiY1wiIH0pO1xyXG5cclxuICAgICAgICAgICAgdmFyIGFkZCA9IHBpcGUubGVmdDtcclxuICAgICAgICAgICAgZXhwZWN0KGFkZC5yaWdodC5uYW1lKS50b0JlKFwiYlwiKTtcclxuICAgICAgICAgICAgZXhwZWN0KGFkZC5sZWZ0Lm5hbWUpLnRvQmUoXCJhXCIpO1xyXG5cclxuICAgICAgICAgICAgLy8gW3tcInR5cGVcIjpcInBpcGVcIixcImZ1blwiOlwifD5cIixcImFyZ3NcIjpbe1widHlwZVwiOlRPS0VOUy5JREVOVCxcIm5hbWVcIjpcImNcIn0se1widHlwZVwiOlwicGlwZVwiLFwiZnVuXCI6XCJ8PlwiLFwiYXJnc1wiOlt7XCJ0eXBlXCI6VE9LRU5TLklERU5ULFwibmFtZVwiOlwiYlwifSx7XCJ0eXBlXCI6VE9LRU5TLklERU5ULFwibmFtZVwiOlwiYVwifV19XX1dXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgaXQoJzo6IGEgPj4gYiAnLFxyXG4gICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgdmFyIGFzdCA9IGNvbXBpbGUoXCJhID4+IGJcIikuYXN0O1xyXG4gICAgICAgICAgICBleHBlY3QoYXN0KS50b0JlRGVmaW5lZCgpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGNvbXBvc2UgPSBhc3Q7XHJcbiAgICAgICAgICAgIGV4cGVjdChjb21wb3NlLnR5cGUpLnRvQmUoVE9LRU5TLkNPTVBPU0UsIEpTT04uc3RyaW5naWZ5KGFzdCwgbnVsbCwgMikpO1xyXG4gICAgICAgICAgICBleHBlY3QoY29tcG9zZS5mdW4pLnRvQmUoXCI+PlwiLCBKU09OLnN0cmluZ2lmeShhc3QsIG51bGwsIDIpKTtcclxuICAgICAgICAgICAgZXhwZWN0KGNvbXBvc2UuYXJnc1swXS5uYW1lKS50b0JlKFwiYlwiLCBKU09OLnN0cmluZ2lmeShjb21wb3NlLmFyZ3NbMF0sIG51bGwsIDIpKTtcclxuICAgICAgICAgICAgZXhwZWN0KGNvbXBvc2UuYXJnc1sxXS5uYW1lKS50b0JlKFwiYVwiLCBKU09OLnN0cmluZ2lmeShjb21wb3NlLmFyZ3NbMV0sIG51bGwsIDIpKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICBpdCgnOjogYS5iICcsXHJcbiAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICB2YXIgYXN0ID0gY29tcGlsZShcImEuYlwiKS5hc3Q7XHJcbiAgICAgICAgICAgIGV4cGVjdChhc3QpLnRvQmVEZWZpbmVkKCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgY29tcG9zZSA9IGFzdDtcclxuICAgICAgICAgICAgZXhwZWN0KGNvbXBvc2UudHlwZSkudG9CZShUT0tFTlMuTUVNQkVSLCBKU09OLnN0cmluZ2lmeShhc3QsIG51bGwsIDIpKTtcclxuICAgICAgICAgICAgZXhwZWN0KGNvbXBvc2UudGFyZ2V0Lm5hbWUpLnRvQmUoXCJhXCIsIEpTT04uc3RyaW5naWZ5KGFzdCwgbnVsbCwgMikpO1xyXG4gICAgICAgICAgICBleHBlY3QoY29tcG9zZS5tZW1iZXIpLnRvQmUoXCJiXCIsIEpTT04uc3RyaW5naWZ5KGFzdCwgbnVsbCwgMikpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIGl0KCc6OiBbMS4ubl0gJyxcclxuICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBhc3QgPSBjb21waWxlKFwiWzEuLm5dXCIpLmFzdDtcclxuICAgICAgICAgICAgZXhwZWN0KGFzdCkudG9CZURlZmluZWQoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciByYW5nZSA9IGFzdDtcclxuICAgICAgICAgICAgZXhwZWN0KHJhbmdlLnR5cGUpLnRvQmUoVE9LRU5TLlJBTkdFLCBKU09OLnN0cmluZ2lmeShhc3QsIG51bGwsIDIpKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJhbmdlLmZyb20udmFsdWUpLnRvQmUoMSwgSlNPTi5zdHJpbmdpZnkoYXN0LCBudWxsLCAyKSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyYW5nZS50by5uYW1lKS50b0JlKFwiblwiLCBKU09OLnN0cmluZ2lmeShhc3QsIG51bGwsIDIpKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICBpdCgnOjogZm9yIHAgaW4gcGVvcGxlIHdoZXJlIHAuYWR1bHQgJyxcclxuICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBhc3QgPSBjb21waWxlKFwicGVvcGxlIHdoZXJlIHAuYWR1bHRcIikuYXN0O1xyXG4gICAgICAgICAgICBleHBlY3QoYXN0KS50b0JlRGVmaW5lZCgpO1xyXG5cclxuICAgICAgICAgICAgdmFyIHdoZXJlID0gYXN0O1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KHdoZXJlLnR5cGUpLnRvQmUoVE9LRU5TLldIRVJFKTtcclxuICAgICAgICAgICAgZXhwZWN0KHdoZXJlLnByZWRpY2F0ZS50eXBlKS50b0JlKFRPS0VOUy5NRU1CRVIpO1xyXG4gICAgICAgICAgICBleHBlY3Qod2hlcmUuc291cmNlLnR5cGUpLnRvQmUoVE9LRU5TLlFVRVJZKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICBpdChcIjo6IGVtcHR5IGxpc3QgLT4gJ2xpc3QgaXMgZW1wdHknIFwiLFxyXG4gICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgdmFyIHJ1bGUgPSBjb21waWxlKFwiZW1wdHkgbGlzdCAtPiAnbGlzdCBpcyBlbXB0eSdcIikuYXN0O1xyXG4gICAgICAgICAgICBleHBlY3QocnVsZSkudG9CZURlZmluZWQoKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChydWxlLnR5cGUpLnRvQmUoVE9LRU5TLkJJTkFSWSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChydWxlLm9wKS50b0JlKFwiLT5cIik7XHJcbiAgICAgICAgICAgIGV4cGVjdChydWxlLnJpZ2h0LnZhbHVlKS50b0JlKCdsaXN0IGlzIGVtcHR5Jyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuICAgIGl0KCc6OiByZWdyZXNzaW9uIHRlc3QnLFxyXG4gICAgICAgICgpID0+IHtcclxuXHJcbiAgICAgICAgICAgIHZhciBzdGFydCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGFzdCA9IGNvbXBpbGUoXCJhIHw+IGIuYyA+PiAoKykgMSB8PiBkXCIpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDEwMDA7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgY29tcGlsZShcImEgfD4gYiA+PiAoKykgMSB8PiBkXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBlbGFwc2VkID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgLSBzdGFydDtcclxuXHJcbiAgICAgICAgICAgIGlmIChlbGFwc2VkID4gMjAwMCkgZmFpbChcInRvbyBzbG93XCIpO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KGFzdCkudG9FcXVhbChcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBcInR5cGVcIjogVE9LRU5TLkJJTkFSWSxcclxuICAgICAgICAgICAgICAgICAgICBcIm9wXCI6IFwifD5cIixcclxuICAgICAgICAgICAgICAgICAgICBcInJpZ2h0XCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFRPS0VOUy5JREVOVCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiZFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBcImxlZnRcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInR5cGVcIjogVE9LRU5TLkJJTkFSWSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJvcFwiOiBcInw+XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwicmlnaHRcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFRPS0VOUy5DT01QT1NFLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJmdW5cIjogXCI+PlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhcmdzXCI6IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidHlwZVwiOiBUT0tFTlMuQVBQLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImZ1blwiOiBcIitcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhcmdzXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInR5cGVcIjogVE9LRU5TLkNPTlNULFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogMVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidHlwZVwiOiBUT0tFTlMuTUVNQkVSLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRhcmdldFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInR5cGVcIjogVE9LRU5TLklERU5ULFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiYlwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibWVtYmVyXCI6IFwiY1wiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImxlZnRcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFRPS0VOUy5JREVOVCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcImFcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbn0pO1xyXG5cclxuXHJcbmNsYXNzIFRlc3RCaW5kaW5nIGV4dGVuZHMgUmUuQmluZGluZyB7XHJcbiAgICBwdWJsaWMgdmFsdWU7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBhc3QpIHtcclxuICAgICAgICBzdXBlcigpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbmRlcihjb250ZXh0KSB7XHJcbiAgICAgICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDtcclxuICAgICAgICAvLyByZXR1cm4gdGhpcy52YWx1ZSA9IGFjY2VwdCh0aGlzLmFzdCwgdGhpcywgY29udGV4dCkudmFsdWVPZigpO1xyXG4gICAgfVxyXG5cclxuICAgIGFwcChmdW4sIGFyZ3M6IGFueVtdKSB7XHJcbiAgICAgICAgaWYgKGZ1biA9PT0gXCJhc3NpZ25cIikge1xyXG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhcmdzWzBdLnZhbHVlT2YoKTtcclxuICAgICAgICAgICAgYXJnc1sxXS5zZXQodmFsdWUpO1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc3VwZXIuYXBwKGZ1biwgYXJncyk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmRlc2NyaWJlKFwicnVudGltZVwiLCAoKSA9PiB7XHJcblxyXG4gICAgaXQoXCJleHByZXNzaW9uIGRlcGVuZGVuY2llc1wiLFxyXG4gICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgdmFyIHN0b3JlID0gbmV3IFJlLlN0b3JlKHsgcDogaWJyYWhpbSB9KTtcclxuICAgICAgICAgICAgdmFyIGJpbmRpbmcgPSBuZXcgVGVzdEJpbmRpbmcoY29tcGlsZShcInAuZmlyc3ROYW1lXCIpKTtcclxuICAgICAgICAgICAgYmluZGluZy5yZW5kZXIoc3RvcmUpO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KGJpbmRpbmcudmFsdWUpLnRvQmUoXCJJYnJhaGltXCIpO1xyXG4gICAgICAgICAgICAvLyBleHBlY3QoYmluZGluZy5kZXBlbmRlbmNpZXMubGVuZ3RoKS50b0JlKDIpO1xyXG5cclxuICAgICAgICAgICAgLy8gZXhwZWN0KHN0b3JlLmRpcnR5Lmxlbmd0aCkudG9CZSgwKTtcclxuXHJcbiAgICAgICAgICAgIHN0b3JlLmdldChcInBcIikuZ2V0KFwiZmlyc3ROYW1lXCIpLnNldChcIk1yIElicmFpaG1cIik7XHJcbiAgICAgICAgICAgIGV4cGVjdChiaW5kaW5nLnZhbHVlKS50b0JlKFwiTXIgSWJyYWlobVwiKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGV4cGVjdChiaW5kaW5nLmRlcGVuZGVuY2llcy5sZW5ndGgpLnRvQmUoMik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgaXQoXCJjb25zaXN0ZW50IHZhcmlhYmxlIGlkZW50aXR5XCIsXHJcbiAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICB2YXIgc3RvcmUgPSBuZXcgUmUuU3RvcmUoeyBwOiBpYnJhaGltIH0pO1xyXG5cclxuICAgICAgICAgICAgdmFyIGJpbmRpbmcgPSBuZXcgVGVzdEJpbmRpbmcoY29tcGlsZShcInBcIikpO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KGJpbmRpbmcucmVuZGVyKHN0b3JlKSkudG9CZShiaW5kaW5nLnJlbmRlcihzdG9yZSkpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIGl0KFwiY29uc2lzdGVudCBtZW1iZXIgaWRlbnRpdHlcIiwgKCkgPT4ge1xyXG4gICAgICAgIHZhciBzdG9yZSA9IG5ldyBSZS5TdG9yZSh7IHhhbmlhOiB7IG93bmVyOiBpYnJhaGltIH0gfSk7XHJcbiAgICAgICAgdmFyIGJpbmRpbmcgPSBuZXcgVGVzdEJpbmRpbmcoY29tcGlsZShcInhhbmlhLm93bmVyXCIpKTtcclxuICAgICAgICBleHBlY3QoYmluZGluZy5yZW5kZXIoc3RvcmUpKS50b0JlKGJpbmRpbmcucmVuZGVyKHN0b3JlKSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdChcImNvbnNpc3RlbnQgcXVlcnkgaWRlbnRpdHlcIiwgKCkgPT4ge1xyXG4gICAgICAgIHZhciBzdG9yZSA9IG5ldyBSZS5TdG9yZSh7IHhhbmlhOiB7IGVtcGxveWVlczogW2licmFoaW1dIH0gfSk7XHJcbiAgICAgICAgdmFyIGJpbmRpbmcgPSBuZXcgVGVzdEJpbmRpbmcoY29tcGlsZShcImZvciBlIGluIHhhbmlhLmVtcGxveWVlc1wiKSk7XHJcbiAgICAgICAgZXhwZWN0KGJpbmRpbmcucmVuZGVyKHN0b3JlKVswXSkudG9CZShiaW5kaW5nLnJlbmRlcihzdG9yZSlbMF0sIFwibm90IGlkZW50aWNhbFwiKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KFwiYXNzaWduIGV4cHJlc3Npb25cIixcclxuICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBzdG9yZSA9IG5ldyBSZS5TdG9yZSh7IHg6IDEsIHk6IDIsIHN1bTogMCB9KTtcclxuICAgICAgICAgICAgdmFyIGJpbmRpbmcgPSBuZXcgVGVzdEJpbmRpbmcoY29tcGlsZShcInN1bSA8LSB4ICsgeVwiKSk7XHJcbiAgICAgICAgICAgIGJpbmRpbmcucmVuZGVyKHN0b3JlKTtcclxuICAgICAgICAgICAgZXhwZWN0KHN0b3JlLmdldChcInN1bVwiKS52YWx1ZU9mKCkpLnRvQmUoMyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgaXQoJ2F3YWl0IG9ic2VydmFibGUnLFxyXG4gICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgdmFyIG9ic2VydmFibGUgPSBuZXcgT2JzZXJ2YWJsZXMuT2JzZXJ2YWJsZSgxMjMpO1xyXG4gICAgICAgICAgICB2YXIgc3RvcmUgPSBuZXcgUmUuU3RvcmUoeyBvYnNlcnZhYmxlIH0pO1xyXG4gICAgICAgICAgICB2YXIgYmluZGluZyA9IG5ldyBUZXN0QmluZGluZyhjb21waWxlKFwiYXdhaXQgb2JzZXJ2YWJsZVwiKSk7XHJcblxyXG4gICAgICAgICAgICBiaW5kaW5nLnJlbmRlcihzdG9yZSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChiaW5kaW5nLnZhbHVlKS50b0JlKDEyMyk7XHJcblxyXG4gICAgICAgICAgICBvYnNlcnZhYmxlLm5vdGlmeSg0NTYpO1xyXG4gICAgICAgICAgICBleHBlY3QoYmluZGluZy52YWx1ZSkudG9CZSg0NTYpO1xyXG4gICAgICAgIH0pO1xyXG5cclxufSk7XHJcblxyXG4iXX0=