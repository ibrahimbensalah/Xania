"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var reactive_1 = require("../src/reactive");
var fsharp_1 = require("../src/fsharp");
var ibrahim = {
    age: 36,
    firstName: "Ibrahim",
    lastName: "ben Salah",
    adult: true
};
var ramy = {
    age: 5,
    firstName: "Ramy",
    lastName: "ben Salah",
    adult: false
};
var rania = {
    age: 3,
    firstName: "Rania",
    lastName: "ben Salah",
    adult: false
};
{
}
describe("fsharp parser", function () {
    it(':: fun x -> x ', function () {
        var ast = fsharp_1.fsharp("fun x -> x");
        expect(ast).toBeDefined();
        console.log("\r\n =========== \r\n" + JSON.stringify(ast, null, 2) + "\r\n ======== \r\n", ast);
        var compose = ast;
        expect(compose.type).toBe("lambda");
        expect(compose.param).toBe("x");
        expect(compose.body.name).toBe("x");
    });
    it(':: .firstName ', function () {
        var ast = fsharp_1.fsharp(".firstName");
        expect(ast).toBeDefined();
        console.log("\r\n =========== \r\n" + JSON.stringify(ast, null, 2) + "\r\n ======== \r\n", ast);
        var compose = ast;
        expect(compose.type).toBe("lambda");
        expect(compose.param).toBe("x");
        expect(compose.body.target.name).toBe("x");
        expect(compose.body.member.name).toBe("firstName");
    });
    it(':: 1 + 2', function () {
        var ast = fsharp_1.fsharp("1 + 2");
        expect(ast).toBeDefined();
        console.log("\r\n =========== \r\n" + JSON.stringify(ast, null, 2) + "\r\n ======== \r\n");
        var expr = ast;
        expect(expr.type).toBe('app');
        console.log(JSON.stringify(ast, null, 2));
    });
    it(':: fn a', function () {
        var ast = fsharp_1.fsharp("fun a");
        expect(ast).toBeDefined();
        console.log("\r\n =========== \r\n" + JSON.stringify(ast, null, 2) + "\r\n ======== \r\n");
        var expr = ast;
        expect(expr.type).toBe('app');
        expect(expr.fun).toEqual({ type: 'ident', name: 'fun' });
        expect(expr.args).toEqual([{ type: "ident", name: "a" }]);
    });
    it(':: fn ()', function () {
        var ast = fsharp_1.fsharp("fun ()");
        expect(ast).toBeDefined();
        console.log("\r\n =========== \r\n" + JSON.stringify(ast, null, 2) + "\r\n ======== \r\n");
        var expr = ast;
        expect(expr.type).toBe('app');
        expect(expr.fun).toEqual({ type: 'ident', name: 'fun' });
        expect(expr.args.length).toBe(0);
    });
    it(':: (+) a b', function () {
        var ast = fsharp_1.fsharp("(+) a b");
        expect(ast).toBeDefined();
        console.log("\r\n =========== \r\n" + JSON.stringify(ast, null, 2) + "\r\n ======== \r\n");
        var expr = ast;
        expect(expr).toEqual({ "type": "app", "fun": "+", "args": [{ "type": "ident", "name": "a" }, { "type": "ident", "name": "b" }] });
    });
    it(':: a |> b |> c', function () {
        var ast = fsharp_1.fsharp("a |> b |> c");
        expect(ast).toBeDefined();
        console.log("\r\n =========== \r\n" + JSON.stringify(ast, null, 2) + "\r\n ======== \r\n");
        var pipe1 = ast;
        expect(pipe1.type).toBe("pipe");
        expect(pipe1.fun).toBe("|>");
        expect(pipe1.args[0]).toEqual({ "type": "ident", "name": "c" });
        var pipe2 = pipe1.args[1];
        expect(pipe2.type).toBe("pipe");
        expect(pipe2.fun).toBe("|>");
        expect(pipe2.args[0]).toEqual({ "type": "ident", "name": "b" });
        expect(pipe2.args[1]).toEqual({ "type": "ident", "name": "a" });
    });
    it(':: a + b |> c', function () {
        var ast = fsharp_1.fsharp("a + b |> c");
        expect(ast).toBeDefined();
        console.log("\r\n =========== \r\n" + JSON.stringify(ast, null, 2) + "\r\n ======== \r\n");
        var pipe = ast;
        expect(pipe.type).toBe("pipe");
        expect(pipe.fun).toBe("|>");
        expect(pipe.args[0]).toEqual({ type: "ident", name: "c" });
        var add = pipe.args[1];
        expect(add.args[0].name).toBe("b");
        expect(add.args[1].name).toBe("a");
    });
    it(':: a >> b ', function () {
        var ast = fsharp_1.fsharp("a >> b");
        expect(ast).toBeDefined();
        var compose = ast;
        expect(compose.type).toBe("compose", JSON.stringify(ast, null, 2));
        expect(compose.fun).toBe(">>", JSON.stringify(ast, null, 2));
        expect(compose.args[0].name).toBe("b", JSON.stringify(compose.args[0], null, 2));
        expect(compose.args[1].name).toBe("a", JSON.stringify(compose.args[1], null, 2));
    });
    it(':: a.b ', function () {
        var ast = fsharp_1.fsharp("a.b");
        expect(ast).toBeDefined();
        var compose = ast;
        expect(compose.type).toBe("member", JSON.stringify(ast, null, 2));
        expect(compose.target.name).toBe("a", JSON.stringify(ast, null, 2));
        expect(compose.member).toBe("b", JSON.stringify(ast, null, 2));
    });
    it(':: [1..n] ', function () {
        var ast = fsharp_1.fsharp("[1..n]");
        expect(ast).toBeDefined();
        var range = ast;
        expect(range.type).toBe("range", JSON.stringify(ast, null, 2));
        expect(range.from.value).toBe(1, JSON.stringify(ast, null, 2));
        expect(range.to.name).toBe("n", JSON.stringify(ast, null, 2));
    });
    it(':: for p in people where p.adult ', function () {
        var ast = fsharp_1.fsharp("for p in people where p.adult");
        expect(ast).toBeDefined();
        console.log("\r\n =========== \r\n" + JSON.stringify(ast, null, 2) + "\r\n ======== \r\n", ast);
        var where = ast;
        expect(where.type).toBe("where");
        expect(where.predicate.type).toBe("member");
        expect(where.source.type).toBe("query");
    });
    it(':: regression test', function () {
        var start = new Date().getTime();
        var ast = fsharp_1.fsharp("a |> b.c >> (+) 1 |> d");
        for (var i = 0; i < 1000; i++) {
            fsharp_1.fsharp("a |> b >> (+) 1 |> d");
        }
        var elapsed = new Date().getTime() - start;
        if (elapsed > 2000)
            fail("too slow");
        expect(ast).toEqual({
            "type": "pipe",
            "fun": "|>",
            "args": [
                {
                    "type": "ident",
                    "name": "d"
                },
                {
                    "type": "pipe",
                    "fun": "|>",
                    "args": [
                        {
                            "type": "compose",
                            "fun": ">>",
                            "args": [
                                {
                                    "type": "app",
                                    "fun": "+",
                                    "args": [
                                        {
                                            "type": "const",
                                            "value": 1
                                        }
                                    ]
                                }, {
                                    "type": "member",
                                    "target": {
                                        "type": "ident",
                                        "name": "b"
                                    },
                                    "member": "c"
                                }
                            ]
                        }, {
                            "type": "ident",
                            "name": "a"
                        }
                    ]
                }
            ]
        });
    });
});
var TestBinding = (function (_super) {
    __extends(TestBinding, _super);
    function TestBinding(ast) {
        var _this = _super.call(this) || this;
        _this.ast = ast;
        return _this;
    }
    TestBinding.prototype.render = function (context) {
        this.context = context;
        return fsharp_1.accept(this.ast, this, context).valueOf();
    };
    return TestBinding;
}(reactive_1.Reactive.Binding));
describe("runtime", function () {
    it("expression dependencies", function () {
        var store = new reactive_1.Reactive.Store({ p: ibrahim });
        var binding = new TestBinding(fsharp_1.fsharp("p.firstName"));
        binding.update(store);
        expect(binding.state).toBe("Ibrahim");
        expect(binding.dependencies.length).toBe(2);
        store.get("p").get("firstName").set("Mr Ibraihm");
        expect(binding.state).toBe("Mr Ibraihm");
        expect(binding.dependencies.length).toBe(2);
    });
    it("consistent variable identity", function () {
        var store = new reactive_1.Reactive.Store({ p: ibrahim });
        var binding = new TestBinding(fsharp_1.fsharp("p"));
        expect(binding.render(store)).toBe(binding.render(store));
    });
    it("consistent member identity", function () {
        var store = new reactive_1.Reactive.Store({ xania: { owner: ibrahim } });
        var binding = new TestBinding(fsharp_1.fsharp("xania.owner"));
        expect(binding.render(store)).toBe(binding.render(store));
    });
    it("consistent query identity", function () {
        var store = new reactive_1.Reactive.Store({ xania: { employees: [ibrahim] } });
        var binding = new TestBinding(fsharp_1.fsharp("for e in xania.employees"));
        expect(binding.render(store)[0]).toBe(binding.render(store)[0], "not identical");
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcGlsZXJTcGVjLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3BlYy9jb21waWxlclNwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBR0EsNENBQWlEO0FBQ2pELHdDQUFxRDtBQUtyRCxJQUFJLE9BQU8sR0FBWTtJQUNuQixHQUFHLEVBQUUsRUFBRTtJQUNQLFNBQVMsRUFBRSxTQUFTO0lBQ3BCLFFBQVEsRUFBRSxXQUFXO0lBQ3JCLEtBQUssRUFBRSxJQUFJO0NBQ2QsQ0FBQztBQUNGLElBQUksSUFBSSxHQUFZO0lBQ2hCLEdBQUcsRUFBRSxDQUFDO0lBQ04sU0FBUyxFQUFFLE1BQU07SUFDakIsUUFBUSxFQUFFLFdBQVc7SUFDckIsS0FBSyxFQUFFLEtBQUs7Q0FDZixDQUFDO0FBQ0YsSUFBSSxLQUFLLEdBQVk7SUFDakIsR0FBRyxFQUFFLENBQUM7SUFDTixTQUFTLEVBQUUsT0FBTztJQUNsQixRQUFRLEVBQUUsV0FBVztJQUNyQixLQUFLLEVBQUUsS0FBSztDQUNmLENBQUM7QUFFRixDQUFDO0FBZ0tELENBQUM7QUFFRCxRQUFRLENBQUMsZUFBZSxFQUFFO0lBRXRCLEVBQUUsQ0FBQyxnQkFBZ0IsRUFDZjtRQUNJLElBQUksR0FBRyxHQUFHLGVBQUUsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUMzQixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDMUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLEdBQUcsb0JBQW9CLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFFaEcsSUFBSSxPQUFPLEdBQUcsR0FBRyxDQUFDO1FBQ2xCLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3BDLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FB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ZGVfbW9kdWxlcy9AdHlwZXMvamFzbWluZS9pbmRleC5kLnRzXCIgLz5cclxuXHJcbmltcG9ydCB7IEV4cHJlc3Npb24gYXMgWEMgfSBmcm9tIFwiLi4vc3JjL2V4cHJlc3Npb25cIjtcclxuaW1wb3J0IHsgUmVhY3RpdmUgYXMgUmUgfSBmcm9tIFwiLi4vc3JjL3JlYWN0aXZlXCI7XHJcbmltcG9ydCB7IGZzaGFycCBhcyBmcywgYWNjZXB0IH0gZnJvbSBcIi4uL3NyYy9mc2hhcnBcIjtcclxuLy8gaW1wb3J0IHsgQ29yZSB9IGZyb20gXCIuLi9zcmMvY29yZVwiO1xyXG5cclxuaW50ZXJmYWNlIElQZXJzb24geyBmaXJzdE5hbWU6IHN0cmluZzsgbGFzdE5hbWU6IHN0cmluZzsgYWR1bHQ6IGJvb2xlYW4sIGFnZTogbnVtYmVyIH1cclxuXHJcbnZhciBpYnJhaGltOiBJUGVyc29uID0ge1xyXG4gICAgYWdlOiAzNixcclxuICAgIGZpcnN0TmFtZTogXCJJYnJhaGltXCIsXHJcbiAgICBsYXN0TmFtZTogXCJiZW4gU2FsYWhcIixcclxuICAgIGFkdWx0OiB0cnVlXHJcbn07XHJcbnZhciByYW15OiBJUGVyc29uID0ge1xyXG4gICAgYWdlOiA1LFxyXG4gICAgZmlyc3ROYW1lOiBcIlJhbXlcIixcclxuICAgIGxhc3ROYW1lOiBcImJlbiBTYWxhaFwiLFxyXG4gICAgYWR1bHQ6IGZhbHNlXHJcbn07XHJcbnZhciByYW5pYTogSVBlcnNvbiA9IHtcclxuICAgIGFnZTogMyxcclxuICAgIGZpcnN0TmFtZTogXCJSYW5pYVwiLFxyXG4gICAgbGFzdE5hbWU6IFwiYmVuIFNhbGFoXCIsXHJcbiAgICBhZHVsdDogZmFsc2VcclxufTtcclxuXHJcbntcclxuLypcclxudmFyIGRlZmF1bHRSdW50aW1lID0ge1xyXG4gICAgbWFwKGZuLCBsaXN0KSB7XHJcbiAgICAgICAgcmV0dXJuIGxpc3QubWFwKGZuKTtcclxuICAgIH0sXHJcbiAgICBmaWx0ZXIoZm4sIGxpc3QpIHtcclxuICAgICAgICByZXR1cm4gbGlzdC5maWx0ZXIoZm4pO1xyXG4gICAgfSxcclxuICAgIGdldChuYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gdGhpc1tuYW1lXTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIFJlU2hhcnBlciBkaXNhYmxlIEluY29uc2lzdGVudE5hbWluZ1xyXG5kZXNjcmliZShcImZ1bmN0aW9uYWwgZXhwcmVzc2lvbnNcIiwgKCkgPT4ge1xyXG5cclxuICAgIC8vIHZhciBMaXN0ID0gQ29yZS5Db3JlLkxpc3Q7XHJcblxyXG4gICAgaXQoXCI6OiAoLmZpcnN0TmFtZSlcIixcclxuICAgICAgICAvLyAuZmlyc3ROYW1lXHJcbiAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICB2YXIgZXhwciA9IFhDLkxhbWJkYS5tZW1iZXIoXCJmaXJzdE5hbWVcIik7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiOjogXCIgKyBleHByLnRvU3RyaW5nKCkpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGFjdHVhbCA9IGV4cHIuZXhlY3V0ZSgpKGlicmFoaW0pLnZhbHVlT2YoKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChhY3R1YWwpLnRvQmUoXCJJYnJhaGltXCIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIGl0KFwiOjogcGVyc29uIHw+ICguZmlyc3ROYW1lKVwiLFxyXG4gICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgdmFyIGV4cHIgPSBuZXcgWEMuUGlwZShuZXcgWEMuQ29uc3QoaWJyYWhpbSwgXCJwZXJzb25cIiksIFhDLkxhbWJkYS5tZW1iZXIoXCJmaXJzdE5hbWVcIikpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIjo6IFwiICsgZXhwcik7XHJcblxyXG4gICAgICAgICAgICB2YXIgYWN0dWFsID0gZXhwci5leGVjdXRlKCkudmFsdWVPZigpO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KGFjdHVhbCkudG9CZShcIklicmFoaW1cIik7XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIGl0KFwiOjogaW5yZW1lbnQgMVwiLFxyXG4gICAgICAgIC8vIGlucmVtZW50IDFcclxuICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBpbmNyZW1lbnQgPSB4ID0+ICh4ICsgMSk7XHJcbiAgICAgICAgICAgIHZhciBleHByID0gbmV3IFhDLkFwcChuZXcgWEMuQ29uc3QoaW5jcmVtZW50LCBcImluY3JlbWVudFwiKSwgW25ldyBYQy5Db25zdCgxKV0pO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgOjogJHtleHByfWApO1xyXG5cclxuICAgICAgICAgICAgdmFyIGFjdHVhbCA9IGV4cHIuZXhlY3V0ZSgpO1xyXG4gICAgICAgICAgICBleHBlY3QoYWN0dWFsKS50b0JlKDIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIGl0KFwiOjogbm90ICguYWR1bHQpXCIsXHJcbiAgICAgICAgLy8gbm90ICguYWR1bHQpXHJcbiAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICB2YXIgbm90QWR1bHQgPSBuZXcgWEMuTm90KFhDLkxhbWJkYS5tZW1iZXIoXCJhZHVsdFwiKSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGA6OiAke25vdEFkdWx0fWApO1xyXG4gICAgICAgICAgICB2YXIgYWN0dWFsID0gbm90QWR1bHQuZXhlY3V0ZSgpO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGFjdHVhbCA9PT0gXCJmdW5jdGlvblwiKVxyXG4gICAgICAgICAgICAgICAgZXhwZWN0KGFjdHVhbChpYnJhaGltKSkudG9CZShmYWxzZSk7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIGZhaWwoXCJleHBlY3RlZCBhIGZ1bmN0aW9uXCIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIGl0KFwiOjogbWFwIChub3QgKC5hZHVsdCkpIHBlcnNvbnNcIixcclxuICAgICAgICAvLyBcclxuICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBub3RBZHVsdCA9IG5ldyBYQy5Ob3QoWEMuTGFtYmRhLm1lbWJlcihcImFkdWx0XCIpKTtcclxuICAgICAgICAgICAgdmFyIG1hcEV4cHIgPSBuZXcgWEMuQXBwKG5ldyBYQy5Db25zdChkZWZhdWx0UnVudGltZS5tYXAsIFwibWFwXCIpLCBbbm90QWR1bHQsIG5ldyBYQy5Db25zdChbaWJyYWhpbV0sIFwiIFtpYnJhaGltXSBcIildKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYDo6ICR7bWFwRXhwcn1gKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBhY3R1YWwgPSBtYXBFeHByLmV4ZWN1dGUoKTtcclxuICAgICAgICAgICAgZXhwZWN0KGFjdHVhbCkudG9FcXVhbChbZmFsc2VdKTtcclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgaXQoXCI6OiBmb3IgcCBpbiBwZW9wbGUgZG8gd2hlcmUgcC5hZHVsdCBzZWxlY3QgcC5maXJzdE5hbWVcIixcclxuICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBwID0gbmV3IFhDLklkZW50KFwicFwiKTtcclxuICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gbmV3IFhDLlF1ZXJ5KFwicFwiLCBuZXcgWEMuQ29uc3QoW2licmFoaW0sIHJhbXldLCBcIltpYnJhaGltLCByYW15XVwiKSk7XHJcbiAgICAgICAgICAgIHZhciB3aGVyZSA9IG5ldyBYQy5XaGVyZShxdWVyeSwgbmV3IFhDLk1lbWJlcihwLCBcImFkdWx0XCIpKTtcclxuICAgICAgICAgICAgdmFyIHNlbGVjdCA9IG5ldyBYQy5TZWxlY3Qod2hlcmUsIG5ldyBYQy5NZW1iZXIocCwgXCJmaXJzdE5hbWVcIikpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgOjogJHtzZWxlY3R9YCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgYWN0dWFsID0gc2VsZWN0LmV4ZWN1dGUoKS52YWx1ZU9mKCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGFjdHVhbCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChhY3R1YWwpLnRvRXF1YWwoW1wiSWJyYWhpbVwiXSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgaXQoXCI6OiBmb3IgcCBpbiBwZW9wbGUgZG8gb3JkZXJCeSBwLmZpcnN0TmFtZSBzZWxlY3QgcC5maXJzdE5hbWVcIixcclxuICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBwID0gbmV3IFhDLklkZW50KFwicFwiKTtcclxuICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gbmV3IFhDLlF1ZXJ5KFwicFwiLCBuZXcgWEMuQ29uc3QoW3JhbXksIGlicmFoaW1dLCBcIltyYW15LCBpYnJhaGltXVwiKSk7XHJcbiAgICAgICAgICAgIHZhciBvcmRlckJ5ID0gbmV3IFhDLk9yZGVyQnkocXVlcnksIG5ldyBYQy5NZW1iZXIocCwgXCJmaXJzdE5hbWVcIikpO1xyXG4gICAgICAgICAgICB2YXIgc2VsZWN0ID0gbmV3IFhDLlNlbGVjdChvcmRlckJ5LCBuZXcgWEMuTWVtYmVyKHAsIFwiZmlyc3ROYW1lXCIpKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYDo6ICR7c2VsZWN0fWApO1xyXG5cclxuICAgICAgICAgICAgdmFyIGFjdHVhbCA9IHNlbGVjdC5leGVjdXRlKCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChhY3R1YWwpLnRvRXF1YWwoW1wiSWJyYWhpbVwiLCBcIlJhbXlcIl0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIGl0KFwiOjogZm9yIHAgaW4gcGVvcGxlIGRvIGdyb3VwQnkgcC5hZHVsdCBpbnRvIGcgc2VsZWN0IGcuY291bnQgKClcIixcclxuICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBwID0gbmV3IFhDLklkZW50KFwicFwiKTtcclxuICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gbmV3IFhDLlF1ZXJ5KFwicFwiLCBuZXcgWEMuQ29uc3QoW3JhbXksIGlicmFoaW0sIHJhbmlhXSwgXCJbcmFteSwgaWJyYWhpbSwgcmFuaWFdXCIpKTtcclxuICAgICAgICAgICAgdmFyIGdyb3VwQnkgPSBuZXcgWEMuR3JvdXBCeShxdWVyeSwgbmV3IFhDLk1lbWJlcihwLCBcImFkdWx0XCIpLCBcImdcIik7XHJcbiAgICAgICAgICAgIHZhciBzZWxlY3QgPSBuZXcgWEMuU2VsZWN0KGdyb3VwQnksIG5ldyBYQy5NZW1iZXIobmV3IFhDLklkZW50KFwiZ1wiKSwgXCJjb3VudFwiKS5hcHAoW10pKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYDo6ICR7c2VsZWN0fWApO1xyXG5cclxuICAgICAgICAgICAgdmFyIGFjdHVhbCA9IHNlbGVjdC5leGVjdXRlKCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChhY3R1YWwpLnRvRXF1YWwoWzIsIDFdKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICBpdChcIjo6IHBlcnNvbnMgfD4gbWFwIChub3QgLmFkdWx0KVwiLFxyXG4gICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgdmFyIG5vdEFkdWx0ID0gbmV3IFhDLk5vdChYQy5MYW1iZGEubWVtYmVyKFwiYWR1bHRcIikpO1xyXG4gICAgICAgICAgICB2YXIgbWFwRXhwciA9IG5ldyBYQy5QaXBlKG5ldyBYQy5Db25zdChbaWJyYWhpbV0sIFwiZXZlcnlib2R5XCIpLCBuZXcgWEMuQXBwKG5ldyBYQy5JZGVudChcIm1hcFwiKSwgW25vdEFkdWx0XSkpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIjo6IFwiICsgbWFwRXhwcik7XHJcblxyXG4gICAgICAgICAgICB2YXIgYWN0dWFsID0gbWFwRXhwci5leGVjdXRlKGRlZmF1bHRSdW50aW1lKTtcclxuICAgICAgICAgICAgZXhwZWN0KGFjdHVhbCkudG9FcXVhbChbZmFsc2VdKTtcclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgaXQoXCI6OiBwZXJzb25zIHw+IGZpbHRlciAobm90IC5hZHVsdCkgfD4gbWFwICguZmlyc3ROYW1lKVwiLFxyXG4gICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgdmFyIG5vdEFkdWx0ID0gbmV3IFhDLk5vdChYQy5MYW1iZGEubWVtYmVyKFwiYWR1bHRcIikpO1xyXG4gICAgICAgICAgICB2YXIgZmlsdGVyRXhwciA9IG5ldyBYQy5QaXBlKG5ldyBYQy5Db25zdChbaWJyYWhpbSwgcmFteV0sIFwiZXZlcnlib2R5XCIpLCBuZXcgWEMuQXBwKG5ldyBYQy5JZGVudChcImZpbHRlclwiKSwgW25vdEFkdWx0XSkpO1xyXG5cclxuICAgICAgICAgICAgdmFyIG1hcEV4cHIgPSBuZXcgWEMuUGlwZShmaWx0ZXJFeHByLCBuZXcgWEMuQXBwKG5ldyBYQy5JZGVudChcIm1hcFwiKSwgW1hDLkxhbWJkYS5tZW1iZXIoXCJmaXJzdE5hbWVcIildKSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGA6OiAke21hcEV4cHJ9YCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgYWN0dWFsID0gbWFwRXhwci5leGVjdXRlKGRlZmF1bHRSdW50aW1lKTtcclxuICAgICAgICAgICAgZXhwZWN0KGFjdHVhbCkudG9FcXVhbChbXCJSYW15XCJdKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICBpdChcIjo6IHVuYXJ5IGV4cHJlc3Npb25cIixcclxuICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBhZGQgPSAoeCwgeSkgPT4geCArIHk7XHJcbiAgICAgICAgICAgIHZhciBsYW1iZGEgPSBuZXcgWEMuVW5hcnkobmV3IFhDLkNvbnN0KGFkZCwgXCJhZGRcIiksIFtuZXcgWEMuQ29uc3QoMildKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYDo6ICR7bGFtYmRhfWApO1xyXG5cclxuICAgICAgICAgICAgdmFyIGFjdHVhbCA9IGxhbWJkYS5leGVjdXRlKCk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QoYWN0dWFsKDEpKS50b0JlKDMpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIGl0KFwiOjogYmluYXJ5IGV4cHJlc3Npb25cIixcclxuICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBhZGQgPSAoeCwgeSkgPT4geCArIHk7XHJcbiAgICAgICAgICAgIHZhciBsYW1iZGEgPSBuZXcgWEMuQmluYXJ5KG5ldyBYQy5Db25zdChhZGQsIFwiYWRkXCIpLCBbbmV3IFhDLkNvbnN0KDIpXSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGA6OiAke2xhbWJkYX1gKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBhY3R1YWwgPSBsYW1iZGEuZXhlY3V0ZSgpO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KGFjdHVhbCgxLCAyKSkudG9CZSgzKTtcclxuICAgICAgICB9KTtcclxufSk7XHJcblxyXG4qL1xyXG59XHJcblxyXG5kZXNjcmliZShcImZzaGFycCBwYXJzZXJcIiwgKCkgPT4ge1xyXG5cclxuICAgIGl0KCc6OiBmdW4geCAtPiB4ICcsXHJcbiAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICB2YXIgYXN0ID0gZnMoXCJmdW4geCAtPiB4XCIpO1xyXG4gICAgICAgICAgICBleHBlY3QoYXN0KS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlxcclxcbiA9PT09PT09PT09PSBcXHJcXG5cIiArIEpTT04uc3RyaW5naWZ5KGFzdCwgbnVsbCwgMikgKyBcIlxcclxcbiA9PT09PT09PSBcXHJcXG5cIiwgYXN0KTtcclxuXHJcbiAgICAgICAgICAgIHZhciBjb21wb3NlID0gYXN0O1xyXG4gICAgICAgICAgICBleHBlY3QoY29tcG9zZS50eXBlKS50b0JlKFwibGFtYmRhXCIpO1xyXG4gICAgICAgICAgICBleHBlY3QoY29tcG9zZS5wYXJhbSkudG9CZShcInhcIik7XHJcbiAgICAgICAgICAgIGV4cGVjdChjb21wb3NlLmJvZHkubmFtZSkudG9CZShcInhcIik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgaXQoJzo6IC5maXJzdE5hbWUgJyxcclxuICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBhc3QgPSBmcyhcIi5maXJzdE5hbWVcIik7XHJcbiAgICAgICAgICAgIGV4cGVjdChhc3QpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiXFxyXFxuID09PT09PT09PT09IFxcclxcblwiICsgSlNPTi5zdHJpbmdpZnkoYXN0LCBudWxsLCAyKSArIFwiXFxyXFxuID09PT09PT09IFxcclxcblwiLCBhc3QpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGNvbXBvc2UgPSBhc3Q7XHJcbiAgICAgICAgICAgIGV4cGVjdChjb21wb3NlLnR5cGUpLnRvQmUoXCJsYW1iZGFcIik7XHJcbiAgICAgICAgICAgIGV4cGVjdChjb21wb3NlLnBhcmFtKS50b0JlKFwieFwiKTtcclxuICAgICAgICAgICAgZXhwZWN0KGNvbXBvc2UuYm9keS50YXJnZXQubmFtZSkudG9CZShcInhcIik7XHJcbiAgICAgICAgICAgIGV4cGVjdChjb21wb3NlLmJvZHkubWVtYmVyLm5hbWUpLnRvQmUoXCJmaXJzdE5hbWVcIik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgaXQoJzo6IDEgKyAyJyxcclxuICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBhc3QgPSBmcyhcIjEgKyAyXCIpO1xyXG4gICAgICAgICAgICBleHBlY3QoYXN0KS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlxcclxcbiA9PT09PT09PT09PSBcXHJcXG5cIiArIEpTT04uc3RyaW5naWZ5KGFzdCwgbnVsbCwgMikgKyBcIlxcclxcbiA9PT09PT09PSBcXHJcXG5cIik7XHJcblxyXG4gICAgICAgICAgICB2YXIgZXhwciA9IGFzdDtcclxuICAgICAgICAgICAgZXhwZWN0KGV4cHIudHlwZSkudG9CZSgnYXBwJyk7XHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShhc3QsIG51bGwsIDIpKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICBpdCgnOjogZm4gYScsXHJcbiAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICB2YXIgYXN0ID0gZnMoXCJmdW4gYVwiKTtcclxuICAgICAgICAgICAgZXhwZWN0KGFzdCkudG9CZURlZmluZWQoKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJcXHJcXG4gPT09PT09PT09PT0gXFxyXFxuXCIgKyBKU09OLnN0cmluZ2lmeShhc3QsIG51bGwsIDIpICsgXCJcXHJcXG4gPT09PT09PT0gXFxyXFxuXCIpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGV4cHIgPSBhc3Q7XHJcbiAgICAgICAgICAgIGV4cGVjdChleHByLnR5cGUpLnRvQmUoJ2FwcCcpO1xyXG4gICAgICAgICAgICBleHBlY3QoZXhwci5mdW4pLnRvRXF1YWwoeyB0eXBlOiAnaWRlbnQnLCBuYW1lOiAnZnVuJyB9KTtcclxuICAgICAgICAgICAgZXhwZWN0KGV4cHIuYXJncykudG9FcXVhbChbeyB0eXBlOiBcImlkZW50XCIsIG5hbWU6IFwiYVwiIH1dKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICBpdCgnOjogZm4gKCknLFxyXG4gICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgdmFyIGFzdCA9IGZzKFwiZnVuICgpXCIpO1xyXG4gICAgICAgICAgICBleHBlY3QoYXN0KS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlxcclxcbiA9PT09PT09PT09PSBcXHJcXG5cIiArIEpTT04uc3RyaW5naWZ5KGFzdCwgbnVsbCwgMikgKyBcIlxcclxcbiA9PT09PT09PSBcXHJcXG5cIik7XHJcblxyXG4gICAgICAgICAgICB2YXIgZXhwciA9IGFzdDtcclxuICAgICAgICAgICAgZXhwZWN0KGV4cHIudHlwZSkudG9CZSgnYXBwJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChleHByLmZ1bikudG9FcXVhbCh7IHR5cGU6ICdpZGVudCcsIG5hbWU6ICdmdW4nIH0pO1xyXG4gICAgICAgICAgICBleHBlY3QoZXhwci5hcmdzLmxlbmd0aCkudG9CZSgwKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICBpdCgnOjogKCspIGEgYicsXHJcbiAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICB2YXIgYXN0ID0gZnMoXCIoKykgYSBiXCIpO1xyXG4gICAgICAgICAgICBleHBlY3QoYXN0KS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlxcclxcbiA9PT09PT09PT09PSBcXHJcXG5cIiArIEpTT04uc3RyaW5naWZ5KGFzdCwgbnVsbCwgMikgKyBcIlxcclxcbiA9PT09PT09PSBcXHJcXG5cIik7XHJcblxyXG4gICAgICAgICAgICB2YXIgZXhwciA9IGFzdDtcclxuICAgICAgICAgICAgZXhwZWN0KGV4cHIpLnRvRXF1YWwoeyBcInR5cGVcIjogXCJhcHBcIiwgXCJmdW5cIjogXCIrXCIsIFwiYXJnc1wiOiBbeyBcInR5cGVcIjogXCJpZGVudFwiLCBcIm5hbWVcIjogXCJhXCIgfSwgeyBcInR5cGVcIjogXCJpZGVudFwiLCBcIm5hbWVcIjogXCJiXCIgfV0gfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgaXQoJzo6IGEgfD4gYiB8PiBjJyxcclxuICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBhc3QgPSBmcyhcImEgfD4gYiB8PiBjXCIpO1xyXG4gICAgICAgICAgICBleHBlY3QoYXN0KS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlxcclxcbiA9PT09PT09PT09PSBcXHJcXG5cIiArIEpTT04uc3RyaW5naWZ5KGFzdCwgbnVsbCwgMikgKyBcIlxcclxcbiA9PT09PT09PSBcXHJcXG5cIik7XHJcblxyXG4gICAgICAgICAgICB2YXIgcGlwZTEgPSBhc3Q7XHJcbiAgICAgICAgICAgIGV4cGVjdChwaXBlMS50eXBlKS50b0JlKFwicGlwZVwiKTtcclxuICAgICAgICAgICAgZXhwZWN0KHBpcGUxLmZ1bikudG9CZShcInw+XCIpO1xyXG4gICAgICAgICAgICBleHBlY3QocGlwZTEuYXJnc1swXSkudG9FcXVhbCh7IFwidHlwZVwiOiBcImlkZW50XCIsIFwibmFtZVwiOiBcImNcIiB9KTtcclxuXHJcbiAgICAgICAgICAgIHZhciBwaXBlMiA9IHBpcGUxLmFyZ3NbMV07XHJcbiAgICAgICAgICAgIGV4cGVjdChwaXBlMi50eXBlKS50b0JlKFwicGlwZVwiKTtcclxuICAgICAgICAgICAgZXhwZWN0KHBpcGUyLmZ1bikudG9CZShcInw+XCIpO1xyXG4gICAgICAgICAgICBleHBlY3QocGlwZTIuYXJnc1swXSkudG9FcXVhbCh7IFwidHlwZVwiOiBcImlkZW50XCIsIFwibmFtZVwiOiBcImJcIiB9KTtcclxuICAgICAgICAgICAgZXhwZWN0KHBpcGUyLmFyZ3NbMV0pLnRvRXF1YWwoeyBcInR5cGVcIjogXCJpZGVudFwiLCBcIm5hbWVcIjogXCJhXCIgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgaXQoJzo6IGEgKyBiIHw+IGMnLFxyXG4gICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgdmFyIGFzdCA9IGZzKFwiYSArIGIgfD4gY1wiKTtcclxuICAgICAgICAgICAgZXhwZWN0KGFzdCkudG9CZURlZmluZWQoKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJcXHJcXG4gPT09PT09PT09PT0gXFxyXFxuXCIgKyBKU09OLnN0cmluZ2lmeShhc3QsIG51bGwsIDIpICsgXCJcXHJcXG4gPT09PT09PT0gXFxyXFxuXCIpO1xyXG5cclxuICAgICAgICAgICAgdmFyIHBpcGUgPSBhc3Q7XHJcbiAgICAgICAgICAgIGV4cGVjdChwaXBlLnR5cGUpLnRvQmUoXCJwaXBlXCIpO1xyXG4gICAgICAgICAgICBleHBlY3QocGlwZS5mdW4pLnRvQmUoXCJ8PlwiKTtcclxuICAgICAgICAgICAgZXhwZWN0KHBpcGUuYXJnc1swXSkudG9FcXVhbCh7IHR5cGU6IFwiaWRlbnRcIiwgbmFtZTogXCJjXCIgfSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgYWRkID0gcGlwZS5hcmdzWzFdO1xyXG4gICAgICAgICAgICBleHBlY3QoYWRkLmFyZ3NbMF0ubmFtZSkudG9CZShcImJcIik7XHJcbiAgICAgICAgICAgIGV4cGVjdChhZGQuYXJnc1sxXS5uYW1lKS50b0JlKFwiYVwiKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFt7XCJ0eXBlXCI6XCJwaXBlXCIsXCJmdW5cIjpcInw+XCIsXCJhcmdzXCI6W3tcInR5cGVcIjpcImlkZW50XCIsXCJuYW1lXCI6XCJjXCJ9LHtcInR5cGVcIjpcInBpcGVcIixcImZ1blwiOlwifD5cIixcImFyZ3NcIjpbe1widHlwZVwiOlwiaWRlbnRcIixcIm5hbWVcIjpcImJcIn0se1widHlwZVwiOlwiaWRlbnRcIixcIm5hbWVcIjpcImFcIn1dfV19XVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIGl0KCc6OiBhID4+IGIgJyxcclxuICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBhc3QgPSBmcyhcImEgPj4gYlwiKTtcclxuICAgICAgICAgICAgZXhwZWN0KGFzdCkudG9CZURlZmluZWQoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBjb21wb3NlID0gYXN0O1xyXG4gICAgICAgICAgICBleHBlY3QoY29tcG9zZS50eXBlKS50b0JlKFwiY29tcG9zZVwiLCBKU09OLnN0cmluZ2lmeShhc3QsIG51bGwsIDIpKTtcclxuICAgICAgICAgICAgZXhwZWN0KGNvbXBvc2UuZnVuKS50b0JlKFwiPj5cIiwgSlNPTi5zdHJpbmdpZnkoYXN0LCBudWxsLCAyKSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChjb21wb3NlLmFyZ3NbMF0ubmFtZSkudG9CZShcImJcIiwgSlNPTi5zdHJpbmdpZnkoY29tcG9zZS5hcmdzWzBdLCBudWxsLCAyKSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChjb21wb3NlLmFyZ3NbMV0ubmFtZSkudG9CZShcImFcIiwgSlNPTi5zdHJpbmdpZnkoY29tcG9zZS5hcmdzWzFdLCBudWxsLCAyKSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgaXQoJzo6IGEuYiAnLFxyXG4gICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgdmFyIGFzdCA9IGZzKFwiYS5iXCIpO1xyXG4gICAgICAgICAgICBleHBlY3QoYXN0KS50b0JlRGVmaW5lZCgpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGNvbXBvc2UgPSBhc3Q7XHJcbiAgICAgICAgICAgIGV4cGVjdChjb21wb3NlLnR5cGUpLnRvQmUoXCJtZW1iZXJcIiwgSlNPTi5zdHJpbmdpZnkoYXN0LCBudWxsLCAyKSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChjb21wb3NlLnRhcmdldC5uYW1lKS50b0JlKFwiYVwiLCBKU09OLnN0cmluZ2lmeShhc3QsIG51bGwsIDIpKTtcclxuICAgICAgICAgICAgZXhwZWN0KGNvbXBvc2UubWVtYmVyKS50b0JlKFwiYlwiLCBKU09OLnN0cmluZ2lmeShhc3QsIG51bGwsIDIpKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICBpdCgnOjogWzEuLm5dICcsXHJcbiAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICB2YXIgYXN0ID0gZnMoXCJbMS4ubl1cIik7XHJcbiAgICAgICAgICAgIGV4cGVjdChhc3QpLnRvQmVEZWZpbmVkKCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgcmFuZ2UgPSBhc3Q7XHJcbiAgICAgICAgICAgIGV4cGVjdChyYW5nZS50eXBlKS50b0JlKFwicmFuZ2VcIiwgSlNPTi5zdHJpbmdpZnkoYXN0LCBudWxsLCAyKSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyYW5nZS5mcm9tLnZhbHVlKS50b0JlKDEsIEpTT04uc3RyaW5naWZ5KGFzdCwgbnVsbCwgMikpO1xyXG4gICAgICAgICAgICBleHBlY3QocmFuZ2UudG8ubmFtZSkudG9CZShcIm5cIiwgSlNPTi5zdHJpbmdpZnkoYXN0LCBudWxsLCAyKSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgaXQoJzo6IGZvciBwIGluIHBlb3BsZSB3aGVyZSBwLmFkdWx0ICcsXHJcbiAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICB2YXIgYXN0ID0gZnMoXCJmb3IgcCBpbiBwZW9wbGUgd2hlcmUgcC5hZHVsdFwiKTtcclxuICAgICAgICAgICAgZXhwZWN0KGFzdCkudG9CZURlZmluZWQoKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJcXHJcXG4gPT09PT09PT09PT0gXFxyXFxuXCIgKyBKU09OLnN0cmluZ2lmeShhc3QsIG51bGwsIDIpICsgXCJcXHJcXG4gPT09PT09PT0gXFxyXFxuXCIsIGFzdCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgd2hlcmUgPSBhc3Q7XHJcblxyXG4gICAgICAgICAgICBleHBlY3Qod2hlcmUudHlwZSkudG9CZShcIndoZXJlXCIpO1xyXG4gICAgICAgICAgICBleHBlY3Qod2hlcmUucHJlZGljYXRlLnR5cGUpLnRvQmUoXCJtZW1iZXJcIik7XHJcbiAgICAgICAgICAgIGV4cGVjdCh3aGVyZS5zb3VyY2UudHlwZSkudG9CZShcInF1ZXJ5XCIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIGl0KCc6OiByZWdyZXNzaW9uIHRlc3QnLFxyXG4gICAgICAgICgpID0+IHtcclxuXHJcbiAgICAgICAgICAgIHZhciBzdGFydCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGFzdCA9IGZzKFwiYSB8PiBiLmMgPj4gKCspIDEgfD4gZFwiKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAxMDAwOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGZzKFwiYSB8PiBiID4+ICgrKSAxIHw+IGRcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGVsYXBzZWQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHN0YXJ0O1xyXG5cclxuICAgICAgICAgICAgaWYgKGVsYXBzZWQgPiAyMDAwKSBmYWlsKFwidG9vIHNsb3dcIik7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QoYXN0KS50b0VxdWFsKHtcclxuICAgICAgICAgICAgICAgIFwidHlwZVwiOiBcInBpcGVcIixcclxuICAgICAgICAgICAgICAgIFwiZnVuXCI6IFwifD5cIixcclxuICAgICAgICAgICAgICAgIFwiYXJnc1wiOlxyXG4gICAgICAgICAgICAgICAgW1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwiaWRlbnRcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiZFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidHlwZVwiOiBcInBpcGVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJmdW5cIjogXCJ8PlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImFyZ3NcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidHlwZVwiOiBcImNvbXBvc2VcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImZ1blwiOiBcIj4+XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhcmdzXCI6IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwiYXBwXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImZ1blwiOiBcIitcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYXJnc1wiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwiY29uc3RcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiAxXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInR5cGVcIjogXCJtZW1iZXJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidGFyZ2V0XCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInR5cGVcIjogXCJpZGVudFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcImJcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibWVtYmVyXCI6IFwiY1wiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwiaWRlbnRcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJhXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbn0pO1xyXG5cclxuXHJcbmNsYXNzIFRlc3RCaW5kaW5nIGV4dGVuZHMgUmUuQmluZGluZyB7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGFzdCkge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVuZGVyKGNvbnRleHQpIHtcclxuICAgICAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0O1xyXG4gICAgICAgIHJldHVybiBhY2NlcHQodGhpcy5hc3QsIHRoaXMsIGNvbnRleHQpLnZhbHVlT2YoKTtcclxuICAgIH1cclxufVxyXG5cclxuZGVzY3JpYmUoXCJydW50aW1lXCIsICgpID0+IHtcclxuXHJcbiAgICBpdChcImV4cHJlc3Npb24gZGVwZW5kZW5jaWVzXCIsXHJcbiAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICB2YXIgc3RvcmUgPSBuZXcgUmUuU3RvcmUoeyBwOiBpYnJhaGltIH0pO1xyXG4gICAgICAgICAgICB2YXIgYmluZGluZyA9IG5ldyBUZXN0QmluZGluZyhmcyhcInAuZmlyc3ROYW1lXCIpKTtcclxuICAgICAgICAgICAgYmluZGluZy51cGRhdGUoc3RvcmUpO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KGJpbmRpbmcuc3RhdGUpLnRvQmUoXCJJYnJhaGltXCIpO1xyXG4gICAgICAgICAgICBleHBlY3QoYmluZGluZy5kZXBlbmRlbmNpZXMubGVuZ3RoKS50b0JlKDIpO1xyXG5cclxuICAgICAgICAgICAgLy8gZXhwZWN0KHN0b3JlLmRpcnR5Lmxlbmd0aCkudG9CZSgwKTtcclxuXHJcbiAgICAgICAgICAgIHN0b3JlLmdldChcInBcIikuZ2V0KFwiZmlyc3ROYW1lXCIpLnNldChcIk1yIElicmFpaG1cIik7XHJcbiAgICAgICAgICAgIGV4cGVjdChiaW5kaW5nLnN0YXRlKS50b0JlKFwiTXIgSWJyYWlobVwiKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChiaW5kaW5nLmRlcGVuZGVuY2llcy5sZW5ndGgpLnRvQmUoMik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgaXQoXCJjb25zaXN0ZW50IHZhcmlhYmxlIGlkZW50aXR5XCIsXHJcbiAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICB2YXIgc3RvcmUgPSBuZXcgUmUuU3RvcmUoeyBwOiBpYnJhaGltIH0pO1xyXG5cclxuICAgICAgICAgICAgdmFyIGJpbmRpbmcgPSBuZXcgVGVzdEJpbmRpbmcoZnMoXCJwXCIpKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChiaW5kaW5nLnJlbmRlcihzdG9yZSkpLnRvQmUoYmluZGluZy5yZW5kZXIoc3RvcmUpKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICBpdChcImNvbnNpc3RlbnQgbWVtYmVyIGlkZW50aXR5XCIsICgpID0+IHtcclxuICAgICAgICB2YXIgc3RvcmUgPSBuZXcgUmUuU3RvcmUoeyB4YW5pYTogeyBvd25lcjogaWJyYWhpbSB9IH0pO1xyXG4gICAgICAgIHZhciBiaW5kaW5nID0gbmV3IFRlc3RCaW5kaW5nKGZzKFwieGFuaWEub3duZXJcIikpO1xyXG4gICAgICAgIGV4cGVjdChiaW5kaW5nLnJlbmRlcihzdG9yZSkpLnRvQmUoYmluZGluZy5yZW5kZXIoc3RvcmUpKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KFwiY29uc2lzdGVudCBxdWVyeSBpZGVudGl0eVwiLCAoKSA9PiB7XHJcbiAgICAgICAgdmFyIHN0b3JlID0gbmV3IFJlLlN0b3JlKHsgeGFuaWE6IHsgZW1wbG95ZWVzOiBbIGlicmFoaW0gXSB9IH0pO1xyXG4gICAgICAgIHZhciBiaW5kaW5nID0gbmV3IFRlc3RCaW5kaW5nKGZzKFwiZm9yIGUgaW4geGFuaWEuZW1wbG95ZWVzXCIpKTtcclxuICAgICAgICBleHBlY3QoYmluZGluZy5yZW5kZXIoc3RvcmUpWzBdKS50b0JlKGJpbmRpbmcucmVuZGVyKHN0b3JlKVswXSwgXCJub3QgaWRlbnRpY2FsXCIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy9pdChcImV4ZWN1dGUgcXVlcnlcIixcclxuICAgIC8vICAgICgpID0+IHtcclxuICAgIC8vICAgICAgICB2YXIgcm9vdCA9IG5ldyBDb3JlLlNjb3BlKHsgcGVvcGxlOiBbaWJyYWhpbSwgcmFteSwgcmFuaWFdLCBiOiAxIH0pO1xyXG4gICAgLy8gICAgICAgIHZhciByZXN1bHQgPSBmcyhcImZvciBwIGluIHBlb3BsZSB3aGVyZSBwLmFkdWx0IHNlbGVjdCBwXCIpLmV4ZWN1dGUocm9vdCk7XHJcblxyXG4gICAgLy8gICAgICAgIGV4cGVjdChyZXN1bHQubGVuZ3RoKS50b0JlKDEpO1xyXG4gICAgLy8gICAgICAgIC8vIHNjb3BlIGNvbnRhaW5zIHJvb3QgdmFsdWVzLlxyXG4gICAgLy8gICAgICAgIGV4cGVjdChyZXN1bHRbMF0ucGFyZW50LnBhcmVudCkudG9FcXVhbChyb290KTtcclxuICAgIC8vICAgICAgICAvLyBzY29wZSBleHRlbmRzIHJvb3Qgc2NvcGUuXHJcbiAgICAvLyAgICAgICAgZXhwZWN0KHJlc3VsdFswXS5nZXQoJ3AnKS52YWx1ZU9mKCkpLnRvQmUoaWJyYWhpbSk7XHJcbiAgICAvLyAgICB9KTtcclxuXHJcbiAgICAvL2l0KFwicmVhY3RpdmUgc3RvcmVcIixcclxuICAgIC8vICAgICgpID0+IHtcclxuICAgIC8vICAgICAgICB2YXIgcGVyc29uID0geyBmaXJzdE5hbWU6IFwiSVwiLCBsYXN0TmFtZTogXCJhbSBSZWFjdGl2ZVwiIH07XHJcbiAgICAvLyAgICAgICAgdmFyIHN0b3JlID0gbmV3IFJlLlN0b3JlKHsgcGVvcGxlOiBbcGVyc29uXSB9KTtcclxuICAgIC8vICAgICAgICBzdG9yZS5iaW5kKGZzKFwiZm9yIHAgaW4gcGVvcGxlIHNlbGVjdCBwLmFnZVwiKSwgYWdlcyA9PiB7XHJcbiAgICAvLyAgICAgICAgICAgIGV4cGVjdChhZ2VzKS50b0VxdWFsKFszNiwgNSwgM10pO1xyXG4gICAgLy8gICAgICAgIH0pO1xyXG4gICAgLy8gICAgfSk7XHJcbn0pO1xyXG5cclxuIl19