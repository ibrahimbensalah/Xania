<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/lib/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
  <link href="/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
  <title>Xania Admin</title>
  <script src="/lib/system.js/dist/system.js"></script>
  <script src="/lib/fetch/fetch.js"></script>
  <script>
    var basePath = '[BASE]';
    var appName = '[APP]';
    var appPath = basePath + appName;
    var actionPath = '[ARGS]' || 'index';
    System.config({
      packages: { '/': {} },
      paths: {
        "github:*": "/jspm_packages/github/*",
        "npm:*": "/jspm_packages/npm/*"
    },
      map: {
        "css": "github:systemjs/plugin-css@0.1.32",
        "less": "npm:systemjs-less-plugin@2.0.0"
      },
      meta: {
        '*.css': { loader: 'css' },
        '*.less': { loader: 'less' }
      }
    });

    function importModule(path) {
      return System.import(path);
    }

    Promise.all([appPath, '/src/mvc', '/src/dom'].map(importModule))
      .then(function (modules) {
        var app = modules[0];
        var mvc = modules[1];
        var dom = modules[2];

        var url = new mvc.UrlHelper(appPath, actionPath, app);

        var mainDriver = new dom.Dom.DomDriver('.main-content');
        url.actionPath.subscribe(function (path) {
          if (typeof app[path] === "function") {
            var result = app[path]();
            mainDriver.dispose();
            result.execute(mainDriver, dom.Dom.DomVisitor);
          } else {
            System.import(basePath + path).then(function(module) {
              mainDriver.dispose();
              module.action().execute(mainDriver, dom.Dom.DomVisitor).execute();
            });
          }
        });

        var html = new mvc.HtmlHelper(System);

        //app.index({
        //  url: url,
        //  html: html
        //}).execute(new dom.Dom.DomDriver('.main-content'));

        app.menu({
          url: url,
          html: html,
          driver: new dom.Dom.DomDriver('.main-menu')
        });
      });
  </script>
</head>
<body>
  <nav class="navbar navbar-toggleable-md navbar-light bg-faded">
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="[BASE][APP]">Xania Software</a>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Link</a>
        </li>
        <li class="nav-item">
          <a class="nav-link disabled" href="#">Disabled</a>
        </li>
      </ul>
    </div>
  </nav>
  <div class="flex-container">
    <menu class="main-menu"></menu>
    <main class="main-content" style="height: 100%;"></main>
  </div>
</body>

</html>
